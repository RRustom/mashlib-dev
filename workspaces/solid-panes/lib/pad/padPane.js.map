{"version":3,"sources":["../../src/pad/padPane.ts"],"names":["paneDef","icon","icons","iconBase","name","audience","ns","solid","label","subject","context","t","session","store","findTypeURIs","mintClass","pad","mintNew","newPaneOptions","updater","me","uri","Error","newInstance","sym","newBase","newPadDoc","doc","add","rdf","dc","Date","chunk","sioc","Promise","resolve","reject","put","statementsMatching","undefined","uri2","ok","message","render","paneOptions","dom","complainIfBad","div","appendChild","widgets","errorMessageBlock","clearElement","ele","firstChild","removeChild","genACLtext","docURI","aclURI","allWrite","g","auth","a","acl","foaf","setACL","callbackFunction","aclDoc","any","fetcher","aclText","webOperation","data","contentType","then","err","load","newInstanceButton","button","createElement","textContent","addEventListener","showBootstrap","spawnArea","thisInstance","container","noun","appDetails","authn","newAppInstance","workspace","initializeNewInstanceInWorkspace","NamedNode","p","baseField","setAttribute","size","autocomplete","_e","value","slice","initializeNewInstanceAtBase","ws","space","split","log","error","appPathSegment","now","getTime","here","base","newIndexDoc","toBeCopied","local","agenda","f","length","item","fun","copyItem","push","newURI","console","setThatACL","shift","webCopy","checkUser","webId","createNewPadDataFile","PAD","padDoc","_uri2","body","innerHTML","showResults","exists","currentUser","title","vcard","solo","window","document","options","padEle","notepad","naviMain","partipationTarget","meeting","manageParticipation","naviMiddle2","setRefreshHandler","reloadAndSync","loadPadData","nowOrWhenFetched","response","status","holds","wf","naviMiddle3","structure","naviLoginoutTR","naviTop","naviMiddle","naviMiddle1","naviStatus","statusArea","naviSpawn","naviMenu","timingArea"],"mappings":"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","sourcesContent":["import { authn, icons, ns, pad, widgets } from 'solid-ui'\nimport { graph, log, NamedNode, Namespace, sym, serialize, Store } from 'rdflib'\nimport { PaneDefinition } from 'pane-registry'\nimport { AppDetails } from 'solid-ui/lib/authn/types'\n/*   pad Pane\n **\n */\n\nconst paneDef: PaneDefinition = {\n  // icon:  (module.__dirname || __dirname) + 'images/ColourOn.png',\n  icon: icons.iconBase + 'noun_79217.svg',\n\n  name: 'pad',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve an pad pane?\n  label: function (subject, context) {\n    const t = (context.session.store as Store).findTypeURIs(subject)\n    if (t['http://www.w3.org/ns/pim/pad#Notepad']) {\n      return 'pad'\n    }\n    return null // No under other circumstances\n  },\n\n  mintClass: ns.pad('Notepad'),\n\n  mintNew: function (context, newPaneOptions: any) {\n    const store = context.session.store as Store\n    const updater = store.updater\n    if (newPaneOptions.me && !newPaneOptions.me.uri) {\n      throw new Error('notepad mintNew:  Invalid userid')\n    }\n\n    const newInstance = (newPaneOptions.newInstance =\n      newPaneOptions.newInstance ||\n      store.sym(newPaneOptions.newBase + 'index.ttl#this'))\n    // var newInstance = kb.sym(newBase + 'pad.ttl#thisPad');\n    const newPadDoc = newInstance.doc()\n\n    store.add(newInstance, ns.rdf('type'), ns.pad('Notepad'), newPadDoc)\n    store.add(newInstance, ns.dc('title'), 'Shared Notes', newPadDoc)\n    store.add(newInstance, ns.dc('created'), new Date() as any, newPadDoc) // @@ TODO Remove casting\n    if (newPaneOptions.me) {\n      store.add(newInstance, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    }\n    // kb.add(newInstance, ns.pad('next'), newInstance, newPadDoc);\n    // linked list empty @@\n    const chunk = store.sym(newInstance.uri + '_line0')\n    store.add(newInstance, ns.pad('next'), chunk, newPadDoc) // Linked list has one entry\n    store.add(chunk, ns.pad('next'), newInstance, newPadDoc)\n    store.add(chunk, ns.dc('author'), newPaneOptions.me, newPadDoc)\n    store.add(chunk, ns.sioc('content'), '', newPadDoc)\n\n    return new Promise(function (resolve, reject) {\n      if (!updater) {\n        reject(new Error('Have no updater'))\n        return\n      }\n      updater.put(\n        newPadDoc,\n        store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n        'text/turtle',\n        function (uri2, ok, message) {\n          if (ok) {\n            resolve(newPaneOptions)\n          } else {\n            reject(\n              new Error('FAILED to save new tool at: ' + uri2 + ' : ' + message)\n            )\n          }\n        }\n      )\n    })\n  },\n  // and follow instructions there\n  // @@ TODO Set better type for paneOptions\n  render: function (subject, context, paneOptions: any) {\n    const dom = context.dom\n    const store = context.session.store as Store\n    // Utility functions\n    const complainIfBad = function (ok: boolean, message: string) {\n      if (!ok) {\n        div.appendChild(widgets.errorMessageBlock(dom, message, 'pink'))\n      }\n    }\n\n    const clearElement = function (ele: HTMLElement) {\n      while (ele.firstChild) {\n        ele.removeChild(ele.firstChild)\n      }\n      return ele\n    }\n\n    // Access control\n\n    // Two variations of ACL for this app, public read and public read/write\n    // In all cases owner has read write control\n    const genACLtext = function (\n      docURI: string,\n      aclURI: string,\n      allWrite: boolean\n    ) {\n      const g = graph()\n      const auth = Namespace('http://www.w3.org/ns/auth/acl#')\n      let a = g.sym(aclURI + '#a1')\n      const acl = g.sym(aclURI)\n      const doc = g.sym(docURI)\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agent'), me, acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      g.add(a, auth('mode'), auth('Write'), acl)\n      g.add(a, auth('mode'), auth('Control'), acl)\n\n      a = g.sym(aclURI + '#a2')\n      g.add(a, ns.rdf('type'), auth('Authorization'), acl)\n      g.add(a, auth('accessTo'), doc, acl)\n      g.add(a, auth('agentClass'), ns.foaf('Agent'), acl)\n      g.add(a, auth('mode'), auth('Read'), acl)\n      if (allWrite) {\n        g.add(a, auth('mode'), auth('Write'), acl)\n      }\n      // TODO: Figure out why `serialize` isn't on the type definition according to TypeScript:\n      return serialize(acl, g, aclURI, 'text/turtle')\n    }\n\n    /**\n     * @param docURI\n     * @param allWrite\n     * @param callbackFunction\n     *\n     * @returns {Promise<Response>}\n     */\n    const setACL = function setACL (\n      docURI: string,\n      allWrite: boolean,\n      callbackFunction: Function\n    ) {\n      const aclDoc = store.any(\n        sym(docURI),\n        sym('http://www.iana.org/assignments/link-relations/acl')\n      ) as NamedNode // @@ check that this get set by web.js\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      if (aclDoc) {\n        // Great we already know where it is\n        const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n        return fetcher\n          .webOperation('PUT', aclDoc.uri, {\n            data: aclText,\n            contentType: 'text/turtle'\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      } else {\n        return fetcher\n          .load(docURI)\n          .catch((err: Error) => {\n            callbackFunction(false, 'Getting headers for ACL: ' + err)\n          })\n          .then(() => {\n            const aclDoc = store.any(\n              sym(docURI),\n              sym('http://www.iana.org/assignments/link-relations/acl')\n            ) as NamedNode\n\n            if (!aclDoc) {\n              // complainIfBad(false, \"No Link rel=ACL header for \" + docURI);\n              throw new Error('No Link rel=ACL header for ' + docURI)\n            }\n\n            const aclText = genACLtext(docURI, aclDoc.uri, allWrite)\n\n            return fetcher.webOperation('PUT', aclDoc.uri, {\n              data: aclText,\n              contentType: 'text/turtle'\n            })\n          })\n          .then(() => callbackFunction(true))\n          .catch(err => {\n            callbackFunction(false, err.message)\n          })\n      }\n    }\n\n    //  Reproduction: spawn a new instance\n    //\n    // Viral growth path: user of app decides to make another instance\n    const newInstanceButton = function () {\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start another pad'\n      button.addEventListener('click', function () {\n        return showBootstrap(subject, spawnArea, 'pad')\n      })\n      return button\n    }\n\n    // Option of either using the workspace system or just typing in a URI\n    var showBootstrap = function showBootstrap (\n      thisInstance: any,\n      container: HTMLElement,\n      noun: string\n    ) {\n      const div = clearElement(container)\n      const appDetails = { noun: 'notepad' } as AppDetails\n      div.appendChild(\n        authn.newAppInstance(dom, appDetails, (workspace: string | null, newBase) => {\n          // FIXME: not sure if this will work at all, just\n          // trying to get the types to match - Michiel.\n          return initializeNewInstanceInWorkspace(new NamedNode(workspace || newBase))\n        })\n      )\n\n      div.appendChild(dom.createElement('hr')) // @@\n\n      const p = div.appendChild(dom.createElement('p'))\n      p.textContent =\n        'Where would you like to store the data for the ' +\n        noun +\n        '?  ' +\n        'Give the URL of the directory where you would like the data stored.'\n      const baseField = div.appendChild(dom.createElement('input'))\n      baseField.setAttribute('type', 'text')\n      baseField.size = 80 // really a string\n      ;(baseField as any).label = 'base URL'\n      baseField.autocomplete = 'on'\n\n      div.appendChild(dom.createElement('br')) // @@\n\n      const button = div.appendChild(dom.createElement('button'))\n      button.textContent = 'Start new ' + noun + ' at this URI'\n      button.addEventListener('click', function (_e) {\n        let newBase = baseField.value\n        if (newBase.slice(-1) !== '/') {\n          newBase += '/'\n        }\n        initializeNewInstanceAtBase(thisInstance, newBase)\n      })\n    }\n\n    //  Create new document files for new instance of app\n    var initializeNewInstanceInWorkspace = function (ws: NamedNode) {\n      // @@ TODO Clean up type for newBase\n      let newBase: any = store.any(ws, ns.space('uriPrefix'))\n      if (!newBase) {\n        newBase = ws.uri.split('#')[0]\n      } else {\n        newBase = newBase.value\n      }\n      if (newBase.slice(-1) !== '/') {\n        log.error(appPathSegment + ': No / at end of uriPrefix ' + newBase) // @@ paramater?\n        newBase = newBase + '/'\n      }\n      const now = new Date()\n      newBase += appPathSegment + '/id' + now.getTime() + '/' // unique id\n\n      initializeNewInstanceAtBase(thisInstance, newBase)\n    }\n\n    var initializeNewInstanceAtBase = function (\n      thisInstance: any,\n      newBase: string\n    ) {\n      const here = sym(thisInstance.uri.split('#')[0])\n      const base = here // @@ ???\n\n      const newPadDoc = store.sym(newBase + 'pad.ttl')\n      const newIndexDoc = store.sym(newBase + 'index.html')\n\n      const toBeCopied = [{ local: 'index.html', contentType: 'text/html' }]\n\n      const newInstance = store.sym(newPadDoc.uri + '#thisPad')\n\n      // log.debug(\"\\n Ready to put \" + kb.statementsMatching(undefined, undefined, undefined, there)); //@@\n\n      const agenda: Function[] = []\n\n      let f //   @@ This needs some form of visible progress bar\n      for (f = 0; f < toBeCopied.length; f++) {\n        const item = toBeCopied[f]\n        const fun = function copyItem (item: any) {\n          agenda.push(function () {\n            const newURI = newBase + item.local\n            console.log('Copying ' + base + item.local + ' to ' + newURI)\n\n            const setThatACL = function () {\n              setACL(newURI, false, function (ok: boolean, message: string) {\n                if (!ok) {\n                  complainIfBad(\n                    ok,\n                    'FAILED to set ACL ' + newURI + ' : ' + message\n                  )\n                  console.log('FAILED to set ACL ' + newURI + ' : ' + message)\n                } else {\n                  agenda.shift()!() // beware too much nesting\n                }\n              })\n            }\n            if (!store.fetcher) {\n              throw new Error('Store has no fetcher')\n            }\n            store.fetcher\n              .webCopy(\n                base + item.local,\n                newBase + item.local,\n                item.contentType\n              )\n              .then(() => authn.checkUser())\n              .then(webId => {\n                me = webId\n\n                setThatACL()\n              })\n              .catch(err => {\n                console.log(\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n                complainIfBad(\n                  false,\n                  'FAILED to copy ' + base + item.local + ' : ' + err.message\n                )\n              })\n          })\n        }\n        fun(item)\n      }\n\n      agenda.push(function createNewPadDataFile () {\n        store.add(newInstance, ns.rdf('type'), PAD('Notepad'), newPadDoc)\n\n        // TODO @@ Remove casting of add\n        store.add(\n          newInstance,\n          ns.dc('created'),\n          new Date() as any, // @@ TODO Remove casting\n          newPadDoc\n        )\n        if (me) {\n          store.add(newInstance, ns.dc('author'), me, newPadDoc)\n        }\n        store.add(newInstance, PAD('next'), newInstance, newPadDoc) // linked list empty\n\n        // Keep a paper trail   @@ Revisit when we have non-public ones @@ Privacy\n        store.add(newInstance, ns.space('inspiration'), thisInstance, padDoc)\n        store.add(newInstance, ns.space('inspiration'), thisInstance, newPadDoc)\n        if (!updater) {\n          throw new Error('Have no updater')\n        }\n        updater.put(\n          newPadDoc,\n          store.statementsMatching(undefined, undefined, undefined, newPadDoc),\n          'text/turtle',\n          function (_uri2, ok, message) {\n            if (ok) {\n              agenda.shift()!()\n            } else {\n              complainIfBad(\n                ok,\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n              console.log(\n                'FAILED to save new notepad at: ' +\n                  newPadDoc.uri +\n                  ' : ' +\n                  message\n              )\n            }\n          }\n        )\n      })\n\n      agenda.push(function () {\n        setACL(newPadDoc.uri, true, function (ok: boolean, body: string) {\n          complainIfBad(\n            ok,\n            'Failed to set Read-Write ACL on pad data file: ' + body\n          )\n          if (ok) agenda.shift()!()\n        })\n      })\n\n      agenda.push(function () {\n        // give the user links to the new app\n\n        const p = div.appendChild(dom.createElement('p'))\n        p.setAttribute('style', 'font-size: 140%;')\n        p.innerHTML =\n          \"Your <a href='\" +\n          newIndexDoc.uri +\n          \"'><b>new notepad</b></a> is ready. \" +\n          \"<br/><br/><a href='\" +\n          newIndexDoc.uri +\n          \"'>Go to new pad</a>\"\n      })\n\n      agenda.shift()!()\n      // Created new data files.\n    }\n\n    //  Update on incoming changes\n    const showResults = function (exists: boolean) {\n      console.log('showResults()')\n\n      me = authn.currentUser()\n\n      authn.checkUser().then((webId: unknown) => {\n        me = webId as string\n      })\n\n      const title =\n        store.any(subject, ns.dc('title')) || store.any(subject, ns.vcard('fn'))\n      if (paneOptions.solo && typeof window !== 'undefined' && title) {\n        window.document.title = title.value\n      }\n      options.exists = exists\n      padEle = pad.notepad(dom, padDoc, subject, me, options)\n      naviMain.appendChild(padEle)\n\n      const partipationTarget =\n        store.any(subject, ns.meeting('parentMeeting')) || subject\n      pad.manageParticipation(\n        dom,\n        naviMiddle2,\n        padDoc,\n        partipationTarget as any,\n        me,\n        options\n      )\n      if (!store.updater) {\n        throw new Error('Store has no updater')\n      }\n\n      store.updater.setRefreshHandler(padDoc, padEle.reloadAndSync) // initiated =\n    }\n\n    // Read or create empty data file\n    const loadPadData = function () {\n      if (!fetcher) {\n        throw new Error('Have no fetcher')\n      }\n      fetcher.nowOrWhenFetched(padDoc.uri, undefined, function (\n        ok: boolean,\n        body: string,\n        response: any\n      ) {\n        if (!ok) {\n          if (response.status === 404) {\n            // /  Check explicitly for 404 error\n            console.log('Initializing results file ' + padDoc)\n            if (!updater) {\n              throw new Error('Have no updater')\n            }\n            updater.put(padDoc, [], 'text/turtle', function (\n              _uri2,\n              ok,\n              message\n            ) {\n              if (ok) {\n                clearElement(naviMain)\n                showResults(false)\n              } else {\n                complainIfBad(\n                  ok,\n                  'FAILED to create results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n                console.log(\n                  'FAILED to craete results file at: ' +\n                    padDoc.uri +\n                    ' : ' +\n                    message\n                )\n              }\n            })\n          } else {\n            // Other error, not 404 -- do not try to overwite the file\n            complainIfBad(ok, 'FAILED to read results file: ' + body)\n          }\n        } else {\n          // Happy read\n          clearElement(naviMain)\n          if (store.holds(subject, ns.rdf('type'), ns.wf('TemplateInstance'))) {\n            showBootstrap(subject, naviMain, 'pad')\n          }\n          showResults(true)\n          naviMiddle3.appendChild(newInstanceButton())\n        }\n      })\n    }\n\n    //  Body of Pane\n    var appPathSegment = 'app-pad.timbl.com' // how to allocate this string and connect to\n\n    const fetcher = store.fetcher\n    const updater = store.updater\n    let me: any\n\n    var PAD = Namespace('http://www.w3.org/ns/pim/pad#')\n\n    var thisInstance = subject\n    var padDoc = subject.doc()\n\n    let padEle\n\n    var div = dom.createElement('div')\n\n    //  Build the DOM\n    const structure = div.appendChild(dom.createElement('table')) // @@ make responsive style\n    structure.setAttribute(\n      'style',\n      'background-color: white; min-width: 94%; margin-right:3% margin-left: 3%; min-height: 13em;'\n    )\n\n    const naviLoginoutTR = structure.appendChild(dom.createElement('tr'))\n    naviLoginoutTR.appendChild(dom.createElement('td')) // naviLoginout1\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n    naviLoginoutTR.appendChild(dom.createElement('td'))\n\n    const naviTop = structure.appendChild(dom.createElement('tr')) // stuff\n    var naviMain = naviTop.appendChild(dom.createElement('td'))\n    naviMain.setAttribute('colspan', '3')\n\n    const naviMiddle = structure.appendChild(dom.createElement('tr')) // controls\n    const naviMiddle1 = naviMiddle.appendChild(dom.createElement('td'))\n    var naviMiddle2 = naviMiddle.appendChild(dom.createElement('td'))\n    var naviMiddle3 = naviMiddle.appendChild(dom.createElement('td'))\n\n    const naviStatus = structure.appendChild(dom.createElement('tr')) // status etc\n    const statusArea = naviStatus.appendChild(dom.createElement('div'))\n\n    const naviSpawn = structure.appendChild(dom.createElement('tr')) // create new\n    var spawnArea = naviSpawn.appendChild(dom.createElement('div'))\n\n    const naviMenu = structure.appendChild(dom.createElement('tr'))\n    naviMenu.setAttribute('class', 'naviMenu')\n    // naviMenu.setAttribute('style', 'margin-top: 3em;');\n    naviMenu.appendChild(dom.createElement('td')) // naviLeft\n    naviMenu.appendChild(dom.createElement('td'))\n    naviMenu.appendChild(dom.createElement('td'))\n\n    var options: any = { statusArea: statusArea, timingArea: naviMiddle1 }\n\n    loadPadData()\n\n    return div\n  }\n}\n// ends\n\nexport default paneDef\n"],"file":"padPane.js"}