{"version":3,"sources":["../../src/profile/editProfile.view.ts"],"names":["highlightColor","style","editProfileView","global","icon","icons","iconBase","name","label","render","subject","context","dom","store","session","complainIfBad","ok","mess","div","appendChild","widgets","errorMessageBlock","renderProfileForm","preferencesForm","preferencesFormDoc","doc","holds","undefined","preferencesFormText","uri","appendForm","editableProfile","createElement","setAttribute","table","main","bottom","statusArea","comment","str","p","textContent","heading","h","profileContext","me","authn","logInLoadProfile","then","loggedInContext","profile","updater","Error","any","ns","solid","editable","attachmentList","modify","predicate","foaf","noun","error"],"mappings":"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","sourcesContent":["/**\n * Profile Editing App Pane\n *\n * Unlike view panes, this is available any place whatever the real subject,\n * and allows the user to edit their own profile.\n *\n * Usage: paneRegistry.register('profile/profilePane')\n * or standalone script adding onto existing mashlib.\n */\n\nimport { authn, icons, ns, style, widgets } from 'solid-ui'\n\nimport { NamedNode, parse, sym, Store } from 'rdflib'\n\nimport preferencesFormText from './preferencesFormText.ttl'\nimport { PaneDefinition } from 'pane-registry'\nimport { paneDiv } from './profile.dom'\n\nconst highlightColor = style.highlightColor || '#7C4DFF'\n\nconst editProfileView: PaneDefinition = {\n  global: true,\n\n  icon: icons.iconBase + 'noun_492246.svg',\n\n  name: 'editProfile',\n\n  label: () => null,\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const store = context.session.store as Store\n\n    function complainIfBad (ok: Boolean, mess: any) {\n      if (ok) return\n      div.appendChild(widgets.errorMessageBlock(dom, mess, '#fee'))\n    }\n\n    function renderProfileForm (div: HTMLElement, subject: NamedNode) {\n      const preferencesForm = sym('https://solid.github.io/solid-panes/dashboard/profileStyle.ttl#this')\n      const preferencesFormDoc = preferencesForm.doc()\n      if (!store.holds(undefined, undefined, undefined, preferencesFormDoc)) {\n        // If not loaded already\n        parse(preferencesFormText, store, preferencesFormDoc.uri, 'text/turtle', () => null) // Load form directly\n      }\n\n      widgets.appendForm(\n        dom,\n        div,\n        {},\n        subject,\n        preferencesForm,\n        editableProfile,\n        complainIfBad\n      )\n    } // renderProfileForm\n\n    const div = dom.createElement('div')\n    let editableProfile: NamedNode | null\n    div.setAttribute('style', `border: 0.3em solid ${highlightColor}; border-radius: 0.5em; padding: 0.7em; margin-top:0.7em;`)\n\n    const table = div.appendChild(dom.createElement('table'))\n    // const top = table.appendChild(dom.createElement('tr'))\n    const main = table.appendChild(dom.createElement('tr'))\n    const bottom = table.appendChild(dom.createElement('tr'))\n    const statusArea = bottom.appendChild(dom.createElement('div'))\n    statusArea.setAttribute('style', 'padding: 0.7em;')\n\n    function comment (str: string) {\n      const p = main.appendChild(dom.createElement('p'))\n      p.setAttribute('style', 'padding: 1em;')\n      p.textContent = str\n      return p\n    }\n\n    function heading (str: string) {\n      const h = main.appendChild(dom.createElement('h3'))\n      h.setAttribute('style', 'color:' + highlightColor + ';')\n      h.textContent = str\n      return h\n    }\n\n    const profileContext = {\n      dom: dom,\n      div: main,\n      statusArea: statusArea,\n      me: null\n    }\n    authn.logInLoadProfile(profileContext)\n      .then(loggedInContext => {\n        const me = loggedInContext.me!\n\n        heading('Edit your public profile')\n\n        const profile = me.doc()\n        if (!store.updater) {\n          throw new Error('Store has no updater')\n        }\n        if (store.any(me, ns.solid('editableProfile'))) {\n          editableProfile = store.any(me as any, ns.solid('editableProfile')) as NamedNode\n        } else if (store.updater.editable(profile.uri, store)) {\n          editableProfile = profile\n        } else {\n          statusArea.appendChild(widgets.errorMessageBlock(dom, `⚠️ Your profile ${profile} is not editable, so we cannot do much here.`, 'straw'))\n          return\n        }\n\n        comment(`Everything you put here will be public.\n        There will be other places to record private things.`)\n\n        heading('Your contact information')\n\n        main.appendChild(paneDiv(context, me, 'contact'))\n\n        heading('People you know who have WebIDs')\n\n        comment(`This is your public social network.\n        Only put people here to whom you are happy to be publicly connected.\n        (You can always keep private track of friends and family in your contacts.)`)\n\n        // TODO: would be useful to explain what it means to \"drag people\"\n        //       what is it that is being dragged?\n        //       is there a way to search for people (or things to drag) on this page?\n        if (editableProfile) {\n          comment('Drag people onto the target below to add people.')\n        }\n\n        widgets.attachmentList(dom, me, main, {\n          doc: profile,\n          modify: !!editableProfile,\n          predicate: ns.foaf('knows'),\n          noun: 'friend'\n        })\n\n        heading('The style of your public profile')\n        renderProfileForm(main, me)\n\n        heading('Thank you for filling your profile.')\n      })\n      .catch(error => {\n        statusArea.appendChild(widgets.errorMessageBlock(dom, error, '#fee'))\n      })\n    return div\n  }\n}\n\nexport default editProfileView\n"],"file":"editProfile.view.js"}