{"version":3,"sources":["../../src/attach/attachPane.js"],"names":["UI","require","$rdf","module","exports","icon","icons","iconBase","name","label","subject","context","kb","session","store","t","findTypeURIs","QU","Namespace","WF","uri","findSuperClassesNT","holds","render","dom","complain","message","pre","createElement","setAttribute","div","appendChild","createTextNode","findStore","updater","editable","doc","any","esc","utils","escapeForXML","innerHTML","predicate","range","subjects","multi","options","currentMode","currentSubject","currentObject","objectType","getSortKeySimple","_c","uriMap","sym","ns","ui","getSortKey","c","k","sup","cl","fromNT","undefined","getMembersAndSort","sortBy","u","x","key","uriHash","findMemberURIs","pairs","hasOwnProperty","value","push","sort","reverse","i","length","objects","deselectObject","preview","showFiltered","mode","filtered","getFiltered","widgets","selectorPanelRefresh","objectList","showObject","linkClicked","filter","y","each","setAttachment","refresh","verb","linkDone3","ok","body","sts","st","update","event","inverse","s","o","showSubject","selected","subjectList","selectorPanel","fetcher","load","then","outliner","getOutliner","display","propertyTable","err","textContent","e","headerButtons","labels","intial","callback","head","current","tr","style0","style1","setStyles","buttons","b","listen","addEventListener","_e","setMode","wrapper","stores","storeURI","mintBox","storeLab","_event","thisForm","promptForNew","_body","insertBefore","nextSibling"],"mappings":"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","sourcesContent":["/*   Attachment Pane\n **\n ** - Attach a document to a thing\n **  - View attachments\n ** - Look at all unattached Supporting Documents.\n ** - Drag a document onto the pane to attach it @@\n **\n **\n */\n\nconst UI = require('solid-ui')\nconst $rdf = require('rdflib')\n\nmodule.exports = {\n  icon: UI.icons.iconBase + 'noun_25830.svg', // noun_25830\n\n  name: 'attachments',\n\n  // Does the subject deserve an attachments pane?\n  //\n  //  In this case we will render any thing which is in any subclass of\n  //  certain classes, or also the certain classes themselves, as a\n  //  triage tool for correlating many attachees with attachments.\n  // We also offer the pane for anything of any class which just has an attachment already.\n  //\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    if (\n      t['http://www.w3.org/ns/pim/trip#Trip'] || // If in any subclass\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      t['http://www.w3.org/2005/01/wf/flow#Task'] ||\n      t['http://www.w3.org/2000/10/swap/pim/qif#Transaction'] ||\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject) ||\n      kb.holds(subject, WF('attachment'))\n    ) {\n      return 'attachments'\n    }\n    return null\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const WF = $rdf.Namespace('http://www.w3.org/2005/01/wf/flow#')\n    const QU = $rdf.Namespace('http://www.w3.org/2000/10/swap/pim/qif#')\n\n    // ////////////////////////////////////////////////////////////////////////////\n\n    const complain = function complain (message) {\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', 'background-color: pink')\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n\n    // Where can we write about this thing?\n    //\n    // Returns term for document or null\n    const findStore = function (kb, subject) {\n      if (kb.updater.editable(subject.doc(), kb)) return subject.doc()\n      const store = kb.any(subject.doc(), QU('annotationStore'))\n      return store\n    }\n\n    var div = dom.createElement('div')\n    const esc = UI.utils.escapeForXML\n    div.setAttribute('class', 'attachPane')\n    div.innerHTML =\n      '<h1>' + esc(UI.utils.label(subject, true)) + ' attachments</h1>' //\n\n    const predicate = WF('attachment')\n    const range = QU('SupportingDocument')\n\n    let subjects, multi\n    const options = {}\n    let currentMode = 0 // 0 -> Show all;  1 -> Attached;    2 -> unattached\n    let currentSubject = null\n    let currentObject = null\n    const objectType = QU('SupportingDocument')\n\n    // Find all members of the class which we know about\n    // and sort them by an appropriate property.   @@ Move to library\n    //\n\n    const getSortKeySimple = function (_c) {\n      const uriMap = {\n        'http://www.w3.org/2005/01/wf/flow#Task': 'http://purl.org/dc/elements/1.1/created',\n        'http://www.w3.org/ns/pim/trip#Trip': 'http://www.w3.org/2002/12/cal/ical#dtstart',\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': 'http://www.w3.org/2000/10/swap/pim/qif#date',\n        'http://www.w3.org/2000/10/swap/pim/qif#SupportingDocument': 'http://purl.org/dc/elements/1.1/date'\n      }\n      const uri = uriMap[subject.uri]\n      return uri ? kb.sym(uri) : kb.any(subject, UI.ns.ui('sortBy'))\n    }\n\n    const getSortKey = function (c) {\n      let k = getSortKeySimple(c.uri)\n      if (k) return k\n      const sup = kb.findSuperClassesNT(c)\n      for (const cl in sup) {\n        // note unordered -- could be closest first\n        k = getSortKeySimple(kb.fromNT(cl).uri)\n        if (k) return k\n      }\n      return undefined // failure\n    }\n\n    const getMembersAndSort = function (subject) {\n      const sortBy = getSortKey(subject)\n      let u, x, key\n      const uriHash = kb.findMemberURIs(subject)\n      const pairs = []\n      const subjects = []\n      for (u in uriHash) {\n        // @@ TODO: Write away the need for exception on next line\n        // eslint-disable-next-line no-prototype-builtins\n        if (uriHash.hasOwnProperty(u)) {\n          x = kb.sym(u)\n          if (sortBy) {\n            key = kb.any(x, sortBy)\n            if (!key) {\n              // complain(\"No key \"+key+\" sortby \"+sortBy+\" for \"+x)\n              key = '8888-12-31'\n            } else {\n              key = key.value\n            }\n          } else {\n            complain('No sortby ' + sortBy + ' for ' + x)\n            key = '9999-12-31'\n          }\n          // key = (sortBy && kb.any(x, sortBy)) || kb.literal(\"9999-12-31\") // Undated appear future\n          // if (!key) complain(\"Sort: '\"+key+\"' No \"+sortBy+\" for \"+x) // Assume just not in this year\n          pairs.push([key, x])\n        }\n      }\n      pairs.sort()\n      pairs.reverse() // @@ Descending order .. made a toggle?\n      for (let i = 0; i < pairs.length; i++) {\n        subjects.push(pairs[i][1])\n      }\n      return subjects\n    }\n\n    // Set up a triage of many class members against documents or just one\n    if (\n      subject.uri === 'http://www.w3.org/ns/pim/trip#Trip' ||\n      QU('Transaction') in kb.findSuperClassesNT(subject)\n      // subject.uri == 'http://www.w3.org/2000/10/swap/pim/qif#Transaction'\n    ) {\n      multi = true\n      subjects = getMembersAndSort(subject)\n    } else {\n      currentSubject = subject\n      currentMode = 1 // Show attached only.\n      subjects = [subject]\n      multi = false\n    }\n\n    // var store = findStore(kb, subject)\n    // if (!store) complain(\"There is no annotation store for: \"+subject.uri)\n\n    // var objects = kb.each(undefined, ns.rdf('type'), range)\n    const objects = getMembersAndSort(range)\n    if (!objects) complain('objects:' + objects.length)\n\n    const deselectObject = function () {\n      currentObject = null\n      preview.innerHTML = ''\n    }\n\n    const showFiltered = function (mode) {\n      const filtered = mode === 0 ? objects : getFiltered()\n      // eslint-enable\n      UI.widgets.selectorPanelRefresh(\n        objectList,\n        dom,\n        kb,\n        objectType,\n        predicate,\n        true,\n        filtered,\n        options,\n        showObject,\n        linkClicked\n      )\n      if (filtered.length === 1) {\n        currentObject = filtered[0]\n        showObject(currentObject, null, true) // @@ (Sure?) if only one select it.\n      } else {\n        deselectObject()\n      }\n\n      function getFiltered () {\n        return mode === 1\n          ? currentSubject === null\n            ? objects.filter(y => !!kb.holds(undefined, predicate, y))\n            : objects.filter(y => !!kb.holds(currentSubject, predicate, y))\n          : objects.filter(y => kb.each(undefined, predicate, y).length === 0)\n      }\n    }\n\n    const setAttachment = function (x, y, value, refresh) {\n      if (kb.holds(x, predicate, y) === value) return\n      const verb = value ? 'attach' : 'detach'\n      // complain(\"Info: starting to \"+verb+\" \" + y.uri + \" to \"+x.uri+ \":\\n\")\n      const linkDone3 = function (uri, ok, body) {\n        if (ok) {\n          // complain(\"Success \"+verb+\" \"+y.uri+\" to \"+x.uri+ \":\\n\"+ body)\n          refresh()\n        } else {\n          complain(\n            'Error: Unable to ' +\n              verb +\n              ' ' +\n              y.uri +\n              ' to ' +\n              x.uri +\n              ':\\n' +\n              body\n          )\n        }\n      }\n\n      const store = findStore(kb, x)\n      if (!store) {\n        complain('There is no annotation store for: ' + x.uri)\n      } else {\n        const sts = [$rdf.st(x, predicate, y, store)]\n        if (value) {\n          kb.updater.update([], sts, linkDone3)\n        } else {\n          kb.updater.update(sts, [], linkDone3)\n        }\n      }\n    }\n\n    var linkClicked = function (x, event, inverse, refresh) {\n      let s, o\n      if (inverse) {\n        // Objectlist\n        if (!currentSubject) {\n          complain('No subject for the link has been selected')\n          return\n        } else {\n          s = currentSubject\n          o = x\n        }\n      } else {\n        // Subjectlist\n        if (!currentObject) {\n          complain('No object for the link has been selected')\n          return\n        } else {\n          s = x\n          o = currentObject\n        }\n      }\n      setAttachment(s, o, !kb.holds(s, predicate, o), refresh) // @@ toggle\n    }\n\n    // When you click on a subject, filter the objects connected to the subject in Mode 1\n    const showSubject = function (x, event, selected) {\n      if (selected) {\n        currentSubject = x\n      } else {\n        currentSubject = null\n        if (currentMode === 1) deselectObject()\n      } // If all are displayed, refresh would just annoy:\n      if (currentMode !== 0) showFiltered(currentMode) // Refresh the objects\n    }\n\n    if (multi) {\n      const subjectList = UI.widgets.selectorPanel(\n        dom,\n        kb,\n        subject,\n        predicate,\n        false,\n        subjects,\n        options,\n        showSubject,\n        linkClicked\n      )\n      subjectList.setAttribute(\n        'style',\n        'background-color: white;  width: 25em; height: 100%; padding: 0 em; overflow:scroll; float:left'\n      )\n      div.appendChild(subjectList)\n    }\n\n    var showObject = function (x, event, selected) {\n      if (!selected) {\n        deselectObject()\n        preview.innerHTML = '' // Clean out what is there\n        // complain(\"Show object \"+x.uri)\n        return\n      }\n      currentObject = x\n      try {\n        /*\n        var dispalyable = function (kb, x) {\n          var cts = kb.fetcher.getHeader(x, 'content-type')\n          if (cts) {\n            var displayables = ['text/html', 'image/png', 'application/pdf']\n            for (var j = 0; j < cts.length; j++) {\n              for (var k = 0; k < displayables.length; k++) {\n                if (cts[j].indexOf(displayables[k]) >= 0) {\n                  return true\n                }\n              }\n            }\n          }\n          return false\n        }\n        */\n        preview.innerHTML = 'Loading ....'\n        if (x.uri) {\n          kb.fetcher\n            .load(x.uri)\n            .then(() => {\n              const outliner = context.getOutliner(dom)\n              const display = outliner.propertyTable(x) //  ,table, pane\n              preview.innerHTML = ''\n              preview.appendChild(display)\n            })\n            .catch(err => {\n              preview.textContent = 'Error loading ' + x.uri + ': ' + err\n            })\n        }\n        /*\n              if (dispalyable(kb, x) || x.uri.slice(-4) == \".pdf\" || x.uri.slice(-4) == \".png\" || x.uri.slice(-5) == \".html\" ||\n                      x.uri.slice(-5) == \".jpeg\") { // @@@@@@ MAJOR KLUDGE! use metadata after HEAD\n                  preview.innerHTML = '<iframe height=\"100%\" width=\"100%\"src=\"'\n                      + x.uri + '\">' + x.uri + '</iframe>'\n              } else {\n              }\n          */\n      } catch (e) {\n        preview.innerHTML =\n          '<span style=\"background-color: pink;\">' + 'Error:' + e + '</span>' // @@ enc\n      }\n    }\n\n    div.setAttribute(\n      'style',\n      'background-color: white; width:40cm; height:20cm;'\n    )\n\n    const headerButtons = function (dom, labels, intial, callback) {\n      const head = dom.createElement('table')\n      let current = intial\n      head.setAttribute(\n        'style',\n        'float: left; width: 30em; padding: 0.5em; height: 1.5em; background-color: #ddd; color: #444; font-weight: bold'\n      )\n      const tr = dom.createElement('tr')\n      const style0 = 'border-radius: 0.6em; text-align: center;'\n      const style1 = style0 + 'background-color: #ccc; color: black;'\n      head.appendChild(tr)\n      const setStyles = function () {\n        for (i = 0; i < labels.length; i++) {\n          buttons[i].setAttribute('style', i === current ? style1 : style0)\n        }\n      }\n      let i, b\n      var buttons = []\n      for (i = 0; i < labels.length; i++) {\n        b = buttons[i] = dom.createElement('td')\n        b.textContent = labels[i]\n        tr.appendChild(buttons[i])\n        const listen = function (b, i) {\n          b.addEventListener('click', function (_e) {\n            current = i\n            setStyles()\n            callback(i)\n          })\n        }\n        listen(b, i)\n      }\n      setStyles()\n      return head\n    }\n\n    const setMode = function (mode) {\n      if (mode !== currentMode) {\n        currentMode = mode\n        deselectObject()\n        showFiltered(mode)\n      }\n    }\n\n    const wrapper = dom.createElement('div')\n    wrapper.setAttribute(\n      'style',\n      ' width: 30em; height: 100%;  padding: 0em; float:left;'\n    )\n    // wrapper.appendChild(head)\n    div.appendChild(wrapper)\n    wrapper.appendChild(\n      headerButtons(\n        dom,\n        ['all', 'attached', 'not attached'],\n        currentMode,\n        setMode\n      )\n    )\n\n    var objectList = UI.widgets.selectorPanel(\n      dom,\n      kb,\n      objectType,\n      predicate,\n      true,\n      objects,\n      options,\n      showObject,\n      linkClicked\n    )\n    objectList.setAttribute(\n      'style',\n      'background-color: #ffe;  width: 30em; height: 100%; padding: 0em; overflow:scroll;'\n    ) // float:left\n    wrapper.appendChild(objectList)\n\n    // objectList.insertBefore(head, objectList.firstChild)\n\n    var preview = dom.createElement('div')\n    preview.setAttribute(\n      'style',\n      /* background-color: black; */ 'padding: 0em; margin: 0;  height: 100%; overflow:scroll;'\n    )\n    div.appendChild(preview)\n    showFiltered(currentMode)\n\n    if (subjects.length > 0 && multi) {\n      const stores = {}\n      for (let k = 0; k < subjects.length; k++) {\n        const store = findStore(kb, subjects[k])\n        if (store) stores[store.uri] = subjects[k]\n        // if (!store) complain(\"No store for \"+subjects[k].uri)\n      }\n      for (const storeURI in stores) {\n        // var store = findStore(kb,subjects[subjectList.length-1])\n        const store = kb.sym(storeURI)\n        var mintBox = dom.createElement('div')\n        mintBox.setAttribute(\n          'style',\n          'clear: left; width: 20em; margin-top:2em; background-color:#ccc; border-radius: 1em; padding: 1em; font-weight: bold;'\n        )\n        mintBox.textContent = '+ New ' + UI.utils.label(subject)\n\n        mintBox.textContent += ' in ' + UI.utils.label(store)\n        const storeLab = dom.createElement('span')\n        storeLab.setAttribute(\n          'style',\n          'font-weight: normal; font-size: 80%; color: #777;'\n        )\n        storeLab.textContent = storeURI\n        mintBox.appendChild(dom.createElement('br'))\n        mintBox.appendChild(storeLab)\n        /*\n        var mintButton = dom.createElement('img')\n        mintBox.appendChild(mintButton)\n        mintButton.setAttribute('src', ...); @@ Invokes master handler\n        */\n        mintBox.addEventListener(\n          'click',\n          function (_event) {\n            const thisForm = UI.widgets.promptForNew(\n              dom,\n              kb,\n              subject,\n              predicate,\n              subject,\n              null,\n              store,\n              function (ok, _body) {\n                if (!ok) {\n                  // callback(ok, body); // @@ if ok, need some form of refresh of the select for the new thing\n                } else {\n                  // Refresh @@\n                }\n              }\n            )\n            try {\n              div.insertBefore(thisForm, mintBox.nextSibling) // Sigh no insertAfter\n            } catch (e) {\n              div.appendChild(thisForm)\n            }\n            // var newObject = thisForm.AJAR_subject\n          },\n          false\n        )\n        div.appendChild(mintBox)\n      }\n    }\n\n    // if (!me) complain(\"(You do not have your Web Id set. Set your Web ID to make changes.)\")\n\n    return div\n  }\n} // pane object\n\n// ends\n"],"file":"attachPane.js"}