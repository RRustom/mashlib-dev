{"version":3,"sources":["../../src/outline/dragDrop.js"],"names":["UI","require","$rdf","dragAndDrop","module","exports","util","Event","listeners","on","el","sType","fn","obj","fnId","wrappedFn","e","call","addEventListener","li","push","off","index","_getCacheIndex","cacheItem","removeEventListener","WFN","FN","splice","EL","TYPE","FNID","i","len","length","DDExternalProxy","initTarget","prototype","DDM","b4StartDrag","x","y","TabulatorOutlinerObserver","onDragStart","b4Drag","_e","handleMouseDown","_oDD","button","which","oDD","dragCurrent","startX","pageX","startY","pageY","deltaX","offsetLeft","deltaY","offsetTop","dragThreshMet","handleMouseMove","isIE","log","stopEvent","handleMouseUp","diffX","Math","abs","diffY","clickPixelThresh","startDrag","preventDefault","onDropInside","target","onDrop","aXferData","_dragSession","selection","utils","ancestor","originalTarget","parentNode","outline","contentType","flavour","url","transferUtils","retrieveURLFromData","data","fileSize","templateDoc","sym","store","copyTo","targetTd","table","thisOutline","UserInput","insertTermTo","onDragEnter","tabulatorSelect","tabulatorDeselect","Error","onDragExit","ownerDocument","getElementById","getAbout","dragTarget","td","kDSIID","Components","interfaces","nsIDragService","dragAction","action","DRAGDROP_ACTION_COPY","DRAGDROP_ACTION_MOVE","DRAGDROP_ACTION_LINK","tdBox","getBoxObjectFor","region","classes","createInstance","nsIScriptableRegion","init","unionRect","screenX","screenY","width","height","transferDataSet","term","Util","getTerm","termType","URItoTransferDataSet","uri","toNT","value","transArray","nsISupportsArray","trans","nsTransferable","set","dataList","AppendElement","QueryInterface","nsISupports","mDragService","invokeDragSession","getSupportedFlavours","flavourSet","FlavourSet","appendFlavour","dataSet","TransferDataSet","TransferData","addDataForFlavour","_mDS","get_mDragService","kDSContractID","getService"],"mappings":"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","sourcesContent":["/* istanbul ignore file */\n/**\n    This is for outliner features that only work in the extension version, say drag and drop.\n    I am always happy creating new files.\n                                                             2007.07.11  kennyluck\n    2017: Todo: Repace the old Firefox specific code with HTML5 standard code - timbl\n**/\n// Firefox internals:\n/* global Components TransferData TransferDataSet FlavourSet nsTransferable transferUtils */\n\n// #includedIn chrome://tabulator/tabulator.xul\n// #require_once chrome://global/nsDragAndDrop.js\n\n/* alert(gBrowser);alert(gBrowser.tagName)\nif (!tabulator_gBrowser) {\n    var tabulator_wm = Components.classes[\"@mozilla.org/appshell/window-mediator;1\"]\n               .getService(Components.interfaces.nsIWindowMediator)\n    var tabulator_gBrowser = tabulator_wm.getMostRecentWindow(\"navigator:browser\")\n}\n*/\n\n/* 2007: adapted from dragAndDrop UI Library */\n\nconst UI = require('solid-ui')\nconst $rdf = require('rdflib')\nconst dragAndDrop = (module.exports = {})\n\ndragAndDrop.util = {}\ndragAndDrop.util.Event = (function () {\n  const listeners = []\n  return {\n    on: function (el, sType, fn, obj, fnId /* ,override */) {\n      const wrappedFn = function (e) {\n        return fn.call(obj, e, obj)\n      }\n      el.addEventListener(sType, wrappedFn, false)\n      const li = [el, sType, fnId, wrappedFn]\n      listeners.push(li)\n    },\n    off: function (el, sType, fnId) {\n      // removeListener, fnId to identify a function\n      const index = this._getCacheIndex(el, sType, fnId)\n      if (index === -1) return false\n      const cacheItem = listeners[index]\n      el.removeEventListener(sType, cacheItem[this.WFN], false)\n\n      delete listeners[index][this.WFN]\n      delete listeners[index][this.FN]\n      listeners.splice(index, 1)\n      return true\n    },\n    EL: 0,\n    TYPE: 1,\n    FNID: 2,\n    WFN: 3,\n    _getCacheIndex: function (el, sType, fnId) {\n      for (let i = 0, len = listeners.length; i < len; ++i) {\n        const li = listeners[i]\n        if (\n          li &&\n          li[this.FNID] === fnId &&\n          li[this.EL] === el &&\n          li[this.TYPE] === sType\n        ) {\n          return i\n        }\n      }\n\n      return -1\n    }\n  }\n})()\ndragAndDrop.util.DDExternalProxy = function DDExternalProxy (el) {\n  this.initTarget(el)\n  // dragAndDrop.util.Event.on(this.el, \"mousedown\", this.handleMouseDown, this, 'dragMouseDown'/*, true*/)\n}\n// dragAndDrop.util.DDExternalProxy extends dragAndDrop.utilDDProxy\ndragAndDrop.util.DDExternalProxy.prototype = {\n  initTarget: function (el) {\n    // create a local reference to the drag and drop manager\n    this.DDM = dragAndDrop.util.DDM\n\n    // set the el\n    this.el = el\n\n    /*\n    // We don't want to register this as the handle with the manager\n    // so we just set the id rather than calling the setter.\n    this.handleElId = id\n\n    Event.onAvailable(id, this.handleOnAvailable, this, true)\n    */\n\n    // the linked element is the element that gets dragged by default\n    // this.setDragElId(id)\n\n    // by default, clicked anchors will not start drag operations.\n    // @TODO what else should be here?  Probably form fields.\n    // this.invalidHandleTypes = { A: \"A\" }\n    // this.invalidHandleIds = {}\n    // this.invalidHandleClasses = []\n\n    // this.applyConfig()\n  },\n  b4StartDrag: function (x, y) {\n    // show the drag frame\n    // this.logger.log(\"start drag show frame, x: \" + x + \", y: \" + y)\n    // alert(\"test startDrag\")\n    TabulatorOutlinerObserver.onDragStart(x, y, this.el)\n    // this.showFrame(x, y)\n  },\n  b4Drag: function (_e) {\n    // this.setDragElPos(dragAndDrop.util.Event.getPageX(e),\n    //                    dragAndDrop.util.Event.getPageY(e))\n  },\n  handleMouseDown: function (e, _oDD) {\n    const button = e.which || e.button\n    if (button > 1) return\n\n    // firing the mousedown events prior to calculating positions\n    // this.b4MouseDown(e)\n    // this.onMouseDown(e)\n\n    // this.DDM.refreshCache(this.groups)\n    // var self = this\n    // setTimeout( function() { self.DDM.refreshCache(self.groups); }, 0)\n\n    // Only process the event if we really clicked within the linked\n    // element.  The reason we make this check is that in the case that\n    // another element was moved between the clicked element and the\n    // cursor in the time between the mousedown and mouseup events. When\n    // this happens, the element gets the next mousedown event\n    // regardless of where on the screen it happened.\n    // var pt = new dragAndDrop.util.Point(Event.getPageX(e), Event.getPageY(e))\n    // if (!this.hasOuterHandles && !this.DDM.isOverTarget(pt, this) )  {\n    //        this.logger.log(\"Click was not over the element: \" + this.id)\n    // } else {\n    //    if (this.clickValidator(e)) {\n\n    // set the initial element position\n    // this.setStartPosition()\n\n    // start tracking mousemove distance and mousedown time to\n    // determine when to start the actual drag\n    this.DDM.handleMouseDown(e, this)\n\n    // this mousedown is mine\n    // this.DDM.stopEvent(e)\n    //    } else {\n\n    // this.logger.log(\"clickValidator returned false, drag not initiated\")\n\n    //    }\n    // }\n  }\n}\n\ndragAndDrop.util.DDM = (function DDM () {\n  return {\n    handleMouseDown: function (e, oDD) {\n      // this.currentTarget = dragAndDrop.util.Event.getTarget(e)\n\n      this.dragCurrent = oDD\n\n      const el = oDD.el\n\n      // track start position\n      this.startX = e.pageX\n      this.startY = e.pageY\n\n      this.deltaX = this.startX - el.offsetLeft\n      this.deltaY = this.startY - el.offsetTop\n\n      this.dragThreshMet = false\n\n      // this.clickTimeout = setTimeout(\n      //        function() {\n      //            var DDM = dragAndDrop.util.DDM\n      //            DDM.startDrag(DDM.startX, DDM.startY)\n      //        },\n      //        this.clickTimeThresh )\n      // dragAndDrop.util.Event.on(el,'mousemove',this.handleMouseMove,this,'dragMouseMove')\n      // dragAndDrop.util.Event.on(el,'mouseup'  ,this.handleMouseUp  ,this,'dragMouseUp')\n    },\n\n    handleMouseMove: function (e) {\n      // dragAndDrop.log(\"handlemousemove\")\n      if (!this.dragCurrent) {\n        // dragAndDrop.log(\"no current drag obj\")\n        return true\n      }\n      // var button = e.which || e.button\n      // dragAndDrop.log(\"which: \" + e.which + \", button: \"+ e.button)\n\n      // check for IE mouseup outside of page boundary\n      if (dragAndDrop.util.Event.isIE && !e.button) {\n        dragAndDrop.log('button failure', 'info', 'DragDropMgr')\n        this.stopEvent(e)\n        return this.handleMouseUp(e)\n      }\n\n      if (!this.dragThreshMet) {\n        const diffX = Math.abs(this.startX - e.pageX)\n        const diffY = Math.abs(this.startY - e.pageY)\n        // dragAndDrop.log(\"diffX: \" + diffX + \"diffY: \" + diffY)\n        if (diffX > this.clickPixelThresh || diffY > this.clickPixelThresh) {\n          // dragAndDrop.log(\"pixel threshold met\", \"info\", \"DragDropMgr\")\n          this.startDrag(this.startX, this.startY)\n        }\n      }\n\n      if (this.dragThreshMet) {\n        // this.dragCurrent.b4Drag(e)\n        // this.dragCurrent.onDrag(e)\n        // this.fireEvents(e, false)\n      }\n\n      e.preventDefault()\n      // this.stopEvent(e)\n\n      return true\n    },\n    handleMouseUp: function (e) {\n      if (!this.dragCurrent) return // Error...\n      dragAndDrop.util.Event.off(\n        this.dragCurrent.el,\n        'mousemove',\n        'dragMouseMove'\n      )\n      // there are two mouseup for unknown reason...\n      dragAndDrop.util.Event.off(this.dragCurrent.el, 'mouseup', 'dragMouseUp')\n      dragAndDrop.util.Event.off(this.dragCurrent.el, 'mouseup', 'dragMouseUp')\n      // have to do this as attribute ondragdrop does not recognize any dragdrop event\n      // initialized inside <tabbrowser> (strange, I think)\n      if (this.dragThreshMet) {\n        TabulatorOutlinerObserver.onDropInside(e.target)\n        this.dragThreshMet = false\n      }\n      this.dragCurrent = null\n    },\n    startDrag: function (x, y) {\n      // dragAndDrop.log(\"firing drag start events\", \"info\", \"DragDropMgr\")\n      // clearTimeout(this.clickTimeout)\n      if (this.dragCurrent) {\n        this.dragCurrent.b4StartDrag(x, y)\n        // this.dragCurrent.startDrag(x, y)\n      }\n      this.dragThreshMet = true\n    },\n    clickPixelThresh: 3\n  }\n})()\n\n// ToDos\n// 1.Recover normal funtionality\n// 2.Investigate into Gecko drag and drop\n// 3.Cross Tag Drag And Drop\n// 4.Firefox native rdf store\nvar TabulatorOutlinerObserver = {\n  onDrop: function (e, aXferData, _dragSession) {\n    const selection = UI.utils.ancestor(\n      UI.utils.ancestor(e.originalTarget, 'TABLE').parentNode,\n      'TABLE'\n    ).outline.selection\n    const contentType = aXferData.flavour.contentType\n    const url = transferUtils.retrieveURLFromData(aXferData.data, contentType)\n    if (!url) return\n    if (contentType === 'application/x-moz-file') {\n      if (aXferData.data.fileSize === 0) {\n        const templateDoc = $rdf.sym(\n          'chrome://tabulator/content/internalKnowledge.n3#defaultNew'\n        )\n        UI.store.copyTo(templateDoc, $rdf.sym(url))\n        /*\n      function WriteToFileRepresentedBy (subject){\n          var outputFormulaTerm=kb.any(subject,OWL('unionOf'))\n          var theClass =  kb.constructor.SuperClass\n          var outputFormula= theClass.instances[kb.the(outputFormulaTerm,tabont('accesskey')).value]\n      }\n      */\n      }\n    }\n    const targetTd = selection[0]\n    const table = UI.utils.ancestor(\n      UI.utils.ancestor(targetTd, 'TABLE').parentNode,\n      'TABLE'\n    )\n    const thisOutline = table.outline\n    thisOutline.UserInput.insertTermTo(targetTd, $rdf.sym(url))\n  },\n\n  onDragEnter: function (e, _dragSession) {\n    // enter or exit something\n    try {\n      var selection = UI.utils.ancestor(\n        UI.utils.ancestor(e.originalTarget, 'TABLE').parentNode,\n        'TABLE'\n      ).outline.selection\n    } catch (e) {\n      /* because e.orginalTarget is not defined */ return\n    }\n    for (\n      let targetTd = e.originalTarget;\n      targetTd;\n      targetTd = targetTd.parentNode\n    ) {\n      if (targetTd.tabulatorSelect) {\n        if (selection[0]) {\n          try {\n            selection[0].tabulatorDeselect()\n          } catch (e) {\n            throw new Error(selection[0] + ' causes ' + e)\n          }\n          dragAndDrop.util.Event.off(targetTd, 'mouseup', 'dragMouseUp')\n        }\n        targetTd.tabulatorSelect()\n        // dragAndDrop.util.Event.on(targetTd,'mouseup',this.DDM.handleMouseUp,this.DDM,'dragMouseUp')\n        break\n      }\n    }\n  },\n\n  onDragExit: function (_e, _dragSession) {\n    // if (e.originalTarget.tabulatorDeselect) e.originalTarget.tabulatorDeselect()\n  },\n  onDropInside: function (targetTd) {\n    // a special case that you draganddrop totally inside a <tabbrowser>\n    // var selection = ancestor(ancestor(targetTd,'TABLE').parentNode,'TABLE').outline.selection\n    // var targetTd=selection[0]\n    const table = targetTd.ownerDocument.getElementById('outline')\n    // var table=ancestor(ancestor(targetTd,'TABLE').parentNode,'TABLE')\n    const thisOutline = table.outline\n    thisOutline.UserInput.insertTermTo(\n      targetTd,\n      UI.utils.getAbout(UI.store, this.dragTarget)\n    )\n  },\n  onDragStart: function (x, y, td) {\n    /* seeAlso nsDragAndDrop.js::nsDragAndDrop.startDrag */\n    // ToDo for myself: understand the connections in firefox, x, screenX\n\n    this.dragTarget = td\n    const kDSIID = Components.interfaces.nsIDragService\n    const dragAction = {\n      action:\n        kDSIID.DRAGDROP_ACTION_COPY +\n        kDSIID.DRAGDROP_ACTION_MOVE +\n        kDSIID.DRAGDROP_ACTION_LINK\n    }\n\n    // alert(td.ownerDocument.getBoxObjectFor(td))\n    // alert(td.ownerDocument.getBoxObjectFor(td).screenX)\n    const tdBox = td.ownerDocument.getBoxObjectFor(td) // nsIBoxObject\n    const region = Components.classes['@mozilla.org/gfx/region;1'].createInstance(\n      Components.interfaces.nsIScriptableRegion\n    )\n    region.init() // this is important\n    region.unionRect(tdBox.screenX, tdBox.screenY, tdBox.width, tdBox.height)\n    let transferDataSet = { data: null }\n    const term = UI.Util.getTerm(td)\n    switch (term.termType) {\n      case 'NamedNode':\n        transferDataSet.data = this.URItoTransferDataSet(term.uri)\n        break\n      case 'BlankNode':\n        transferDataSet.data = this.URItoTransferDataSet(term.toNT())\n        break\n      case 'Literal':\n        transferDataSet.data = this.URItoTransferDataSet(term.value)\n        break\n    }\n\n    transferDataSet = transferDataSet.data // quite confusing, anyway...\n    const transArray = Components.classes[\n      '@mozilla.org/supports-array;1'\n    ].createInstance(Components.interfaces.nsISupportsArray)\n    const trans = nsTransferable.set(transferDataSet.dataList[0])\n    transArray.AppendElement(\n      trans.QueryInterface(Components.interfaces.nsISupports)\n    )\n    this.mDragService.invokeDragSession(\n      td,\n      transArray,\n      region,\n      dragAction.action\n    )\n  },\n  /*\n  onDragStart: function(aEvent,aXferData,aDragAction){\n      var dragTarget=ancestor(aEvent.target,'TD')\n      //var nt=dragTarget.getAttribute('about')\n      //ToDo:text terms\n      var term=getAbout(kb,dragTarget)\n      aXferData.data = this.URItoTransferDataSet(term.uri)\n      alert(\"start\")\n  },\n  */\n\n  getSupportedFlavours: function () {\n    const flavourSet = new FlavourSet()\n    // flavourSet.appendFlavour(\"text/rdfitem\")\n    // flavourSet.appendFlavour(\"moz/rdfitem\")\n    flavourSet.appendFlavour('text/x-moz-url')\n    flavourSet.appendFlavour('text/unicode')\n    flavourSet.appendFlavour('application/x-moz-file', 'nsIFile')\n    return flavourSet\n  },\n\n  URItoTransferDataSet: function (uri) {\n    const dataSet = new TransferDataSet()\n    const data = new TransferData()\n    data.addDataForFlavour('text/x-moz-url', uri)\n    data.addDataForFlavour('text/unicode', uri)\n    dataSet.push(data)\n    return dataSet\n  },\n  _mDS: null,\n  get_mDragService: function () {\n    // some syntax I don't understand -- was get mDragService()\n    if (!this._mDS) {\n      const kDSContractID = '@mozilla.org/widget/dragservice;1'\n      const kDSIID = Components.interfaces.nsIDragService\n      this._mDS = Components.classes[kDSContractID].getService(kDSIID)\n    }\n    return this._mDS\n  },\n  DDM: dragAndDrop.util.DDM\n}\n/*\nvar ondraging=false; //global variable indicating whether ondraging (better choice?)\nvar testGlobal = function test(e){alert(e.originalTarget);e.originalTarget.className='selected';e.preventDefault();}\nvar activateDrag = function (e){\n   if (!ondraging){\n       alert('activate test')\n       ondraging=true\n   }\n}\n*/\n// tabulator_gBrowser.setAttribute('ondragdrop','testGlobal(event)')\n// tabulator_gBrowser.setAttribute('ondragenter','activateDrag(event)')\n\n// gBrowser.addEventListener('dragdrop',test,true)\n"],"file":"dragDrop.js"}