{"version":3,"sources":["../../src/outline/manager.js"],"names":["context","dom","document","outlineIcons","labeller","LanguagePreference","outline","thisOutline","selection","ancestor","UI","utils","sparql","rdf","UpdateManager","kb","store","sf","fetcher","qs","queryByExample","QuerySource","UserInput","clipboardAddress","clipboardInit","outlineElement","init","table","getOutlineContainer","benchmark","lastkbsize","f","args","i","arguments","length","begin","Date","getTime","returnValue","apply","end","log","info","statements","appendRemoveIcon","node","subject","removeNode","image","AJARImage","src","icon_remove_node","undefined","addEventListener","removeNodeIconMouseDownListener","setAttribute","toNT","style","marginLeft","marginRight","appendChild","appendAccessIcons","obj","termType","uris","sort","last","appendAccessIcon","uri","docuri","docpart","slice","state","getState","icon","alt","listener","icon_unrequested","unrequestedIconMouseDownListener","icon_requested","failedIconMouseDownListener","icon_fetched","fetchedIconMouseDownListener","icon_failed","error","img","tooltips","replace","addButtonCallbacks","outlineObjectTD","view","deleteNode","statement","td","createElement","theClass","why","licenceOptions","checkLicence","value","icons","originalIconBase","expandMouseDownListener","whether","ns","link","className","viewAsBoringDefault","tabulatorSelect","setSelected","tabulatorDeselect","oneStatementFormula","IndexedFormula","push","reasons","each","sym","inquirySpan","innerHTML","insertBefore","icon_display_reasons","firstChild","selectableTDClickListener","outlinePredicateTD","predicate","newTr","inverse","internal","predicateTD","lab","predicateLabelForXML","elements","toUpperCase","labelTD","createTextNode","width","termWidget","construct","w","termWidgets","AJAR_statement","filter","addIcon","e","globalAppTabs","renderTab","renderMain","containerDiv","item","pane","panes","byName","paneName","me","authn","currentUser","GotoSubject","div","dataset","globalPaneName","tabName","textContent","label","options","console","alert","Error","getDashboardItems","items","tabs","tabWidget","ordered","orientation","backgroundColor","selectedTab","onClose","getDashboard","getPods","getAddressBooks","findAppInstances","vcard","instances","map","book","index","iconBase","load","doc","pods","space","pod","split","Promise","all","books","concat","showDashboard","closeDashboard","closeDashboardIfLoggedOut","session","dashboardContainer","display","outlineContainer","getDashboardContainer","childNodes","tab","querySelector","click","warn","dashboard","solidAuthClient","trackSession","getOrCreateContainer","id","getElementById","mainContainer","body","getRelevantPanes","paneRegistry","relevantPanes","list","global","filterAvailablePanes","filteredPanes","firstRelevantPaneIndex","indexOf","firstFilteredPaneIndex","getPane","find","shouldGetFocus","expandedHeaderTR","requiredPane","renderPaneIconTray","paneShownStyle","paneHiddenStyle","paneIconTray","hideList","tr","firstPane","paneNumber","forEach","ico","listen","event","containingTable","parentNode","nodeName","removePanes","specific","d","nextSibling","paneButton","removeAndRefresh","requireQueryButton","numberOfPanesRequiringQueryButton","renderPane","paneDiv","name","no_catch_pane_errors","render","pre","stackString","removeAttribute","second","row","cell","getAttribute","shiftKey","hover","header","showHeader","solo","collapseMouseDownListener","strong","widgets","makeDraggable","par","placeholder","replaceChild","removeChild","propertyTable","debug","canon","then","tr1","propertyTR","st","AJAR_inverse","appendPropertyTRs","parent","plist","predicateFilter","sel","j","k","x","RDFComparePredicateSubject","object","RDFComparePredicateObject","max","s","defaultpropview","views","defaults","dups","langTagged","myLang","sameTerm","lang","showNobj","n","predDups","show","showLaterArray","l","displayed","trObj","colspan","moreTR","moreTD","small","predToggle","current","toggleObj","stopPropagation","showAllobj","iconTD","tooltip","parseInt","removeIcon","baseURI","elt","eltSrc","location","href","relativeIconSrc","join","replaceIcon","oldIcon","newIcon","QueryObj","pat","formula","vars","queries","target","fireOn","makeIconCallback","IconCallback","req","title","addCallback","selected","a","optOnIconMouseDownListener","targetOf","p","optOn","optOff","optOffIconMouseDownListener","setSelectedParent","inc","onIcon","offIcon","num","previousSibling","statusBarClick","getTarget","window","content","showURI","about","showSource","sourceWidget","sources","source","highlight","getSelection","newValue","cla","getTerm","editable","updater","addTri","deselectAll","srcElement","nodeType","walk","directionCode","inputTd","selectedTd","newSelTd","lastChild","tagName","newSelected","evaluate","XPathResult","FIRST_ORDERED_NODE_TYPE","singleNodeValue","OutlinerKeypressPanel","keyCode","setSelectedAfterward","_uri","getAbout","focusTd","removeCallback","Enter","Keypress","preventDefault","Delete","titleTd","outlineCollapse","outlineExpand","charCode","ctrlKey","copyToClipboard","pasteFromClipboard","PosY","findPos","clientHeight","scrollY","innerHeight","getEyeFocus","OutlinerMouseclickPanel","_tabulatorMode","TabulatorMousedown","Click","altKey","outlineRefocus","immediate","fetch","force","refresh","clearInputAndSave","detail","tname","clearMenu","lastModified","backOut","icon_show_choices","icon_add_triple","setUrlBarAndTitle","startsWith","site","subject1","already","newTable","YAHOO","util","Event","off","emptyNode","seeAlsoWhat","rdfs","lookUpThing","expand","cursubj","docTerm","relevant","as","rd","HTTPRedirects","anyStatementMatching","success","status","returnConditions","returnCode","isAudio","isVideo","holds","$rdf","Util","mediaTypeClass","nowOrWhenFetched","ok","message","level","myview","replaceTD","newTd","replacedTd","reselect","outer","GotoFormURI_enterKey","GotoFormURI","_e","GotoURI","GotoURIinit","referrer","GotoSubjectDefault","verticalAlign","defaultView","history","stateObj","pushState","rep","styles","integer","decimal","datatype","xsd","anchor","icon_telephone","linkIcon","numcell","statementsAsTables","createTabURI","URL"],"mappings":";;;;;;;;;AAKA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;;;AAEA;AACA;AAEA;AAEe,kBAAUA,OAAV,EAAmB;AAChC,MAAMC,GAAG,GAAGD,OAAO,CAACC,GAApB;AAEA,OAAKC,QAAL,GAAgBF,OAAO,CAACC,GAAxB;AACA,OAAKE,YAAL,GAAoBA,wBAApB;AACA,OAAKC,QAAL,GAAgB,KAAKA,QAAL,IAAiB,EAAjC;AACA,OAAKA,QAAL,CAAcC,kBAAd,GAAmC,EAAnC,CANgC,CAMM;;AACtC,MAAMC,OAAO,GAAG,IAAhB,CAPgC,CAOX;;AACrB,MAAMC,WAAW,GAAG,IAApB;AACA,MAAIC,SAAS,GAAG,EAAhB;AACA,OAAKA,SAAL,GAAiBA,SAAjB;AACA,OAAKC,QAAL,GAAgBC,EAAE,CAACC,KAAH,CAASF,QAAzB,CAXgC,CAWE;;AAClC,OAAKG,MAAL,GAAcF,EAAE,CAACG,GAAH,CAAOC,aAArB;AACA,OAAKC,EAAL,GAAUL,EAAE,CAACM,KAAb;AACA,MAAMD,EAAE,GAAGL,EAAE,CAACM,KAAd;AACA,MAAMC,EAAE,GAAGP,EAAE,CAACM,KAAH,CAASE,OAApB;AACAjB,EAAAA,GAAG,CAACK,OAAJ,GAAc,IAAd;AACA,OAAKa,EAAL,GAAU,IAAIC,2BAAeC,WAAnB,EAAV,CAjBgC,CAiBW;AAE3C;AACA;;AACA,OAAKC,SAAL,GAAiB,IAAIA,qBAAJ,CAAc,IAAd,CAAjB;AACA,OAAKC,gBAAL,GAAwB,qBAAxB,CAtBgC,CAsBc;;AAC9C,OAAKD,SAAL,CAAeE,aAAf,CAA6B,KAAKD,gBAAlC;AACA,MAAME,cAAc,GAAG,KAAKA,cAA5B;;AAEA,OAAKC,IAAL,GAAY,YAAY;AACtB,QAAMC,KAAK,GAAGC,mBAAmB,EAAjC;AACAD,IAAAA,KAAK,CAACrB,OAAN,GAAgB,IAAhB;AACD,GAHD;AAKA;;;AACAuB,EAAAA,SAAS,CAACC,UAAV,GAAuB,CAAvB;;AAEA,WAASD,SAAT,CAAoBE,CAApB,EAAuB;AACrB,QAAMC,IAAI,GAAG,EAAb;;AACA,SAAK,IAAIC,CAAC,GAAGC,SAAS,CAACC,MAAV,GAAmB,CAAhC,EAAmCF,CAAC,GAAG,CAAvC,EAA0CA,CAAC,EAA3C;AAA+CD,MAAAA,IAAI,CAACC,CAAC,GAAG,CAAL,CAAJ,GAAcC,SAAS,CAACD,CAAD,CAAvB;AAA/C,KAFqB,CAGrB;;;AACA,QAAMG,KAAK,GAAG,IAAIC,IAAJ,GAAWC,OAAX,EAAd;AACA,QAAMC,WAAW,GAAGR,CAAC,CAACS,KAAF,CAAQT,CAAR,EAAWC,IAAX,CAApB;AACA,QAAMS,GAAG,GAAG,IAAIJ,IAAJ,GAAWC,OAAX,EAAZ;AACA5B,IAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CACE,2BACG5B,EAAE,CAAC6B,UAAH,CAAcT,MAAd,GAAuBN,SAAS,CAACC,UADpC,IAEE,qBAFF,GAGEC,CAHF,GAIE,OAJF,IAKGU,GAAG,GAAGL,KALT,IAME,IAPJ;AASAP,IAAAA,SAAS,CAACC,UAAV,GAAuBf,EAAE,CAAC6B,UAAH,CAAcT,MAArC;AACA,WAAOI,WAAP;AACD,GApD+B,CAoD9B;AAEF;AAEA;;;AAEA,WAASM,gBAAT,CAA2BC,IAA3B,EAAiCC,OAAjC,EAA0CC,UAA1C,EAAsD;AACpD,QAAMC,KAAK,GAAGvC,EAAE,CAACC,KAAH,CAASuC,SAAT,CACZ/C,yBAAagD,GAAb,CAAiBC,gBADL,EAEZ,QAFY,EAGZC,SAHY,EAIZpD,GAJY,CAAd;AAMAgD,IAAAA,KAAK,CAACK,gBAAN,CAAuB,OAAvB,EAAgCC,+BAAhC,EAPoD,CAQpD;;AACAN,IAAAA,KAAK,CAACH,IAAN,GAAaE,UAAb;AACAC,IAAAA,KAAK,CAACO,YAAN,CAAmB,OAAnB,EAA4BT,OAAO,CAACU,IAAR,EAA5B;AACAR,IAAAA,KAAK,CAACS,KAAN,CAAYC,UAAZ,GAAyB,KAAzB;AACAV,IAAAA,KAAK,CAACS,KAAN,CAAYE,WAAZ,GAA0B,MAA1B,CAZoD,CAapD;;AACAd,IAAAA,IAAI,CAACe,WAAL,CAAiBZ,KAAjB;AACA,WAAOA,KAAP;AACD;;AAED,OAAKa,iBAAL,GAAyB,UAAU/C,EAAV,EAAc+B,IAAd,EAAoBiB,GAApB,EAAyB;AAChD,QAAIA,GAAG,CAACC,QAAJ,KAAiB,WAArB,EAAkC;AAClC,QAAMC,IAAI,GAAGlD,EAAE,CAACkD,IAAH,CAAQF,GAAR,CAAb;AACAE,IAAAA,IAAI,CAACC,IAAL;AACA,QAAIC,IAAI,GAAG,IAAX;;AACA,SAAK,IAAIlC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGgC,IAAI,CAAC9B,MAAzB,EAAiCF,CAAC,EAAlC,EAAsC;AACpC,UAAIgC,IAAI,CAAChC,CAAD,CAAJ,KAAYkC,IAAhB,EAAsB;AACtBA,MAAAA,IAAI,GAAGF,IAAI,CAAChC,CAAD,CAAX;AACA1B,MAAAA,WAAW,CAAC6D,gBAAZ,CAA6BtB,IAA7B,EAAmCqB,IAAnC;AACD;AACF,GAVD;;AAYA,OAAKC,gBAAL,GAAwB,UAAUtB,IAAV,EAAgBuB,GAAhB,EAAqB;AAC3C,QAAI,CAACA,GAAL,EAAU,OAAO,EAAP;AACV,QAAMC,MAAM,GAAG5D,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAf;AACA,QAAIC,MAAM,CAACE,KAAP,CAAa,CAAb,EAAgB,CAAhB,MAAuB,OAA3B,EAAoC,OAAO,EAAP;AACpC,QAAMC,KAAK,GAAGxD,EAAE,CAACyD,QAAH,CAAYJ,MAAZ,CAAd;AACA,QAAIK,IAAJ,EAAUC,GAAV,EAAeC,QAAf;;AACA,YAAQJ,KAAR;AACE,WAAK,aAAL;AACEE,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiB2B,gBAAxB;AACAF,QAAAA,GAAG,GAAG,OAAN;AACAC,QAAAA,QAAQ,GAAGE,gCAAX;AACA;;AACF,WAAK,WAAL;AACEJ,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiB6B,cAAxB;AACAJ,QAAAA,GAAG,GAAG,UAAN;AACAC,QAAAA,QAAQ,GAAGI,2BAAX,CAHF,CAGyC;;AACvC;;AACF,WAAK,SAAL;AACEN,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiB+B,YAAxB;AACAL,QAAAA,QAAQ,GAAGM,4BAAX;AACAP,QAAAA,GAAG,GAAG,QAAN;AACA;;AACF,WAAK,QAAL;AACED,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiBiC,WAAxB;AACAR,QAAAA,GAAG,GAAG,QAAN;AACAC,QAAAA,QAAQ,GAAGI,2BAAX;AACA;;AACF,WAAK,aAAL;AACEN,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiBiC,WAAxB;AACAP,QAAAA,QAAQ,GAAGI,2BAAX;AACAL,QAAAA,GAAG,GAAG,SAAN;AACA;;AACF,WAAK,aAAL;AACED,QAAAA,IAAI,GAAGxE,yBAAagD,GAAb,CAAiBiC,WAAxB;AACAP,QAAAA,QAAQ,GAAGI,2BAAX;AACAL,QAAAA,GAAG,GAAG,cAAN;AACA;;AACF;AACElE,QAAAA,EAAE,CAACgC,GAAH,CAAO2C,KAAP,CAAa,gBAAgBZ,KAA7B;AACA;AAjCJ,KAN2C,CAwCzC;;;AACF,QAAMa,GAAG,GAAG5E,EAAE,CAACC,KAAH,CAASuC,SAAT,CACVyB,IADU,EAEVC,GAFU,EAGVzE,yBAAaoF,QAAb,CAAsBZ,IAAtB,EAA4Ba,OAA5B,CAAoC,kBAApC,EAAwDlB,MAAxD,CAHU,EAIVrE,GAJU,CAAZ;AAMAqF,IAAAA,GAAG,CAAC9B,YAAJ,CAAiB,KAAjB,EAAwBa,GAAxB;AACAiB,IAAAA,GAAG,CAAChC,gBAAJ,CAAqB,OAArB,EAA8BuB,QAA9B,EAhD2C,CAgDH;;AACxCY,IAAAA,kBAAkB,CAACH,GAAD,EAAMhB,MAAN,CAAlB;AACAxB,IAAAA,IAAI,CAACe,WAAL,CAAiByB,GAAjB;AACA,WAAOA,GAAP;AACD,GApDD,CAxFgC,CA4I9B;AAEF;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACF;AACA;AACA;;;AAEE,OAAKI,eAAL,GAAuB,SAASA,eAAT,CACrB3B,GADqB,EAErB4B,IAFqB,EAGrBC,UAHqB,EAIrBC,SAJqB,EAKrB;AACA,QAAMC,EAAE,GAAG7F,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAX;AACAD,IAAAA,EAAE,CAACtC,YAAH,CACE,OADF,EAEE,+DAFF;AAIAsC,IAAAA,EAAE,CAACtC,YAAH,CAAgB,eAAhB,EAAiC,OAAjC;AACA,QAAIwC,QAAQ,GAAG,KAAf,CAPA,CASA;;AACA,QAAIH,SAAS,IAAIA,SAAS,CAACI,GAA3B,EAAgC;AAC9B,UAAIvF,EAAE,CAACwF,cAAH,IAAqBxF,EAAE,CAACwF,cAAH,CAAkBC,YAAlB,EAAzB,EAA2D;AACzDH,QAAAA,QAAQ,IAAI,UAAZ,CADyD,CAClC;AACxB;AACF,KAdD,CAgBA;;;AACA,QACEjC,GAAG,CAACC,QAAJ,KAAiB,WAAjB,IACAD,GAAG,CAACC,QAAJ,KAAiB,WADjB,IAECD,GAAG,CAACC,QAAJ,KAAiB,SAAjB,IACCD,GAAG,CAACqC,KAAJ,CAAU5B,KADX,KAEET,GAAG,CAACqC,KAAJ,CAAU5B,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,QAA1B,IACCT,GAAG,CAACqC,KAAJ,CAAU5B,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,UAD3B,IAECT,GAAG,CAACqC,KAAJ,CAAU5B,KAAV,CAAgB,CAAhB,EAAmB,CAAnB,MAA0B,SAJ7B,CAHH,EAQE;AACAsB,MAAAA,EAAE,CAACtC,YAAH,CAAgB,OAAhB,EAAyBO,GAAG,CAACN,IAAJ,EAAzB;AACAqC,MAAAA,EAAE,CAACjC,WAAH,CACEnD,EAAE,CAACC,KAAH,CAASuC,SAAT,CACExC,EAAE,CAAC2F,KAAH,CAASC,gBAAT,GAA4B,sBAD9B,EAEE,QAFF,EAGEjD,SAHF,EAIEpD,GAJF,CADF,EAOEqD,gBAPF,CAOmB,OAPnB,EAO4BiD,uBAP5B;AAQD;;AACDT,IAAAA,EAAE,CAACtC,YAAH,CAAgB,OAAhB,EAAyBwC,QAAzB,EApCA,CAoCmC;AACnC;;AACA,QAAIjF,EAAE,CAACyF,OAAH,CAAWzC,GAAX,EAAgBrD,EAAE,CAAC+F,EAAH,CAAM5F,GAAN,CAAU,MAAV,CAAhB,EAAmCH,EAAE,CAAC+F,EAAH,CAAMC,IAAN,CAAW,SAAX,CAAnC,CAAJ,EAA+D;AAC7DZ,MAAAA,EAAE,CAACa,SAAH,GAAe,cAAf;AACD,KAxCD,CAwCE;;;AAEF,QAAI,CAAChB,IAAL,EAAW;AACT;AACAA,MAAAA,IAAI,GAAGiB,mBAAP;AACD;;AACDd,IAAAA,EAAE,CAACjC,WAAH,CAAe8B,IAAI,CAAC5B,GAAD,CAAnB;;AACA,QAAI6B,UAAJ,EAAgB;AACd/C,MAAAA,gBAAgB,CAACiD,EAAD,EAAK/B,GAAL,EAAU6B,UAAV,CAAhB;AACD,KAjDD,CAmDA;;;AACAE,IAAAA,EAAE,CAACe,eAAH,GAAqB,YAAY;AAC/BC,MAAAA,WAAW,CAAC,IAAD,EAAO,IAAP,CAAX;AACD,KAFD;;AAGAhB,IAAAA,EAAE,CAACiB,iBAAH,GAAuB,YAAY;AACjCD,MAAAA,WAAW,CAAC,IAAD,EAAO,KAAP,CAAX;AACD,KAFD,CAvDA,CA2DA;;;AACA,QAAIjB,SAAJ,EAAe;AACb,UAAMmB,mBAAmB,GAAG,IAAItG,EAAE,CAACG,GAAH,CAAOoG,cAAX,EAA5B;AACAD,MAAAA,mBAAmB,CAACpE,UAApB,CAA+BsE,IAA/B,CAAoCrB,SAApC,EAFa,CAEkC;AAC/C;AACA;;AACA,UAAMsB,OAAO,GAAGpG,EAAE,CAACqG,IAAH,CACdJ,mBADc,EAEdjG,EAAE,CAACsG,GAAH,CAAO,4DAAP,CAFc,CAAhB;;AAIA,UAAIF,OAAO,CAAChF,MAAZ,EAAoB;AAClB,YAAMmF,WAAW,GAAGrH,GAAG,CAAC8F,aAAJ,CAAkB,MAAlB,CAApB;;AACA,YAAIoB,OAAO,CAAChF,MAAR,GAAiB,CAArB,EAAwB;AACtBmF,UAAAA,WAAW,CAACC,SAAZ,GAAwB,cAAcJ,OAAO,CAAChF,MAA9C;AACD;;AACDmF,QAAAA,WAAW,CAAC9D,YAAZ,CAAyB,OAAzB,EAAkC,SAAlC;AACA8D,QAAAA,WAAW,CAACE,YAAZ,CACE9G,EAAE,CAACC,KAAH,CAASuC,SAAT,CACE/C,yBAAagD,GAAb,CAAiBsE,oBADnB,EAEE,SAFF,EAGEpE,SAHF,EAIEpD,GAJF,CADF,EAOEqH,WAAW,CAACI,UAPd;AASA5B,QAAAA,EAAE,CAACjC,WAAH,CAAeyD,WAAf;AACD;AACF;;AACDxB,IAAAA,EAAE,CAACxC,gBAAH,CAAoB,OAApB,EAA6BqE,yBAA7B;AACA,WAAO7B,EAAP;AACD,GA9FD,CA3JgC,CAyP9B;;;AAEF,OAAK8B,kBAAL,GAA0B,SAASA,kBAAT,CACxBC,SADwB,EAExBC,KAFwB,EAGxBC,OAHwB,EAIxBC,QAJwB,EAKxB;AACA,QAAMC,WAAW,GAAGhI,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAApB;AACAkC,IAAAA,WAAW,CAACzE,YAAZ,CAAyB,OAAzB,EAAkCqE,SAAS,CAACpE,IAAV,EAAlC;AACAwE,IAAAA,WAAW,CAACzE,YAAZ,CAAyB,OAAzB,EAAkCwE,QAAQ,GAAG,eAAH,GAAqB,MAA/D;AAEA,QAAIE,GAAJ;;AACA,YAAQL,SAAS,CAAC7D,QAAlB;AACE,WAAK,WAAL;AAAkB;AAChBiE,QAAAA,WAAW,CAACtB,SAAZ,GAAwB,cAAxB;AACA;;AACF,WAAK,WAAL;AACEuB,QAAAA,GAAG,GAAGxH,EAAE,CAACC,KAAH,CAASwH,oBAAT,CAA8BN,SAA9B,EAAyCE,OAAzC,CAAN;AACA;;AACF,WAAK,YAAL;AAAmB;AACjBG,QAAAA,GAAG,GAAGxH,EAAE,CAACC,KAAH,CAASwH,oBAAT,CAA8BN,SAAS,CAACO,QAAV,CAAmB,CAAnB,CAA9B,EAAqDL,OAArD,CAAN;AARJ;;AAUAG,IAAAA,GAAG,GAAGA,GAAG,CAAC1D,KAAJ,CAAU,CAAV,EAAa,CAAb,EAAgB6D,WAAhB,KAAgCH,GAAG,CAAC1D,KAAJ,CAAU,CAAV,CAAtC,CAhBA,CAiBA;;AAEA,QAAM8D,OAAO,GAAGrI,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAhB;AACAuC,IAAAA,OAAO,CAAC9E,YAAR,CACE,OADF,EAEE,+DAFF;AAIA8E,IAAAA,OAAO,CAAC9E,YAAR,CAAqB,eAArB,EAAsC,MAAtC;AACA8E,IAAAA,OAAO,CAACzE,WAAR,CAAoB5D,GAAG,CAACsI,cAAJ,CAAmBL,GAAnB,CAApB;AACAD,IAAAA,WAAW,CAACpE,WAAZ,CAAwByE,OAAxB;AACAA,IAAAA,OAAO,CAAC5E,KAAR,CAAc8E,KAAd,GAAsB,MAAtB;AACAP,IAAAA,WAAW,CAACpE,WAAZ,CAAwB4E,UAAU,CAACC,SAAX,CAAqBzI,GAArB,CAAxB,EA5BA,CA4BmD;;AACnD,SAAK,IAAM0I,CAAX,IAAgBxI,yBAAayI,WAA7B,EAA0C;AACxC,UAAI,CAACd,KAAD,IAAU,CAACA,KAAK,CAACe,cAArB,EAAqC,MADG,CACG;AAC3C;;AACA,UACE1I,yBAAayI,WAAb,CAAyBD,CAAzB,EAA4BG,MAA5B,IACA3I,yBAAayI,WAAb,CAAyBD,CAAzB,EAA4BG,MAA5B,CACEhB,KAAK,CAACe,cADR,EAEE,MAFF,EAGEd,OAHF,CAFF,EAOE;AACAU,QAAAA,UAAU,CAACM,OAAX,CAAmBd,WAAnB,EAAgC9H,yBAAayI,WAAb,CAAyBD,CAAzB,CAAhC;AACD;AACF;;AAED,QAAI,CACF;AACD,KAFD,CAEE,OAAOK,CAAP,EAAU;AACVtI,MAAAA,EAAE,CAACgC,GAAH,CAAO2C,KAAP,CAAa,6BAAb;AACD,KAhDD,CAiDA;;;AACA4C,IAAAA,WAAW,CAACpB,eAAZ,GAA8B,YAAY;AACxCC,MAAAA,WAAW,CAAC,IAAD,EAAO,IAAP,CAAX;AACD,KAFD;;AAGAmB,IAAAA,WAAW,CAAClB,iBAAZ,GAAgC,YAAY;AAC1CD,MAAAA,WAAW,CAAC,IAAD,EAAO,KAAP,CAAX;AACD,KAFD;;AAGAmB,IAAAA,WAAW,CAAC3E,gBAAZ,CAA6B,OAA7B,EAAsCqE,yBAAtC;AACA,WAAOM,WAAP;AACD,GA/DD,CA3PgC,CA0T9B;;AAEF;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAnUkC,WAoUjBgB,aApUiB;AAAA;AAAA;;AAAA;AAAA,6EAoUhC;AAAA;AAAA;AAAA;AAAA;AAAA,UAUWC,SAVX;AAAA,UAeWC,UAfX;AAAA;AAAA;AAAA;AAAA;AAAA;AAeWA,cAAAA,UAfX,wBAeuBC,YAfvB,EAeqCC,IAfrC,EAe2C;AACvC;AACA,oBAAMC,IAAI,GAAGC,KAAK,CAACC,MAAN,CAAaH,IAAI,CAACI,QAAlB,CAAb,CAFuC,CAEE;;AACzCL,gBAAAA,YAAY,CAAC7B,SAAb,GAAyB,EAAzB;AACA,oBAAM5F,KAAK,GAAGyH,YAAY,CAACvF,WAAb,CAAyB5D,GAAG,CAAC8F,aAAJ,CAAkB,OAAlB,CAAzB,CAAd;AACA,oBAAM2D,EAAE,GAAGhJ,EAAE,CAACiJ,KAAH,CAASC,WAAT,EAAX;AACArJ,gBAAAA,WAAW,CAACsJ,WAAZ,CACER,IAAI,CAACtG,OAAL,IAAgB2G,EADlB,EAEE,IAFF,EAGEJ,IAHF,EAIE,KAJF,EAKEjG,SALF,EAME1B,KANF;AAQD,eA7BH;;AAUWuH,cAAAA,SAVX,uBAUsBY,GAVtB,EAU2BT,IAV3B,EAUiC;AAC7BS,gBAAAA,GAAG,CAACC,OAAJ,CAAYC,cAAZ,GAA6BX,IAAI,CAACY,OAAL,IAAgBZ,IAAI,CAACI,QAAlD;AACAK,gBAAAA,GAAG,CAACI,WAAJ,GAAkBb,IAAI,CAACc,KAAvB;AACD,eAbH;;AAA8BC,cAAAA,OAA9B,2DAAwC,EAAxC;AACEC,cAAAA,OAAO,CAAC3H,GAAR,CAAY,kBAAZ;AACMoH,cAAAA,GAFR,GAEc7J,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAFd;AAGQ2D,cAAAA,EAHR,GAGahJ,EAAE,CAACiJ,KAAH,CAASC,WAAT,EAHb;;AAAA,kBAIOF,EAJP;AAAA;AAAA;AAAA;;AAKIY,cAAAA,KAAK,CAAC,4BAAD,CAAL;AALJ,oBAMU,IAAIC,KAAJ,CAAU,eAAV,CANV;;AAAA;AAAA;AAAA,qBAQsBC,iBAAiB,EARvC;;AAAA;AAQQC,cAAAA,KARR;AA+BEX,cAAAA,GAAG,CAACjG,WAAJ,CACEnD,EAAE,CAACgK,IAAH,CAAQC,SAAR,CAAkB;AAChB1K,gBAAAA,GAAG,EAAHA,GADgB;AAEhB8C,gBAAAA,OAAO,EAAE2G,EAFO;AAGhBe,gBAAAA,KAAK,EAALA,KAHgB;AAIhBtB,gBAAAA,UAAU,EAAVA,UAJgB;AAKhBD,gBAAAA,SAAS,EAATA,SALgB;AAMhB0B,gBAAAA,OAAO,EAAE,IANO;AAOhBC,gBAAAA,WAAW,EAAE,CAPG;AAQhBC,gBAAAA,eAAe,EAAE,SARD;AAQY;AAC5BC,gBAAAA,WAAW,EAAEX,OAAO,CAACW,WATL;AAUhBC,gBAAAA,OAAO,EAAEZ,OAAO,CAACY;AAVD,eAAlB,CADF;AA/BF,+CA6CSlB,GA7CT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KApUgC;AAAA;AAAA;;AAmXhC,OAAKmB,YAAL,GAAoBhC,aAApB;;AAnXgC,WAqXjBuB,iBArXiB;AAAA;AAAA;;AAAA;AAAA,iFAqXhC;AAAA,yEAwBiBU,OAxBjB,YA8CiBC,eA9CjB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2FA8CE;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAE0BzK,EAAE,CAACiJ,KAAH,CAASyB,gBAAT,CACpB;AAAE1B,4BAAAA,EAAE,EAAFA,EAAF;AAAMI,4BAAAA,GAAG,EAAHA,GAAN;AAAW7J,4BAAAA,GAAG,EAAHA;AAAX,2BADoB,EAEpBwG,EAAE,CAAC4E,KAAH,CAAS,aAAT,CAFoB,CAF1B;;AAAA;AAEUrL,0BAAAA,SAFV;AAAA,4DAMW,CAACA,SAAO,CAACsL,SAAR,IAAqB,EAAtB,EAA0BC,GAA1B,CAA8B,UAACC,IAAD,EAAOC,KAAP;AAAA,mCAAkB;AACrDhC,8BAAAA,QAAQ,EAAE,SAD2C;AAErDQ,8BAAAA,OAAO,oBAAawB,KAAb,CAF8C;AAGrDtB,8BAAAA,KAAK,EAAE,UAH8C;AAIrDpH,8BAAAA,OAAO,EAAEyI,IAJ4C;AAKrD7G,8BAAAA,IAAI,EAAEjE,EAAE,CAAC2F,KAAH,CAASqF,QAAT,GAAoB;AAL2B,6BAAlB;AAAA,2BAA9B,CANX;;AAAA;AAAA;AAAA;AAcIrB,0BAAAA,OAAO,CAAChF,KAAR,CAAc,mCAAd;;AAdJ;AAAA,4DAgBS,EAhBT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBA9CF;AAAA;AAAA;;AA8CiB8F,cAAAA,eA9CjB;AAAA;AAAA;;AAAA;AAAA,mFAwBE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iCAGUpK,EAAE,CAACG,OAAH,CAAWyK,IAAX,CAAgBjC,EAAE,CAACkC,GAAH,EAAhB,CAHV;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAKIvB,0BAAAA,OAAO,CAAChF,KAAR,CAAc,wBAAd;AALJ,4DAMW,EANX;;AAAA;AAQQwG,0BAAAA,IARR,GAQe9K,EAAE,CAACqG,IAAH,CAAQsC,EAAR,EAAYjD,EAAE,CAACqF,KAAH,CAAS,SAAT,CAAZ,EAAiC,IAAjC,EAAuCpC,EAAE,CAACkC,GAAH,EAAvC,CARf;AAAA,4DASSC,IAAI,CAACN,GAAL,CAAS,UAACQ,GAAD,EAAMN,KAAN,EAAgB;AAC9B,gCAAMtB,KAAK,GACT0B,IAAI,CAAC1J,MAAL,GAAc,CAAd,GAAkB4J,GAAG,CAAC1H,GAAJ,CAAQ2H,KAAR,CAAc,IAAd,EAAoB,CAApB,EAAuBxH,KAAvB,CAA6B,CAA7B,EAAgC,CAAC,CAAjC,CAAlB,GAAwD,cAD1D;AAEA,mCAAO;AACLiF,8BAAAA,QAAQ,EAAE,QADL;AAELQ,8BAAAA,OAAO,mBAAYwB,KAAZ,CAFF;AAGLtB,8BAAAA,KAAK,EAALA,KAHK;AAILpH,8BAAAA,OAAO,EAAEgJ,GAJJ;AAKLpH,8BAAAA,IAAI,EAAEjE,EAAE,CAAC2F,KAAH,CAASqF,QAAT,GAAoB;AALrB,6BAAP;AAOD,2BAVM,CATT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBAxBF;AAAA;AAAA;;AAwBiBR,cAAAA,OAxBjB;AAAA;AAAA;;AACQxB,cAAAA,EADR,GACahJ,EAAE,CAACiJ,KAAH,CAASC,WAAT,EADb;AAEQE,cAAAA,GAFR,GAEc7J,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAFd;AAAA;AAAA,qBAG8BkG,OAAO,CAACC,GAAR,CAAY,CAACf,eAAe,EAAhB,EAAoBD,OAAO,EAA3B,CAAZ,CAH9B;;AAAA;AAAA;AAAA;AAGSiB,cAAAA,KAHT;AAGgBN,cAAAA,IAHhB;AAAA,gDAIS,CACL;AACEpC,gBAAAA,QAAQ,EAAE,MADZ;AAEEU,gBAAAA,KAAK,EAAE,YAFT;AAGExF,gBAAAA,IAAI,EAAEjE,EAAE,CAAC2F,KAAH,CAASqF,QAAT,GAAoB;AAH5B,eADK,EAML;AACEjC,gBAAAA,QAAQ,EAAE,kBADZ;AAEEU,gBAAAA,KAAK,EAAE,aAFT;AAGExF,gBAAAA,IAAI,EAAEjE,EAAE,CAAC2F,KAAH,CAASqF,QAAT,GAAoB;AAH5B,eANK,EAWL;AACEjC,gBAAAA,QAAQ,EAAE,aADZ;AAEEU,gBAAAA,KAAK,EAAE,mBAFT;AAGExF,gBAAAA,IAAI,EAAEjE,EAAE,CAAC2F,KAAH,CAASqF,QAAT,GAAoB;AAH5B,eAXK,EAiBJU,MAjBI,CAiBGD,KAjBH,EAkBJC,MAlBI,CAkBGP,IAlBH,CAJT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KArXgC;AAAA;AAAA;;AAsbhC,OAAKrB,iBAAL,GAAyBA,iBAAzB;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;;AA9bkC,WA+bjB6B,aA/biB;AAAA;AAAA;;AAAA;AAAA,6EA+bhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAgCWC,cAhCX;AAAA,UAqCWC,yBArCX;AAAA;AAAA;AAAA;AAAA;AAAA;AAqCWA,cAAAA,yBArCX,kCAqCsCC,OArCtC,EAqC+C;AAC3C,oBAAIA,OAAJ,EAAa;AACX;AACD;;AACDF,gBAAAA,cAAc;AACf,eA1CH;;AAgCWA,cAAAA,cAhCX,8BAgC6B;AACzBG,gBAAAA,kBAAkB,CAAC/I,KAAnB,CAAyBgJ,OAAzB,GAAmC,MAAnC;AACAC,gBAAAA,gBAAgB,CAACjJ,KAAjB,CAAuBgJ,OAAvB,GAAiC,SAAjC;AACD,eAnCH;;AAA8BtC,cAAAA,OAA9B,8DAAwC,EAAxC;AACQqC,cAAAA,kBADR,GAC6BG,qBAAqB,EADlD;AAEQD,cAAAA,gBAFR,GAE2B/K,mBAAmB,EAF9C,EAGE;;AAHF,oBAIM6K,kBAAkB,CAACI,UAAnB,CAA8B1K,MAA9B,GAAuC,CAAvC,IAA4CiI,OAAO,CAACd,IAJ1D;AAAA;AAAA;AAAA;;AAKIqD,cAAAA,gBAAgB,CAACjJ,KAAjB,CAAuBgJ,OAAvB,GAAiC,MAAjC;AACAD,cAAAA,kBAAkB,CAAC/I,KAAnB,CAAyBgJ,OAAzB,GAAmC,SAAnC;AACMI,cAAAA,GAPV,GAOgBL,kBAAkB,CAACM,aAAnB,oCACiB3C,OAAO,CAACd,IADzB,SAPhB;;AAAA,mBAUQwD,GAVR;AAAA;AAAA;AAAA;;AAWMA,cAAAA,GAAG,CAACE,KAAJ;AAXN;;AAAA;AAcI3C,cAAAA,OAAO,CAAC4C,IAAR,CACE,wEADF;;AAdJ;AAAA;AAAA,qBAoB0BhE,aAAa,CAAC;AACpC8B,gBAAAA,WAAW,EAAEX,OAAO,CAACd,IADe;AAEpC0B,gBAAAA,OAAO,EAAEsB;AAF2B,eAAD,CApBvC;;AAAA;AAoBQY,cAAAA,SApBR;AAyBE;AACAxM,cAAAA,EAAE,CAACiJ,KAAH,CAASwD,eAAT,CAAyBC,YAAzB,CAAsCb,yBAAtC,EA1BF,CA4BE;;AACAI,cAAAA,gBAAgB,CAACjJ,KAAjB,CAAuBgJ,OAAvB,GAAiC,MAAjC;AACAD,cAAAA,kBAAkB,CAAC5I,WAAnB,CAA+BqJ,SAA/B;;AA9BF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KA/bgC;AAAA;AAAA;;AA2ehC,OAAKb,aAAL,GAAqBA,aAArB;;AAEA,WAASO,qBAAT,GAAkC;AAChC,WAAOS,oBAAoB,CAAC,iBAAD,CAA3B;AACD;;AAED,WAASzL,mBAAT,GAAgC;AAC9B,WAAOyL,oBAAoB,CAAC,SAAD,CAA3B;AACD;AAED;AACF;AACA;AACA;AACA;AACA;;;AACE,WAASA,oBAAT,CAA+BC,EAA/B,EAAmC;AACjC,WACEpN,QAAQ,CAACqN,cAAT,CAAwBD,EAAxB,KACC,YAAM;AACL,UAAMb,kBAAkB,GAAGvM,QAAQ,CAAC6F,aAAT,CAAuB,KAAvB,CAA3B;AACA0G,MAAAA,kBAAkB,CAACa,EAAnB,GAAwBA,EAAxB;AACA,UAAME,aAAa,GACjBtN,QAAQ,CAAC6M,aAAT,CAAuB,eAAvB,KAA2C7M,QAAQ,CAACuN,IADtD;AAEA,aAAOD,aAAa,CAAC3J,WAAd,CAA0B4I,kBAA1B,CAAP;AACD,KAND,EAFF;AAUD;;AAtgB+B,WAwgBjBiB,gBAxgBiB;AAAA;AAAA;;AAAA;AAAA,gFAwgBhC,kBAAiC3K,OAAjC,EAA0C/C,OAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AACQuJ,cAAAA,KADR,GACgBvJ,OAAO,CAACwM,OAAR,CAAgBmB,YADhC;AAEQC,cAAAA,aAFR,GAEwBrE,KAAK,CAACsE,IAAN,CAAW/E,MAAX,CACpB,UAAAQ,IAAI;AAAA,uBAAIA,IAAI,CAACa,KAAL,CAAWpH,OAAX,EAAoB/C,OAApB,KAAgC,CAACsJ,IAAI,CAACwE,MAA1C;AAAA,eADgB,CAFxB;;AAAA,oBAKMF,aAAa,CAACzL,MAAd,KAAyB,CAL/B;AAAA;AAAA;AAAA;;AAAA,gDAOW,CAACoH,KAAK,CAACC,MAAN,CAAa,UAAb,CAAD,CAPX;;AAAA;AAAA;AAAA,qBAS8B9I,EAAE,CAACiJ,KAAH,CAASoE,oBAAT,CAA8BH,aAA9B,CAT9B;;AAAA;AASQI,cAAAA,aATR;;AAAA,oBAUMA,aAAa,CAAC7L,MAAd,KAAyB,CAV/B;AAAA;AAAA;AAAA;;AAAA,gDAYW,CAACyL,aAAa,CAAC,CAAD,CAAd,CAZX;;AAAA;AAcQK,cAAAA,sBAdR,GAciC1E,KAAK,CAACsE,IAAN,CAAWK,OAAX,CAAmBN,aAAa,CAAC,CAAD,CAAhC,CAdjC;AAeQO,cAAAA,sBAfR,GAeiC5E,KAAK,CAACsE,IAAN,CAAWK,OAAX,CAAmBF,aAAa,CAAC,CAAD,CAAhC,CAfjC,EAgBE;;AAhBF,gDAiBSC,sBAAsB,GAAGE,sBAAzB,GACH,CAACP,aAAa,CAAC,CAAD,CAAd,EAAmBxB,MAAnB,CAA0B4B,aAA1B,CADG,GAEHA,aAnBN;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAxgBgC;AAAA;AAAA;;AA8hBhC,WAASI,OAAT,CAAkBR,aAAlB,EAAiC7K,OAAjC,EAA0C;AACxC,WACE6K,aAAa,CAACS,IAAd,CACE,UAAA/E,IAAI;AAAA,aAAIA,IAAI,CAACgF,cAAL,IAAuBhF,IAAI,CAACgF,cAAL,CAAoBvL,OAApB,CAA3B;AAAA,KADN,KAEK6K,aAAa,CAAC,CAAD,CAHpB;AAKD;;AApiB+B,WAsiBjBW,gBAtiBiB;AAAA;AAAA,IAquB9B;AAEF;;AAEA;AACF;AACA;AACA;AACA;AACA;AAEE;AACA;AACA;AACA;AACA;;AAEA;AACF;AACA;AAEE;AAEA;AAEA;AACA;;;AA/vBgC;AAAA,gFAsiBhC,kBAAiCxL,OAAjC,EAA0CyL,YAA1C,EAAwDpE,OAAxD;AAAA,UACiBqE,kBADjB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,8FACE,kBAAmC3I,EAAnC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAuCsE,0BAAAA,OAAvC,8DAAiD,EAAjD;AACQsE,0BAAAA,cADR,GAEI,0NAFJ;AAGQC,0BAAAA,eAHR,GAII,mEAJJ;AAKQC,0BAAAA,YALR,GAKuB9I,EAAE,CAACjC,WAAH,CAAe5D,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAf,CALvB;AAME6I,0BAAAA,YAAY,CAAClL,KAAb,GACE,iEADF;;AANF,+BASwB0G,OAAO,CAACyE,QAThC;AAAA;AAAA;AAAA;;AAAA,yCAUM,EAVN;AAAA;AAAA;;AAAA;AAAA;AAAA,iCAWYnB,gBAAgB,CAAC3K,OAAD,EAAU/C,OAAV,CAX5B;;AAAA;AAAA;;AAAA;AASQ4N,0BAAAA,aATR;AAYEkB,0BAAAA,EAAE,CAACC,SAAH,GAAeP,YAAY,IAAIJ,OAAO,CAACR,aAAD,EAAgB7K,OAAhB,CAAtC;AACMiM,0BAAAA,UAbR,GAaqBpB,aAAa,CAACM,OAAd,CAAsBY,EAAE,CAACC,SAAzB,CAbrB;;AAeE,8BAAInB,aAAa,CAACzL,MAAd,KAAyB,CAA7B,EAAgC;AAC9B;AACAyL,4BAAAA,aAAa,CAACqB,OAAd,CAAsB,UAAC3F,IAAD,EAAOmC,KAAP,EAAiB;AACrC,kCAAMtB,KAAK,GAAGb,IAAI,CAACa,KAAL,CAAWpH,OAAX,EAAoB/C,OAApB,CAAd;AACA,kCAAMkP,GAAG,GAAGxO,EAAE,CAACC,KAAH,CAASuC,SAAT,CAAmBoG,IAAI,CAAC3E,IAAxB,EAA8BwF,KAA9B,EAAqCA,KAArC,EAA4ClK,GAA5C,CAAZ;AACAiP,8BAAAA,GAAG,CAACxL,KAAJ,GAAY4F,IAAI,KAAKwF,EAAE,CAACC,SAAZ,GAAwBL,cAAxB,GAAyCC,eAArD,CAHqC,CAGgC;AACrE;AACA;AACA;;AACA,kCAAMQ,MAAM,GAAG,SAATA,MAAS,CAAUD,GAAV,EAAe5F,IAAf,EAAqB;AAClC;AACA4F,gCAAAA,GAAG,CAAC5L,gBAAJ,CACE,OADF,EAEE,UAAU8L,KAAV,EAAiB;AACf,sCAAIC,eAAJ,CADe,CAEf;;AACA,uCAAKA,eAAe,GAAGvJ,EAAvB,EAA2BuJ,eAAe,CAACC,UAA3C,EAAuDD,eAAe,GAAGA,eAAe,CAACC,UAAzF,EAAqG;AACnG,wCAAID,eAAe,CAACE,QAAhB,KAA6B,OAAjC,EAA0C;AAC3C;;AACD,sCAAIF,eAAe,CAACE,QAAhB,KAA6B,OAAjC,EAA0C;AACxC,0CAAM,IAAIhF,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACD,sCAAMiF,WAAW,GAAG,SAAdA,WAAc,CAAUC,QAAV,EAAoB;AACtC,yCAAK,IAAIC,CAAC,GAAGL,eAAe,CAAC3H,UAA7B,EAAyCgI,CAAzC,EAA4CA,CAAC,GAAGA,CAAC,CAACC,WAAlD,EAA+D;AAC7D,0CAAI,OAAOD,CAAC,CAACpG,IAAT,KAAkB,WAAtB,EAAmC;AACjC,4CAAI,CAACmG,QAAD,IAAaC,CAAC,CAACpG,IAAF,KAAWmG,QAA5B,EAAsC;AACpC,8CAAIC,CAAC,CAACE,UAAN,EAAkB;AAChBF,4CAAAA,CAAC,CAACE,UAAF,CAAapM,YAAb,CAA0B,OAA1B,EAAmC,YAAnC;AACAkM,4CAAAA,CAAC,CAACE,UAAF,CAAalM,KAAb,GAAqBiL,eAArB;AACD;;AACDkB,0CAAAA,gBAAgB,CAACH,CAAD,CAAhB,CALoC,CAMpC;AACA;;AACA,8CACEA,CAAC,CAACpG,IAAF,CAAOwG,kBAAP,IACAT,eAAe,CAACC,UAAhB,CAA2B3I;AAAU;AADrC,6CAEAoJ,iCAAiC,KAAK,CAFtC,IAGA9P,GAAG,CAACsN,cAAJ,CAAmB,aAAnB,CAJF,EAKE;AACAtN,4CAAAA,GAAG,CACAsN,cADH,CACkB,aADlB,EAEG/J,YAFH,CAEgB,OAFhB,EAEyB,eAFzB;AAGD;AACF;AACF;AACF;AACF,mCAxBD;;AAyBA,sCAAMwM,UAAU,GAAG,SAAbA,UAAa,CAAU1G,IAAV,EAAgB;AACjC,wCAAI2G,OAAJ;AACAvP,oCAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,kCAAkC2G,IAAI,CAAC4G,IAAnD;;AACA,wCAAIxP,EAAE,CAACyP,oBAAP,EAA6B;AAC3B;AACAF,sCAAAA,OAAO,GAAG3G,IAAI,CAAC8G,MAAL,CAAYrN,OAAZ,EAAqB/C,OAArB,EAA8BoK,OAA9B,CAAV;AACD,qCAHD,MAGO;AACL,0CAAI;AACF6F,wCAAAA,OAAO,GAAG3G,IAAI,CAAC8G,MAAL,CAAYrN,OAAZ,EAAqB/C,OAArB,EAA8BoK,OAA9B,CAAV;AACD,uCAFD,CAEE,OAAOpB,CAAP,EAAU;AACV;AACAiH,wCAAAA,OAAO,GAAGhQ,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAV;AACAkK,wCAAAA,OAAO,CAACzM,YAAR,CAAqB,OAArB,EAA8B,eAA9B;AACA,4CAAM6M,GAAG,GAAGpQ,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAZ;AACAkK,wCAAAA,OAAO,CAACpM,WAAR,CAAoBwM,GAApB;AACAA,wCAAAA,GAAG,CAACxM,WAAJ,CACE5D,GAAG,CAACsI,cAAJ,CAAmB7H,EAAE,CAACC,KAAH,CAAS2P,WAAT,CAAqBtH,CAArB,CAAnB,CADF;AAGD;AACF;;AACD,wCACEM,IAAI,CAACwG,kBAAL,IACA7P,GAAG,CAACsN,cAAJ,CAAmB,aAAnB,CAFF,EAGE;AACAtN,sCAAAA,GAAG,CAACsN,cAAJ,CAAmB,aAAnB,EAAkCgD,eAAlC,CAAkD,OAAlD;AACD;;AACD,wCAAMC,MAAM,GAAGnB,eAAe,CAAC3H,UAAhB,CAA2BiI,WAA1C;AACA,wCAAMc,GAAG,GAAGxQ,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAZ;AACA,wCAAM2K,IAAI,GAAGD,GAAG,CAAC5M,WAAJ,CAAgB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAhB,CAAb;AACA2K,oCAAAA,IAAI,CAAC7M,WAAL,CAAiBoM,OAAjB;AACA,wCAAIO,MAAJ,EAAYnB,eAAe,CAAC7H,YAAhB,CAA6BiJ,GAA7B,EAAkCD,MAAlC,EAAZ,KACKnB,eAAe,CAACxL,WAAhB,CAA4B4M,GAA5B;AACLA,oCAAAA,GAAG,CAACnH,IAAJ,GAAWA,IAAX;AACAmH,oCAAAA,GAAG,CAACb,UAAJ,GAAiBV,GAAjB;AACD,mCAlCD;;AAmCA,sCAAMzK,KAAK,GAAGyK,GAAG,CAACyB,YAAJ,CAAiB,OAAjB,CAAd;;AACA,sCAAIlM,KAAK,KAAK,YAAd,EAA4B;AAC1B,wCAAI,CAAC2K,KAAK,CAACwB,QAAX,EAAqB;AACnB;AACApB,sCAAAA,WAAW;AACZ;;AACDQ,oCAAAA,UAAU,CAAC1G,IAAD,CAAV;AACA4F,oCAAAA,GAAG,CAAC1L,YAAJ,CAAiB,OAAjB,EAA0B,WAA1B;AACA0L,oCAAAA,GAAG,CAACxL,KAAJ,GAAYgL,cAAZ;AACD,mCARD,MAQO;AACLc,oCAAAA,WAAW,CAAClG,IAAD,CAAX;AACA4F,oCAAAA,GAAG,CAAC1L,YAAJ,CAAiB,OAAjB,EAA0B,YAA1B;AACA0L,oCAAAA,GAAG,CAACxL,KAAJ,GAAYiL,eAAZ;AACD;;AAED,sCAAIoB,iCAAiC,GAAG,CAAxC;;AACA,uCAAK,IAAIL,CAAC,GAAGL,eAAe,CAAC3H,UAA7B,EAAyCgI,CAAzC,EAA4CA,CAAC,GAAGA,CAAC,CAACC,WAAlD,EAA+D;AAC7D,wCAAID,CAAC,CAACpG,IAAF,IAAUoG,CAAC,CAACpG,IAAF,CAAOwG,kBAArB,EAAyC;AACvCC,sCAAAA,iCAAiC;AAClC;AACF;AACF,iCA5FH,EA6FE,KA7FF;AA+FD,+BAjGD,CAPqC,CAwGnC;;;AAEFZ,8BAAAA,MAAM,CAACD,GAAD,EAAM5F,IAAN,CAAN;AACA4F,8BAAAA,GAAG,CAAC1L,YAAJ,CACE,OADF,EAEEiI,KAAK,KAAKuD,UAAV,GAAuB,YAAvB,GAAsC,WAFxC;AAIA,kCAAIvD,KAAK,KAAKuD,UAAd,EAA0BF,EAAE,CAACc,UAAH,GAAgBV,GAAhB;AAC1BN,8BAAAA,YAAY,CAAC/K,WAAb,CAAyBqL,GAAzB;AACD,6BAjHD;AAkHD;;AAnIH,4DAoISN,YApIT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,iBADF;AAAA;AAAA;;AACiBH,cAAAA,kBADjB;AAAA;AAAA;;AAsII;AAEF;AACMK,cAAAA,EAzIR,GAyIa7O,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAzIb;;AA0IE,kBAAIqE,OAAO,CAACyG,KAAZ,EAAmB;AACjB;AACA/B,gBAAAA,EAAE,CAACtL,YAAH,CAAgB,OAAhB,EAAyB,cAAzB;AACD;;AACKsC,cAAAA,EA9IR,GA8IagJ,EAAE,CAACjL,WAAH,CAAe5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAf,CA9Ib;AA+IED,cAAAA,EAAE,CAACtC,YAAH,CACE,OADF,EAEE,kEACE,oEAHJ;AAKAsC,cAAAA,EAAE,CAACtC,YAAH,CAAgB,eAAhB,EAAiC,MAAjC;AACAsC,cAAAA,EAAE,CAACtC,YAAH,CAAgB,OAAhB,EAAyBT,OAAO,CAACU,IAAR,EAAzB;AACAqC,cAAAA,EAAE,CAACtC,YAAH,CAAgB,SAAhB,EAA2B,GAA3B,EAtJF,CAwJE;;AACMsN,cAAAA,MAzJR,GAyJiBhL,EAAE,CAACjC,WAAH,CAAe5D,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAf,CAzJjB;AA0JE+K,cAAAA,MAAM,CAACpN,KAAP,GACE,kFADF;AAGMqN,cAAAA,UA7JR,GA6JqB,CAAC,CAACvC,YA7JvB;;AA+JE,kBAAI,CAACpE,OAAO,CAAC4G,IAAT,IAAiB,CAACD,UAAtB,EAAkC;AAC1BpM,gBAAAA,IAD0B,GACnBmM,MAAM,CAACjN,WAAP,CACXnD,EAAE,CAACC,KAAH,CAASuC,SAAT,CACExC,EAAE,CAAC2F,KAAH,CAASC,gBAAT,GAA4B,kBAD9B,EAEE,UAFF,EAGEjD,SAHF,EAIEpD,GAJF,CADW,CADmB;AAShC0E,gBAAAA,IAAI,CAACrB,gBAAL,CAAsB,OAAtB,EAA+B2N,yBAA/B;AAEMC,gBAAAA,MAX0B,GAWjBJ,MAAM,CAACjN,WAAP,CAAmB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAnB,CAXiB;AAYhCmL,gBAAAA,MAAM,CAACrN,WAAP,CAAmB5D,GAAG,CAACsI,cAAJ,CAAmB7H,EAAE,CAACC,KAAH,CAASwJ,KAAT,CAAepH,OAAf,CAAnB,CAAnB;AACAmO,gBAAAA,MAAM,CAACxN,KAAP,GACE,6DADF;AAEAhD,gBAAAA,EAAE,CAACyQ,OAAH,CAAWC,aAAX,CAAyBF,MAAzB,EAAiCnO,OAAjC;AACD;;AA/KH,6BAiLE+N,MAjLF;AAAA;AAAA,qBAkLUrC,kBAAkB,CAAC3I,EAAD,EAAK;AAC3B+I,gBAAAA,QAAQ,EAAEkC;AADiB,eAAL,CAlL5B;;AAAA;AAAA;;AAAA,2BAiLSlN,WAjLT;;AAuLE;AACAiL,cAAAA,EAAE,CAACpH,UAAH,CAAcb,eAAd,GAAgC,YAAY;AAC1CC,gBAAAA,WAAW,CAAC,IAAD,EAAO,IAAP,CAAX;AACD,eAFD;;AAGAgI,cAAAA,EAAE,CAACpH,UAAH,CAAcX,iBAAd,GAAkC,YAAY;AAC5CD,gBAAAA,WAAW,CAAC,IAAD,EAAO,KAAP,CAAX;AACD,eAFD;;AA3LF,gDA8LSgI,EA9LT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAtiBgC;AAAA;AAAA;;AAgwBhC,WAASe,gBAAT,CAA2BH,CAA3B,EAA8B;AAC5B,QAAM/N,KAAK,GAAG+N,CAAC,CAACJ,UAAhB;AACA,QAAM+B,GAAG,GAAG1P,KAAK,CAAC2N,UAAlB;AACA,QAAMgC,WAAW,GAAGrR,GAAG,CAAC8F,aAAJ,CAAkB,OAAlB,CAApB;AACAuL,IAAAA,WAAW,CAAC9N,YAAZ,CAAyB,OAAzB,EAAkC,cAAlC;AACA6N,IAAAA,GAAG,CAACE,YAAJ,CAAiBD,WAAjB,EAA8B3P,KAA9B;AACAA,IAAAA,KAAK,CAAC6P,WAAN,CAAkB9B,CAAlB;AACA2B,IAAAA,GAAG,CAACE,YAAJ,CAAiB5P,KAAjB,EAAwB2P,WAAxB,EAP4B,CAOS;AACtC;;AAED,MAAMG,aAAa,GAAI,KAAKA,aAAL,GAAqB,SAASA,aAAT,CAC1C1O,OAD0C,EAE1CpB,KAF0C,EAG1C2H,IAH0C,EAI1Cc,OAJ0C,EAK1C;AACA1J,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,yBAAyB3O,OAAtC;AACAA,IAAAA,OAAO,GAAGhC,EAAE,CAAC4Q,KAAH,CAAS5O,OAAT,CAAV,CAFA,CAGA;;AAEA,QAAI,CAACpB,KAAL,EAAY;AACV;AACAA,MAAAA,KAAK,GAAG1B,GAAG,CAAC8F,aAAJ,CAAkB,OAAlB,CAAR;AACApE,MAAAA,KAAK,CAAC6B,YAAN,CAAmB,OAAnB,EAA4B,cAA5B;AACA+K,MAAAA,gBAAgB,CAACxL,OAAD,EAAUuG,IAAV,EAAgBc,OAAhB,CAAhB,CAAyCwH,IAAzC,CAA8C,UAAAC,GAAG,EAAI;AACnDlQ,QAAAA,KAAK,CAACkC,WAAN,CAAkBgO,GAAlB;;AAEA,YAAIA,GAAG,CAAC9C,SAAR,EAAmB;AACjB,cAAIkB,OAAJ;;AACA,cAAI;AACFvP,YAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,kCAAkCkP,GAAG,CAAC9C,SAAJ,CAAcmB,IAA5D;AACAD,YAAAA,OAAO,GAAG4B,GAAG,CAAC9C,SAAJ,CAAcqB,MAAd,CAAqBrN,OAArB,EAA8B/C,OAA9B,EAAuCoK,OAAvC,CAAV;AACD,WAHD,CAGE,OAAOpB,CAAP,EAAU;AACV;AACAiH,YAAAA,OAAO,GAAGhQ,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAV;AACAkK,YAAAA,OAAO,CAACzM,YAAR,CAAqB,OAArB,EAA8B,eAA9B;AACA,gBAAM6M,GAAG,GAAGpQ,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAZ;AACAkK,YAAAA,OAAO,CAACpM,WAAR,CAAoBwM,GAApB;AACAA,YAAAA,GAAG,CAACxM,WAAJ,CAAgB5D,GAAG,CAACsI,cAAJ,CAAmB7H,EAAE,CAACC,KAAH,CAAS2P,WAAT,CAAqBtH,CAArB,CAAnB,CAAhB;AACD;;AAED,cAAMyH,GAAG,GAAGxQ,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAZ;AACA,cAAM2K,IAAI,GAAGD,GAAG,CAAC5M,WAAJ,CAAgB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAhB,CAAb;AACA2K,UAAAA,IAAI,CAAC7M,WAAL,CAAiBoM,OAAjB;;AACA,cACE4B,GAAG,CAAC9C,SAAJ,CAAce,kBAAd,IACA7P,GAAG,CAACsN,cAAJ,CAAmB,aAAnB,CAFF,EAGE;AACAtN,YAAAA,GAAG,CAACsN,cAAJ,CAAmB,aAAnB,EAAkCgD,eAAlC,CAAkD,OAAlD;AACD;;AACD5O,UAAAA,KAAK,CAACkC,WAAN,CAAkB4M,GAAlB;AACAA,UAAAA,GAAG,CAACnH,IAAJ,GAAWuI,GAAG,CAAC9C,SAAf;AACA0B,UAAAA,GAAG,CAACb,UAAJ,GAAiBiC,GAAG,CAACjC,UAArB;AACD;AACF,OA9BD;AAgCA,aAAOjO,KAAP;AACD,KArCD,MAqCO;AACL;AACAjB,MAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,gBAAgBhB,KAA5B,EAFK,CAGL;;AACA,aAAOA,KAAP;AACD;AACF,GArDD;AAqDG;;;AAEH,WAASmQ,UAAT,CAAqBlG,GAArB,EAA0BmG,EAA1B,EAA8BhK,OAA9B,EAAuC;AACrC,QAAM+G,EAAE,GAAGlD,GAAG,CAAC7F,aAAJ,CAAkB,IAAlB,CAAX;AACA+I,IAAAA,EAAE,CAACjG,cAAH,GAAoBkJ,EAApB;AACAjD,IAAAA,EAAE,CAACkD,YAAH,GAAkBjK,OAAlB,CAHqC,CAIrC;;AACA+G,IAAAA,EAAE,CAACtL,YAAH,CAAgB,QAAhB,EAA0B,MAA1B;AACA,QAAMyE,WAAW,GAAG1H,WAAW,CAACqH,kBAAZ,CAA+BmK,EAAE,CAAClK,SAAlC,EAA6CiH,EAA7C,EAAiD/G,OAAjD,CAApB;AACA+G,IAAAA,EAAE,CAACjL,WAAH,CAAeoE,WAAf,EAPqC,CAOT;;AAC5B,WAAO6G,EAAP;AACD;;AACD,OAAKgD,UAAL,GAAkBA,UAAlB,CA30BgC,CA60BhC;;AACA,WAASG,iBAAT,CAA4BC,MAA5B,EAAoCC,KAApC,EAA2CpK,OAA3C,EAAoDqK,eAApD,EAAqE;AACnE;AACA;AACA;AACA;AACA1R,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,4BAA4BS,KAAK,CAAChQ,MAA/C;AACA,QAAIgQ,KAAK,CAAChQ,MAAN,KAAiB,CAArB,EAAwB,OAAO,EAAP;AACxB,QAAIkQ,GAAJ,EAASC,CAAT,EAAYC,CAAZ;;AACA,QAAIxK,OAAJ,EAAa;AACXsK,MAAAA,GAAG,GAAG,aAAUG,CAAV,EAAa;AACjB,eAAOA,CAAC,CAACzP,OAAT;AACD,OAFD;;AAGAoP,MAAAA,KAAK,GAAGA,KAAK,CAACjO,IAAN,CAAWxD,EAAE,CAACC,KAAH,CAAS8R,0BAApB,CAAR;AACD,KALD,MAKO;AACLJ,MAAAA,GAAG,GAAG,aAAUG,CAAV,EAAa;AACjB,eAAOA,CAAC,CAACE,MAAT;AACD,OAFD;;AAGAP,MAAAA,KAAK,GAAGA,KAAK,CAACjO,IAAN,CAAWxD,EAAE,CAACC,KAAH,CAASgS,yBAApB,CAAR;AACD;;AAED,QAAMC,GAAG,GAAGT,KAAK,CAAChQ,MAAlB;;AApBmE;AAsBjE;AACA,UAAI0Q,CAAC,GAAGV,KAAK,CAACG,CAAD,CAAb,CAvBiE,CAwBjE;AAEA;;AACA,UAAIF,eAAe,IAAI,CAACA,eAAe,CAACS,CAAC,CAAChL,SAAH,EAAcE,OAAd,CAAvC,EAA+D;AAE/D,UAAM+G,EAAE,GAAGgD,UAAU,CAAC7R,GAAD,EAAM4S,CAAN,EAAS9K,OAAT,CAArB;AACAmK,MAAAA,MAAM,CAACrO,WAAP,CAAmBiL,EAAnB;AACA,UAAM7G,WAAW,GAAG6G,EAAE,CAACpH,UAAvB,CA/BiE,CA+B/B;;AAElC,UAAIoL,eAAe,GAAGC,KAAK,CAACC,QAAN,CAAeH,CAAC,CAAChL,SAAF,CAAYxD,GAA3B,CAAtB,CAjCiE,CAmCjE;;AAEA,UAAI4O,IAAI,GAAG,CAAX,CArCiE,CAqCpD;;AACb,UAAIC,UAAU,GAAG,CAAjB,CAtCiE,CAsC9C;;AACnB,UAAIC,MAAM,GAAG,CAAb,CAvCiE,CAuClD;;AAEf,WACEZ,CAAC,GAAG,CADN,EAEEA,CAAC,GAAGD,CAAJ,GAAQM,GAAR,IAAeT,KAAK,CAACG,CAAC,GAAGC,CAAL,CAAL,CAAa1K,SAAb,CAAuBuL,QAAvB,CAAgCP,CAAC,CAAChL,SAAlC,CAFjB,EAGE0K,CAAC,EAHH,EAIE;AACA,YAAIA,CAAC,GAAG,CAAJ,IAASF,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGC,CAAL,CAAN,CAAH,CAAkBa,QAAlB,CAA2Bf,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGC,CAAJ,GAAQ,CAAT,CAAN,CAA9B,CAAb,EAAgEU,IAAI;;AACpE,YAAIZ,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGC,CAAL,CAAN,CAAH,CAAkBc,IAAlB,IAA0B/S,OAAO,CAACF,QAAR,CAAiBC,kBAA/C,EAAmE;AACjE6S,UAAAA,UAAU,IAAI,CAAd;;AACA,cACEb,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGC,CAAL,CAAN,CAAH,CAAkBc,IAAlB,CAAuBnF,OAAvB,CACE5N,OAAO,CAACF,QAAR,CAAiBC,kBADnB,KAEK,CAHP,EAIE;AACA8S,YAAAA,MAAM;AACP;AACF;AACF;AAED;AACN;AACA;;;AAEM,UAAIA,MAAM,GAAG,CAAT,IAAcD,UAAU,KAAKD,IAAI,GAAG,CAAxC,EAA2C;AACzC,aAAK,IAAIV,EAAC,GAAGD,CAAb,EAAgBC,EAAC,IAAID,CAAC,GAAGW,IAAzB,EAA+BV,EAAC,EAAhC,EAAoC;AAClC,cACEjS,OAAO,CAACF,QAAR,CAAiBC,kBAAjB,IACAgS,GAAG,CAACF,KAAK,CAACI,EAAD,CAAN,CAAH,CAAcc,IAAd,CAAmBnF,OAAnB,CAA2B5N,OAAO,CAACF,QAAR,CAAiBC,kBAA5C,KAAmE,CAFrE,EAGE;AACAyO,YAAAA,EAAE,CAACjL,WAAH,CACEtD,WAAW,CAACmF,eAAZ,CACE2M,GAAG,CAACF,KAAK,CAACI,EAAD,CAAN,CADL,EAEEO,eAFF,EAGEzP,SAHF,EAIEwP,CAJF,CADF;AAQA;AACD;AACF;;AACDP,QAAAA,CAAC,IAAIW,IAAL,CAjByC,CAiB/B;;AACV;AACD;;AAEDnE,MAAAA,EAAE,CAACjL,WAAH,CACEtD,WAAW,CAACmF,eAAZ,CAA4B2M,GAAG,CAACQ,CAAD,CAA/B,EAAoCC,eAApC,EAAqDzP,SAArD,EAAgEwP,CAAhE,CADF;AAIA;AACN;AACA;AACA;AACA;;AAEM/D,MAAAA,EAAE,CAACwE,QAAH,GAAc,UAAUC,CAAV,EAAa;AACzB,YAAMC,QAAQ,GAAGjB,CAAC,GAAGU,IAArB;AACA,YAAMQ,IAAI,GAAG,IAAIF,CAAJ,GAAQC,QAAR,GAAmBD,CAAnB,GAAuBC,QAApC;AACA,YAAME,cAAc,GAAG,EAAvB;;AACA,YAAIF,QAAQ,KAAK,CAAjB,EAAoB;AAClBvL,UAAAA,WAAW,CAACzE,YAAZ,CACE,SADF,EAEEiQ,IAAI,KAAKD,QAAT,GAAoBA,QAApB,GAA+BD,CAAC,GAAG,CAFrC;AAIA,cAAII,CAAJ;;AACA,cAAIF,IAAI,GAAGD,QAAP,IAAmBC,IAAI,KAAK,CAAhC,EAAmC;AACjC;AACAxL,YAAAA,WAAW,CAACzE,YAAZ,CAAyB,SAAzB,EAAoC,CAApC;AACD;;AACD,cAAIoQ,SAAS,GAAG,CAAhB,CAVkB,CAUA;AAClB;;AACA,eAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGpB,CAAhB,EAAmBoB,CAAC,EAApB,EAAwB;AACtB;AACA,gBACE,CAAC5S,EAAE,CACA4Q,KADF,CACQU,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGqB,CAAL,CAAN,CADX,EAEEP,QAFF,CAEWrS,EAAE,CAAC4Q,KAAH,CAASU,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGqB,CAAJ,GAAQ,CAAT,CAAN,CAAZ,CAFX,CADH,EAIE;AACAC,cAAAA,SAAS;AACTf,cAAAA,CAAC,GAAGV,KAAK,CAACG,CAAC,GAAGqB,CAAL,CAAT;AACAb,cAAAA,eAAe,GAAGC,KAAK,CAACC,QAAN,CAAeH,CAAC,CAAChL,SAAF,CAAYxD,GAA3B,CAAlB;AACA,kBAAMwP,KAAK,GAAG5T,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAd;AACA8N,cAAAA,KAAK,CAACnQ,KAAN,CAAYoQ,OAAZ,GAAsB,GAAtB;AACAD,cAAAA,KAAK,CAAChQ,WAAN,CACEtD,WAAW,CAACmF,eAAZ,CACE2M,GAAG,CAACF,KAAK,CAACG,CAAC,GAAGqB,CAAL,CAAN,CADL,EAEEb,eAFF,EAGEzP,SAHF,EAIEwP,CAJF,CADF;AAQAgB,cAAAA,KAAK,CAAChL,cAAN,GAAuBgK,CAAvB;AACAgB,cAAAA,KAAK,CAAC7B,YAAN,GAAqBjK,OAArB;AACAmK,cAAAA,MAAM,CAACrO,WAAP,CAAmBgQ,KAAnB;;AACA,kBAAID,SAAS,IAAIH,IAAjB,EAAuB;AACrBI,gBAAAA,KAAK,CAACnQ,KAAN,CAAYgJ,OAAZ,GAAsB,MAAtB;AACAgH,gBAAAA,cAAc,CAACxM,IAAf,CAAoB2M,KAApB;AACD;AACF,aAzBD,MAyBO;AACL;AACAnT,cAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,+BAAZ,EAA6CwP,KAAK,CAACG,CAAC,GAAGqB,CAAJ,GAAQ,CAAT,CAAlD;AACD;AACF,WA3CiB,CA4ClB;;;AACA,cAAIF,IAAI,KAAKD,QAAb,EAAuB;AACrBvL,YAAAA,WAAW,CAACzE,YAAZ,CAAyB,SAAzB,EAAoCoQ,SAAS,GAAG,CAAhD;AACD;AACF,SApDwB,CAoDvB;;;AAEF,YAAIH,IAAI,GAAGD,QAAX,EAAqB;AACnB;AACA,cAAMO,MAAM,GAAG9T,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAf;AACA,cAAMiO,MAAM,GAAGD,MAAM,CAAClQ,WAAP,CAAmB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAnB,CAAf;AACAiO,UAAAA,MAAM,CAACxQ,YAAP,CACE,OADF,EAEE,+DAFF;AAIAwQ,UAAAA,MAAM,CAACxQ,YAAP,CAAoB,eAApB,EAAqC,OAArC;;AACA,cAAIgQ,QAAQ,GAAGD,CAAf,EAAkB;AAChB;AACA,gBAAMU,KAAK,GAAGhU,GAAG,CAAC8F,aAAJ,CAAkB,GAAlB,CAAd;AACAiO,YAAAA,MAAM,CAACnQ,WAAP,CAAmBoQ,KAAnB;;AAEA,gBAAMC,UAAU,GAAI,UAAUnS,CAAV,EAAa;AAC/B,qBAAOA,CAAC,CAACkG,WAAD,EAAcsK,CAAd,EAAiBU,IAAjB,EAAuBM,CAAvB,CAAR;AACD,aAFkB,CAEhB,UAAUtL,WAAV,EAAuBsK,CAAvB,EAA0BU,IAA1B,EAAgCM,CAAhC,EAAmC;AACpC,qBAAO,UAAU7G,OAAV,EAAmB;AACxBuH,gBAAAA,KAAK,CAAC1M,SAAN,GAAkB,EAAlB;;AACA,oBAAImF,OAAO,KAAK,MAAhB,EAAwB;AACtBuH,kBAAAA,KAAK,CAACpQ,WAAN,CACEnD,EAAE,CAACC,KAAH,CAASuC,SAAT,CACExC,EAAE,CAAC2F,KAAH,CAASC,gBAAT,GAA4B,oBAD9B,EAEE,MAFF,EAGE,SAHF,EAIErG,GAJF,CADF;AAQAgU,kBAAAA,KAAK,CAACpQ,WAAN,CACE5D,GAAG,CAACsI,cAAJ,CAAmBiL,QAAQ,GAAGD,CAAX,GAAe,UAAlC,CADF;AAGAtL,kBAAAA,WAAW,CAACzE,YAAZ,CAAyB,SAAzB,EAAoC+P,CAAC,GAAG,CAAxC;AACD,iBAbD,MAaO;AACLU,kBAAAA,KAAK,CAACpQ,WAAN,CACEnD,EAAE,CAACC,KAAH,CAASuC,SAAT,CACExC,EAAE,CAAC2F,KAAH,CAASC,gBAAT,GAA4B,gBAD9B,EAEE,QAFF,EAGEjD,SAHF,EAIEpD,GAJF,CADF;AAQAgI,kBAAAA,WAAW,CAACzE,YAAZ,CAAyB,SAAzB,EAAoCgQ,QAAQ,GAAG,CAA/C;AACD;;AACD,qBAAK,IAAIvR,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGyR,cAAc,CAACvR,MAAnC,EAA2CF,CAAC,EAA5C,EAAgD;AAC9C,sBAAM4R,MAAK,GAAGH,cAAc,CAACzR,CAAD,CAA5B;AACA4R,kBAAAA,MAAK,CAACnQ,KAAN,CAAYgJ,OAAZ,GAAsBA,OAAtB;AACD;AACF,eA9BD;AA+BD,aAlCkB,CAAnB,CALgB,CAuCb;;;AACH,gBAAIyH,OAAO,GAAG,MAAd;;AACA,gBAAMC,SAAS,GAAG,SAAZA,SAAY,CAAUhF,KAAV,EAAiB;AACjC8E,cAAAA,UAAU,CAACC,OAAD,CAAV;AACAA,cAAAA,OAAO,GAAGA,OAAO,KAAK,MAAZ,GAAqB,EAArB,GAA0B,MAApC;AACA,kBAAI/E,KAAJ,EAAWA,KAAK,CAACiF,eAAN;AACX,qBAAO,KAAP,CAJiC,CAIpB;AACd,aALD;;AAMAD,YAAAA,SAAS;AACTH,YAAAA,KAAK,CAAC3Q,gBAAN,CAAuB,OAAvB,EAAgC8Q,SAAhC,EAA2C,KAA3C;AACD,WA1DkB,CA0DjB;;;AACFlC,UAAAA,MAAM,CAACrO,WAAP,CAAmBkQ,MAAnB;AACD,SAlHwB,CAkHvB;;AACH,OAnHD,CA9FiE,CAiN/D;;;AAEFjF,MAAAA,EAAE,CAACwF,UAAH,GAAgB,YAAY;AAC1BxF,QAAAA,EAAE,CAACwE,QAAH,CAAYf,CAAC,GAAGU,IAAhB;AACD,OAFD;;AAIAnE,MAAAA,EAAE,CAACwE,QAAH,CAAY,EAAZ;AAEAhB,MAAAA,CAAC,IAAIC,CAAC,GAAG,CAAT,CAzNiE,CAyNtD;AAzNsD;;AAqBnE,SAAKD,CAAC,GAAG,CAAT,EAAYA,CAAC,GAAGM,GAAhB,EAAqBN,CAAC,EAAtB,EAA0B;AAAA;;AAAA,+BA4DtB;AAyIH;AACF,GAziC+B,CAyiC9B;;;AAEF,OAAKL,iBAAL,GAAyBA,iBAAzB;AAEA;AACF;AACA;;AACE,MAAMxJ,UAAU,GAAG,EAAnB,CAhjCgC,CAgjCV;;AACtBqF,EAAAA,MAAM,CAACrF,UAAP,GAAoBA,UAApB;;AACAA,EAAAA,UAAU,CAACC,SAAX,GAAuB,UAAUzI,GAAV,EAAe;AACpCA,IAAAA,GAAG,GAAGA,GAAG,IAAIC,QAAb;AACA,QAAM4F,EAAE,GAAG7F,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAX;AACAD,IAAAA,EAAE,CAACtC,YAAH,CACE,OADF,EAEE,+DAFF;AAIAsC,IAAAA,EAAE,CAACtC,YAAH,CAAgB,OAAhB,EAAyB,QAAzB;AACAsC,IAAAA,EAAE,CAACtC,YAAH,CAAgB,eAAhB,EAAiC,MAAjC;AACAsC,IAAAA,EAAE,CAACpC,KAAH,CAAS8E,KAAT,GAAiB,KAAjB;AACA,WAAO1C,EAAP;AACD,GAXD;;AAYA2C,EAAAA,UAAU,CAACM,OAAX,GAAqB,UAAUjD,EAAV,EAAcnB,IAAd,EAAoBE,QAApB,EAA8B;AACjD,QAAM0P,MAAM,GAAGzO,EAAE,CAAC+G,UAAH,CAAc,CAAd,CAAf;AACA,QAAI,CAAC0H,MAAL,EAAa;AACb,QAAI/L,KAAK,GAAG+L,MAAM,CAAC7Q,KAAP,CAAa8E,KAAzB;AACA,QAAMlD,GAAG,GAAG5E,EAAE,CAACC,KAAH,CAASuC,SAAT,CAAmByB,IAAI,CAACxB,GAAxB,EAA6BwB,IAAI,CAACC,GAAlC,EAAuCD,IAAI,CAAC6P,OAA5C,EAAqDvU,GAArD,CAAZ;AACAuI,IAAAA,KAAK,GAAGiM,QAAQ,CAACjM,KAAD,CAAhB;AACAA,IAAAA,KAAK,GAAGA,KAAK,GAAG7D,IAAI,CAAC6D,KAArB;AACA+L,IAAAA,MAAM,CAAC7Q,KAAP,CAAa8E,KAAb,GAAqBA,KAAK,GAAG,IAA7B;AACA+L,IAAAA,MAAM,CAAC1Q,WAAP,CAAmByB,GAAnB;;AACA,QAAIT,QAAJ,EAAc;AACZS,MAAAA,GAAG,CAAChC,gBAAJ,CAAqB,OAArB,EAA8BuB,QAA9B;AACD;AACF,GAZD;;AAaA4D,EAAAA,UAAU,CAACiM,UAAX,GAAwB,UAAU5O,EAAV,EAAcnB,IAAd,EAAoB;AAC1C,QAAM4P,MAAM,GAAGzO,EAAE,CAAC+G,UAAH,CAAc,CAAd,CAAf;AACA,QAAI8H,OAAJ;AACA,QAAI,CAACJ,MAAL,EAAa;AACb,QAAI/L,KAAK,GAAG+L,MAAM,CAAC7Q,KAAP,CAAa8E,KAAzB;AACAA,IAAAA,KAAK,GAAGiM,QAAQ,CAACjM,KAAD,CAAhB;AACAA,IAAAA,KAAK,GAAGA,KAAK,GAAG7D,IAAI,CAAC6D,KAArB;AACA+L,IAAAA,MAAM,CAAC7Q,KAAP,CAAa8E,KAAb,GAAqBA,KAAK,GAAG,IAA7B;;AACA,SAAK,IAAIgK,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG+B,MAAM,CAAC1H,UAAP,CAAkB1K,MAAtC,EAA8CqQ,CAAC,EAA/C,EAAmD;AACjD,UAAMoC,GAAG,GAAGL,MAAM,CAAC1H,UAAP,CAAkB2F,CAAlB,CAAZ;AACA,UAAMqC,MAAM,GAAGD,GAAG,CAACzR,GAAnB,CAFiD,CAIjD;;AACA,UAAI;AACFwR,QAAAA,OAAO,GAAG1U,GAAG,CAAC6U,QAAJ,CAAaC,IAAb,CAAkB/I,KAAlB,CAAwB,GAAxB,EAA6B,CAA7B,CAAV;AACD,OAFD,CAEE,OAAOhD,CAAP,EAAU;AACVqB,QAAAA,OAAO,CAAC3H,GAAR,CAAYsG,CAAZ;AACA2L,QAAAA,OAAO,GAAG,EAAV;AACD;;AACD,UAAMK,eAAe,GAAGtU,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAW4Q,IAAX,CAAgBtQ,IAAI,CAACxB,GAArB,EAA0BwR,OAA1B,CAAxB;;AACA,UAAIE,MAAM,KAAKG,eAAf,EAAgC;AAC9BT,QAAAA,MAAM,CAAC/C,WAAP,CAAmBoD,GAAnB;AACD;AACF;AACF,GAxBD;;AAyBAnM,EAAAA,UAAU,CAACyM,WAAX,GAAyB,UAAUpP,EAAV,EAAcqP,OAAd,EAAuBC,OAAvB,EAAgCvQ,QAAhC,EAA0C;AACjE4D,IAAAA,UAAU,CAACiM,UAAX,CAAsB5O,EAAtB,EAA0BqP,OAA1B;AACA1M,IAAAA,UAAU,CAACM,OAAX,CAAmBjD,EAAnB,EAAuBsP,OAAvB,EAAgCvQ,QAAhC;AACD,GAHD,CApmCgC,CAymChC;AAEA;AAEA;;AAEA;AACF;AACA;AAIE;AACA;AACA;AACA;AACA;;;AAEA,WAASwQ,QAAT,GAAqB;AACnB,SAAKC,GAAL,GAAWvU,EAAE,CAACwU,OAAH,EAAX;AACA,SAAKC,IAAL,GAAY,EAAZ,CAFmB,CAGnB;AACD;;AAED,MAAMC,OAAO,GAAG,EAAhB;AACAA,EAAAA,OAAO,CAAC,CAAD,CAAP,GAAa,IAAIJ,QAAJ,EAAb;AACA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,WAAS5P,kBAAT,CAA6BiQ,MAA7B,EAAqCC,MAArC,EAA6C;AAC3CjV,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,0BAA0BiE,MAA1B,GAAmC,QAAhD;;AACA,QAAMC,gBAAgB,GAAG,SAAnBA,gBAAmB,CAAUjR,IAAV,EAAgB;AACvC,aAAO,SAASkR,YAAT,CAAuBC,GAAvB,EAA4B;AACjC,YAAIA,GAAG,CAAC5H,OAAJ,CAAY,GAAZ,KAAoB,CAAxB,EAA2B;AACzB7D,UAAAA,OAAO,CAAC3H,GAAR,CACE,sEACEoT,GAFJ,EADyB,CAKzB;AACD;;AACD,YAAI,CAACJ,MAAL,EAAa;AACX,iBAAO,KAAP;AACD;;AACD,YAAI,CAACpV,OAAO,CAACG,QAAR,CAAiBiV,MAAjB,EAAyB,KAAzB,CAAL,EAAsC,OAAO,KAAP,CAXL,CAYjC;;AACA,YAAII,GAAG,KAAKH,MAAZ,EAAoB;AAClBD,UAAAA,MAAM,CAACvS,GAAP,GAAawB,IAAb;AACA+Q,UAAAA,MAAM,CAACK,KAAP,GAAe5V,yBAAaoF,QAAb,CAAsBZ,IAAtB,CAAf;AACD;;AACD,eAAO,IAAP;AACD,OAlBD;AAmBD,KApBD;;AAqBA1D,IAAAA,EAAE,CAAC+U,WAAH,CAAe,SAAf,EAA0BJ,gBAAgB,CAACzV,yBAAagD,GAAb,CAAiB6B,cAAlB,CAA1C;AACA/D,IAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBJ,gBAAgB,CAACzV,yBAAagD,GAAb,CAAiB+B,YAAlB,CAAvC;AACAjE,IAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBJ,gBAAgB,CAACzV,yBAAagD,GAAb,CAAiBiC,WAAlB,CAAvC;AACD,GAnsC+B,CAqsChC;;;AAEA,WAAS6Q,QAAT,CAAmBnT,IAAnB,EAAyB;AACvB,QAAMoT,CAAC,GAAGpT,IAAI,CAAC6N,YAAL,CAAkB,OAAlB,CAAV;AACA,QAAIuF,CAAC,IAAIA,CAAC,CAAChI,OAAF,CAAU,UAAV,KAAyB,CAAlC,EAAqC,OAAO,IAAP;AACrC,WAAO,KAAP;AACD,GA3sC+B,CA6sChC;;;AACA,WAASiI,0BAAT,CAAqCnN,CAArC,EAAwC;AACtC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAMqN,CAAC,GAAGX,MAAM,CAACpG,UAAjB;AACA7G,IAAAA,UAAU,CAACyM,WAAX,CACEmB,CAAC,CAAC/G,UADJ,EAEEnP,yBAAayI,WAAb,CAAyB0N,KAF3B,EAGEnW,yBAAayI,WAAb,CAAyB2N,MAH3B,EAIEC,2BAJF;AAMAH,IAAAA,CAAC,CAAC/G,UAAF,CAAaA,UAAb,CAAwBiB,eAAxB,CAAwC,UAAxC;AACD;;AAED,WAASiG,2BAAT,CAAsCxN,CAAtC,EAAyC;AACvC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAMqN,CAAC,GAAGX,MAAM,CAACpG,UAAjB;AACA7G,IAAAA,UAAU,CAACyM,WAAX,CACEmB,CAAC,CAAC/G,UADJ,EAEEnP,yBAAayI,WAAb,CAAyB2N,MAF3B,EAGEpW,yBAAayI,WAAb,CAAyB0N,KAH3B,EAIEH,0BAJF;AAMAE,IAAAA,CAAC,CAAC/G,UAAF,CAAaA,UAAb,CAAwB9L,YAAxB,CAAqC,UAArC,EAAiD,MAAjD;AACD;;AAED,WAASiT,iBAAT,CAA4B3T,IAA5B,EAAkC4T,GAAlC,EAAuC;AACrC,QAAMC,MAAM,GAAGxW,yBAAayI,WAAb,CAAyB0N,KAAxC;AACA,QAAMM,OAAO,GAAGzW,yBAAayI,WAAb,CAAyB2N,MAAzC;;AACA,SAAK,IAAIhD,CAAC,GAAGzQ,IAAb,EAAmByQ,CAAC,CAACjE,UAArB,EAAiCiE,CAAC,GAAGA,CAAC,CAACjE,UAAvC,EAAmD;AACjD,aAAO,IAAP,EAAa;AACX,YAAIiE,CAAC,CAAC5C,YAAF,CAAe,QAAf,CAAJ,EAA8B;AAC5B,cAAIkG,GAAG,GAAGtD,CAAC,CAAC5C,YAAF,CAAe,kBAAf,CAAV;AACA,cAAI,CAACkG,GAAL,EAAUA,GAAG,GAAG,CAAN,CAAV,KACKA,GAAG,GAAGpC,QAAQ,CAACoC,GAAD,CAAd;;AACL,cAAIA,GAAG,KAAK,CAAR,IAAaH,GAAG,GAAG,CAAvB,EAA0B;AACxBjO,YAAAA,UAAU,CAACM,OAAX,CACEwK,CAAC,CAAC1G,UAAF,CAAa,CAAb,CADF,EAEE0G,CAAC,CAAC5C,YAAF,CAAe,UAAf,IAA6BgG,MAA7B,GAAsCC,OAFxC,EAGErD,CAAC,CAAC5C,YAAF,CAAe,UAAf,IACIwF,0BADJ,GAEIK,2BALN;AAOD;;AACDK,UAAAA,GAAG,GAAGA,GAAG,GAAGH,GAAZ;AACAnD,UAAAA,CAAC,CAAC/P,YAAF,CAAe,kBAAf,EAAmCqT,GAAnC;;AACA,cAAIA,GAAG,KAAK,CAAZ,EAAe;AACbtD,YAAAA,CAAC,CAAChD,eAAF,CAAkB,kBAAlB;AACA9H,YAAAA,UAAU,CAACiM,UAAX,CACEnB,CAAC,CAAC1G,UAAF,CAAa,CAAb,CADF,EAEE0G,CAAC,CAAC5C,YAAF,CAAe,UAAf,IAA6BgG,MAA7B,GAAsCC,OAFxC;AAID;;AACD;AACD,SAvBD,MAuBO,IAAIrD,CAAC,CAACuD,eAAF,IAAqBvD,CAAC,CAACuD,eAAF,CAAkBvH,QAAlB,KAA+B,IAAxD,EAA8D;AACnEgE,UAAAA,CAAC,GAAGA,CAAC,CAACuD,eAAN;AACD,SAFM,MAEA;AACR;AACF;AACF;;AAED,OAAKC,cAAL,GAAsB,UAAU3H,KAAV,EAAiB;AACrC,QAAMsG,MAAM,GAAGhV,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmB5H,KAAnB,CAAf;;AACA,QAAIsG,MAAM,CAACvL,KAAX,EAAkB;AAChB8M,MAAAA,MAAM,CAACC,OAAP,CAAepC,QAAf,GAA0BY,MAAM,CAACvL,KAAjC,CADgB,CAEhB;AACA;AACA;AACD;AACF,GARD;;AAUA,OAAKgN,OAAL,GAAe,SAASA,OAAT,CAAkBC,KAAlB,EAAyB;AACtC,QAAIA,KAAK,IAAInX,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,CAAb,EAA4C;AAC1CtN,MAAAA,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,EAA8BnH,KAA9B,GACEgR,KAAK,CAACpT,QAAN,KAAmB,WAAnB,GAAiCoT,KAAK,CAAC/S,GAAvC,GAA6C,EAD/C,CAD0C,CAEQ;AACnD;AACF,GALD;;AAOA,OAAKgT,UAAL,GAAkB,SAASA,UAAT,GAAuB;AACvC,QAAI,OAAOC,YAAP,KAAwB,WAA5B,EAAyC,OADF,CAEvC;AACA;;AACA,SAAK,IAAMjT,GAAX,IAAkBiT,YAAY,CAACC,OAA/B,EAAwC;AACtCD,MAAAA,YAAY,CAACC,OAAb,CAAqBlT,GAArB,EAA0Bb,YAA1B,CAAuC,OAAvC,EAAgD,EAAhD;AACD,KANsC,CAMrC;;;AACF,SAAK,IAAIvB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGzB,SAAS,CAAC2B,MAA9B,EAAsCF,CAAC,EAAvC,EAA2C;AACzC,UAAI,CAACzB,SAAS,CAACyB,CAAD,CAAT,CAAaqN,UAAlB,EAA8B;AAC5BjF,QAAAA,OAAO,CAAC3H,GAAR,CAAY,oCAAoClC,SAAS,CAACyB,CAAD,CAA7C,GAAmD,IAA/D;AACA;AACD;;AACD,UAAM8P,EAAE,GAAGvR,SAAS,CAACyB,CAAD,CAAT,CAAaqN,UAAb,CAAwBzG,cAAnC;AACA,UAAI,CAACkJ,EAAL,EAAS,SANgC,CAMvB;;AAClB,UAAMyF,MAAM,GAAGzF,EAAE,CAAC9L,GAAlB;;AACA,UAAIuR,MAAM,IAAIA,MAAM,CAACnT,GAArB,EAA0B;AACxBiT,QAAAA,YAAY,CAACG,SAAb,CAAuBD,MAAvB,EAA+B,IAA/B;AACD;AACF;AACF,GAnBD;;AAqBA,OAAKE,YAAL,GAAoB,SAASA,YAAT,GAAyB;AAC3C,WAAOlX,SAAP;AACD,GAFD;;AAIA,WAASsG,WAAT,CAAsBhE,IAAtB,EAA4B6U,QAA5B,EAAsC;AACpC;AACA;AACA;AACA,QAAI7U,IAAI,CAACyM,QAAL,KAAkB,IAAtB,EAA4B;AAC1B7O,MAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,SAAS5O,IAAI,CAACyM,QAA3B;AACA,YAAM,IAAIhF,KAAJ,CACJ,iCACEzH,IAAI,CAACyM,QADP,GAEE,KAFF,GAGEzM,IAAI,CAACoH,WAJH,CAAN;AAMD;;AACDxJ,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,MAAb;AACA,QAAIkG,GAAG,GAAG9U,IAAI,CAAC6N,YAAL,CAAkB,OAAlB,CAAV;AACA,QAAI,CAACiH,GAAL,EAAUA,GAAG,GAAG,EAAN;;AACV,QAAID,QAAJ,EAAc;AACZC,MAAAA,GAAG,IAAI,WAAP;;AACA,UAAIA,GAAG,CAAC1J,OAAJ,CAAY,MAAZ,KAAuB,CAAvB,IAA4B0J,GAAG,CAAC1J,OAAJ,CAAY,KAAZ,KAAsB,CAAtD,EAAyD;AACvDuI,QAAAA,iBAAiB,CAAC3T,IAAD,EAAO,CAAP,CAAjB;AACD;;AACDtC,MAAAA,SAAS,CAAC0G,IAAV,CAAepE,IAAf,EALY,CAMZ;;AAEA,UAAMsU,KAAK,GAAG1W,EAAE,CAACC,KAAH,CAASkX,OAAT,CAAiB/U,IAAjB,CAAd,CARY,CAQyB;;AACrCvC,MAAAA,WAAW,CAAC4W,OAAZ,CAAoBC,KAApB;AAEA,UAAIrF,EAAE,GAAGjP,IAAI,CAAC+F,cAAd,CAXY,CAWiB;;AAC7B,UAAI,OAAOkJ,EAAP,KAAc,WAAlB,EAA+BA,EAAE,GAAGjP,IAAI,CAACwM,UAAL,CAAgBzG,cAArB,CAZnB,CAaZ;;AACA,UAAIkJ,EAAJ,EAAQ;AACN;AACA,YAAMyF,MAAM,GAAGzF,EAAE,CAAC9L,GAAlB,CAFM,CAGN;;AACA,YAAM6R,QAAQ,GAAGpX,EAAE,CAACM,KAAH,CAAS+W,OAAT,CAAiBD,QAAjB,CAA0BN,MAAM,CAACnT,GAAjC,EAAsCtD,EAAtC,CAAjB;;AACA,YAAI,CAAC+W,QAAL,EAAe,CACb;AACD,SAPK,CAOJ;AACF;AACA;;;AACA,YAAIA,QAAQ,IAAIF,GAAG,CAAC1J,OAAJ,CAAY,MAAZ,KAAuB,CAAvC,EAA0C;AACxCzF,UAAAA,UAAU,CAACM,OAAX,CAAmBjG,IAAnB,EAAyB3C,yBAAayI,WAAb,CAAyBoP,MAAlD;AACD,SAZK,CAYJ;;AACH;AACF,KA5BD,MA4BO;AACLtX,MAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,UAAUkG,GAAV,GAAgB,GAA7B;AACA,UAAIA,GAAG,KAAK,UAAZ,EAAwBA,GAAG,GAAG,EAAN,CAFnB,CAE4B;;AACjCA,MAAAA,GAAG,GAAGA,GAAG,CAACpS,OAAJ,CAAY,WAAZ,EAAyB,EAAzB,CAAN;;AACA,UAAIoS,GAAG,CAAC1J,OAAJ,CAAY,MAAZ,KAAuB,CAAvB,IAA4B0J,GAAG,CAAC1J,OAAJ,CAAY,KAAZ,KAAsB,CAAtD,EAAyD;AACvDuI,QAAAA,iBAAiB,CAAC3T,IAAD,EAAO,CAAC,CAAR,CAAjB;AACD;;AACD,UAAI8U,GAAG,CAAC1J,OAAJ,CAAY,MAAZ,KAAuB,CAA3B,EAA8B;AAC5BzF,QAAAA,UAAU,CAACiM,UAAX,CAAsB5R,IAAtB,EAA4B3C,yBAAayI,WAAb,CAAyBoP,MAArD;AACD;;AAEDxX,MAAAA,SAAS,GAAGA,SAAS,CAACsI,MAAV,CAAiB,UAAU0J,CAAV,EAAa;AACxC,eAAOA,CAAC,KAAK1P,IAAb;AACD,OAFW,CAAZ;AAIApC,MAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,iBAAiBG,IAAI,CAACoH,WAAlC;AACD;;AACD,QAAI,OAAOoN,YAAP,KAAwB,WAA5B,EAAyC/W,WAAW,CAAC8W,UAAZ,GA7DL,CA6D8B;AAClE;AACA;;AACAvU,IAAAA,IAAI,CAACU,YAAL,CAAkB,OAAlB,EAA2BoU,GAA3B;AACD;;AAED,WAASK,WAAT,GAAwB;AACtB,QAAM1E,CAAC,GAAG/S,SAAS,CAAC2B,MAApB;;AACA,SAAK,IAAIF,CAAC,GAAGsR,CAAC,GAAG,CAAjB,EAAoBtR,CAAC,IAAI,CAAzB,EAA4BA,CAAC,EAA7B;AAAiC6E,MAAAA,WAAW,CAACtG,SAAS,CAACyB,CAAD,CAAV,EAAe,KAAf,CAAX;AAAjC;;AACAzB,IAAAA,SAAS,GAAG,EAAZ;AACD;AAED;;;AACA,OAAK4V,QAAL,GAAgB,UAAUpN,CAAV,EAAa;AAC3B,QAAI0M,MAAJ;AACA,QAAI,CAAC1M,CAAL,EAAQA,CAAC,GAAGiO,MAAM,CAAC7H,KAAX;;AACR,QAAIpG,CAAC,CAAC0M,MAAN,EAAc;AACZA,MAAAA,MAAM,GAAG1M,CAAC,CAAC0M,MAAX;AACD,KAFD,MAEO,IAAI1M,CAAC,CAACkP,UAAN,EAAkB;AACvBxC,MAAAA,MAAM,GAAG1M,CAAC,CAACkP,UAAX;AACD,KAFM,MAEA;AACLxX,MAAAA,EAAE,CAACgC,GAAH,CAAO2C,KAAP,CAAa,gCAAgC2D,CAA7C;AACA,aAAO,KAAP;AACD,KAV0B,CAUzB;;;AACF,QAAI0M,MAAM,CAACyC,QAAP,KAAoB,CAAxB,EAA2B;AACzB;AACAzC,MAAAA,MAAM,GAAGA,MAAM,CAACpG,UAAhB;AACD;;AACD,WAAOoG,MAAP;AACD,GAhBD,CA/3CgC,CA+4C9B;;;AAEF,OAAK0C,IAAL,GAAY,SAASA,IAAT,CAAeC,aAAf,EAA8BC,OAA9B,EAAuC;AACjD,QAAMC,UAAU,GAAGD,OAAO,IAAI9X,SAAS,CAAC,CAAD,CAAvC;AACA,QAAIgY,QAAJ;;AACA,YAAQH,aAAR;AACE,WAAK,MAAL;AACE,YAAI;AACFG,UAAAA,QAAQ,GAAGD,UAAU,CAACjJ,UAAX,CAAsBK,WAAtB,CAAkC8I,SAA7C;AACD,SAFD,CAEE,OAAOzP,CAAP,EAAU;AACV,eAAKoP,IAAL,CAAU,IAAV;AACA;AACD,SANH,CAMI;;;AACFH,QAAAA,WAAW;AACXnR,QAAAA,WAAW,CAAC0R,QAAD,EAAW,IAAX,CAAX;AACA;;AACF,WAAK,IAAL;AACE,YAAI;AACFA,UAAAA,QAAQ,GAAGD,UAAU,CAACjJ,UAAX,CAAsBwH,eAAtB,CAAsC2B,SAAjD;AACD,SAFD,CAEE,OAAOzP,CAAP,EAAU;AACV;AACD,SALH,CAKI;;;AACFiP,QAAAA,WAAW;AACXnR,QAAAA,WAAW,CAAC0R,QAAD,EAAW,IAAX,CAAX;AACA;;AACF,WAAK,OAAL;AACEP,QAAAA,WAAW;;AACX,YACEM,UAAU,CAAC5I,WAAX,IACA4I,UAAU,CAACE,SAAX,CAAqBC,OAArB,KAAiC,QAFnC,EAGE;AACA5R,UAAAA,WAAW,CAACyR,UAAU,CAAC5I,WAAZ,EAAyB,IAAzB,CAAX;AACD,SALD,MAKO;AACL,cAAMgJ,WAAW,GAAG1Y,GAAG,CAAC2Y,QAAJ,CAClB,oBADkB,EAElBL,UAFkB,EAGlB,IAHkB,EAIlBM,WAAW,CAACC,uBAJM,EAKlB,IALkB,EAMlBC,eANF;AAOAjS,UAAAA,WAAW,CAAC6R,WAAD,EAAc,IAAd,CAAX;AACD;;AACD;;AACF,WAAK,MAAL;AACEV,QAAAA,WAAW;;AACX,YACEM,UAAU,CAACzB,eAAX,IACAyB,UAAU,CAACzB,eAAX,CAA2BnQ,SAA3B,KAAyC,cAF3C,EAGE;AACAG,UAAAA,WAAW,CAACyR,UAAU,CAACzB,eAAZ,EAA6B,IAA7B,CAAX;AACA,iBAAO,IAAP,CAFA,CAEY;AACb,SAND,MAMO;AACLhQ,UAAAA,WAAW,CAACpG,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkB8X,UAAU,CAACjJ,UAA7B,EAAyC,IAAzC,CAAD,EAAiD,IAAjD,CAAX;AACD,SAVH,CAUI;;;AACF;;AACF,WAAK,QAAL;AACE;AACA2I,QAAAA,WAAW;AACXnR,QAAAA,WAAW,CAACwR,OAAD,EAAU,IAAV,CAAX;AACA;AAtDJ;;AAwDA,QAAID,aAAa,KAAK,MAAlB,IAA4BA,aAAa,KAAK,IAAlD,EAAwD;AACtD,UAAI,CAACG,QAAQ,CAAC3R,eAAd,EAA+B,KAAKuR,IAAL,CAAUC,aAAV;AAChC,KA7DgD,CA8DjD;;AACD,GA/DD,CAj5CgC,CAk9ChC;AACA;AACA;;;AACA,OAAKW,qBAAL,GAA6B,SAASA,qBAAT,CAAgChQ,CAAhC,EAAmC;AAC9DtI,IAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,SAASqG,CAAC,CAACiQ,OAAX,GAAqB,UAAjC;;AAEA,aAAS9B,OAAT,CAAkBC,KAAlB,EAAyB;AACvB,UAAIA,KAAK,IAAInX,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,CAAb,EAA4C;AAC1CtN,QAAAA,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,EAA8BnH,KAA9B,GACEgR,KAAK,CAACpT,QAAN,KAAmB,WAAnB,GAAiCoT,KAAK,CAAC/S,GAAvC,GAA6C,EAD/C,CAD0C,CAEQ;AACnD;AACF;;AAED,aAAS6U,oBAAT,CAA+BC,IAA/B,EAAqC;AACnC,UAAIjX,SAAS,CAAC,CAAD,CAAb,EAAkB,OAAO,IAAP;AAClBkW,MAAAA,IAAI,CAAC,OAAD,EAAUG,UAAV,CAAJ;AACApB,MAAAA,OAAO,CAACzW,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsBP,SAAS,CAAC,CAAD,CAA/B,CAAD,CAAP;AACA,aAAO,IAAP;AACD;;AACD,QAAIkV,MAAJ,EAAYoC,QAAZ;AAEA,QAAIpX,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmBhO,CAAnB,EAAsB0P,OAAtB,KAAkC,UAAtC,EAAkD;AAClD,QAAIhY,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmBhO,CAAnB,EAAsBsE,EAAtB,KAA6B,SAAjC,EAA4C;AAC5C,QAAI9M,SAAS,CAAC2B,MAAV,GAAmB,CAAvB,EAA0B;;AAC1B,QAAI3B,SAAS,CAAC2B,MAAV,KAAqB,CAAzB,EAA4B;AAC1B,UACE6G,CAAC,CAACiQ,OAAF,KAAc,EAAd,IACAjQ,CAAC,CAACiQ,OAAF,KAAc,EADd,IAEAjQ,CAAC,CAACiQ,OAAF,KAAc,EAFd,IAGAjQ,CAAC,CAACiQ,OAAF,KAAc,EAHd,IAIAjQ,CAAC,CAACiQ,OAAF,KAAc,EALhB,EAME;AACA,aAAKb,IAAL,CAAU,OAAV,EAAmB7X,WAAW,CAAC8Y,OAA/B;AACAlC,QAAAA,OAAO,CAACzW,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsBP,SAAS,CAAC,CAAD,CAA/B,CAAD,CAAP;AACD;;AACD;AACD;;AACD,QAAM+X,UAAU,GAAG/X,SAAS,CAAC,CAAD,CAA5B,CAlC8D,CAmC9D;;AACAS,IAAAA,EAAE,CAACqY,cAAH,CAAkB,MAAlB,EAA0B,sBAA1B;AACArY,IAAAA,EAAE,CAACqY,cAAH,CAAkB,MAAlB,EAA0B,sBAA1B;;AAEA,YAAQtQ,CAAC,CAACiQ,OAAV;AACE,WAAK,EAAL;AAAS;AACP,YAAIvY,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmBhO,CAAnB,EAAsB0P,OAAtB,KAAkC,MAAtC,EAA8C;AAC5C;AACA,cAAMhG,MAAM,GAAGhS,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsBwX,UAAtB,CAAf;AACA7C,UAAAA,MAAM,GAAG6C,UAAU,CAACjJ,UAAX,CAAsBzG,cAAtB,CAAqC5C,GAA9C;AACA6R,UAAAA,QAAQ,GAAGpX,EAAE,CAACM,KAAH,CAAS+W,OAAT,CAAiBD,QAAjB,CAA0BpC,MAAM,CAACrR,GAAjC,EAAsCtD,EAAtC,CAAX;;AACA,cAAI2R,MAAJ,EAAY;AACV;AACApS,YAAAA,OAAO,CAACuJ,WAAR,CAAoB6I,MAApB,EAA4B,IAA5B;AACA;AACZ;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACY;AACD,WAjBD,MAiBO,IAAIoF,QAAJ,EAAc;AACnB;AACAvX,YAAAA,WAAW,CAACe,SAAZ,CAAsBiY,KAAtB,CAA4BhB,UAA5B;AACD;AACF,SA1BD,MA0BO;AACL;AACA,eAAKjX,SAAL,CAAekY,QAAf,CAAwBxQ,CAAxB;AACA,eAAKoP,IAAL,CAAU,MAAV,EAHK,CAGa;AAClB;;AACApP,UAAAA,CAAC,CAACqL,eAAF;AACD;;AACD;;AACF,WAAK,EAAL;AAAS;AACP;AACA;AACA,aAAK+D,IAAL,CAAU,IAAV;AACApP,QAAAA,CAAC,CAACqL,eAAF;AACArL,QAAAA,CAAC,CAACyQ,cAAF;AACA;;AACF,WAAK,EAAL;AAAS;AACP;AACA,aAAKrB,IAAL,CAAU,MAAV;AACApP,QAAAA,CAAC,CAACqL,eAAF;AACArL,QAAAA,CAAC,CAACyQ,cAAF;AA/CJ,KAvC8D,CAuF5D;;;AAEF,QAAI/Y,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmBhO,CAAnB,EAAsB0P,OAAtB,KAAkC,OAAtC,EAA+C;;AAE/C,YAAQ1P,CAAC,CAACiQ,OAAV;AACE,WAAK,EAAL,CADF,CACW;;AACT,WAAK,CAAL;AAAQ;AACNvD,QAAAA,MAAM,GAAG6C,UAAU,CAACjJ,UAAX,CAAsBzG,cAAtB,CAAqC5C,GAA9C;AACA6R,QAAAA,QAAQ,GAAGpX,EAAE,CAACM,KAAH,CAAS+W,OAAT,CAAiBD,QAAjB,CAA0BpC,MAAM,CAACrR,GAAjC,EAAsCtD,EAAtC,CAAX;;AACA,YAAI+W,QAAJ,EAAc;AACZ9O,UAAAA,CAAC,CAACyQ,cAAF,GADY,CACO;;AACnB,eAAKnY,SAAL,CAAeoY,MAAf,CAAsBnB,UAAtB;AACD;;AACD;;AACF,WAAK,EAAL;AAAS;AACP,YAAI,KAAKH,IAAL,CAAU,MAAV,CAAJ,EAAuB;AACvB,YAAIuB,OAAO,GAAGjZ,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkB8X,UAAU,CAACjJ,UAA7B,EAAyC,IAAzC,CAAd;AACAsK,QAAAA,eAAe,CAACrB,UAAD,EAAa7X,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsB4Y,OAAtB,CAAb,CAAf;AACA;;AACF,WAAK,EAAL;AAAS;AACP;AACA;AACA,YAAM5V,GAAG,GAAGrD,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsBwX,UAAtB,CAAZ;;AACA,YAAIxU,GAAJ,EAAS;AACP,cAAIqU,IAAI,GAAG,KAAKA,IAAhB;;AAEA,cAAIG,UAAU,CAAC5I,WAAf,EAA4B;AAC1B;AACA,iBAAKyI,IAAL,CAAU,OAAV;AACA;AACD;;AACD,cAAIG,UAAU,CAAC7Q,UAAX,CAAsBgR,OAAtB,KAAkC,OAAtC,EAA+C;AAC7C;AACAzX,YAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBkD,oBAAvB;AACAjY,YAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBkD,oBAAvB;AACAW,YAAAA,aAAa,CAACtB,UAAD,EAAaxU,GAAb,EAAkB;AAC7BuF,cAAAA,IAAI,EAAEC,KAAK,CAACC,MAAN,CAAa,aAAb;AADuB,aAAlB,CAAb;AAGD;;AACD0P,UAAAA,oBAAoB;AACrB;;AACD;;AACF,WAAK,EAAL,CAtCF,CAsCW;;AACT,WAAK,EAAL;AAAS;AACP;;AACF;AACE,gBAAQlQ,CAAC,CAAC8Q,QAAV;AACE,eAAK,EAAL;AAAS;AACP,gBAAI9Q,CAAC,CAAC+Q,OAAN,EAAe;AACbxZ,cAAAA,WAAW,CAACe,SAAZ,CAAsB0Y,eAAtB,CACEzZ,WAAW,CAACgB,gBADd,EAEEgX,UAFF;AAIA;AACD;;AACD;;AACF,eAAK,GAAL,CAVF,CAUY;;AACV,eAAK,GAAL;AAAU;AACR,gBAAIvP,CAAC,CAAC+Q,OAAN,EAAe;AACbxZ,cAAAA,WAAW,CAACe,SAAZ,CAAsB2Y,kBAAtB,CACE1Z,WAAW,CAACgB,gBADd,EAEEgX,UAFF,EADa,CAKb;AACA;AACA;;AACA;AACD;;AACD;;AACF;AACE,gBAAI7X,EAAE,CAACC,KAAH,CAASqW,SAAT,CAAmBhO,CAAnB,EAAsB0P,OAAtB,KAAkC,MAAtC,EAA8C;AAC5C;AACd;AACA;AACA;AACA;AACA;AACA;AACc;AACA;AACA;AACA;AACD;;AApCL;;AA1CJ,KA3F8D,CA2K5D;;;AAEFvB,IAAAA,OAAO,CAACzW,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsBP,SAAS,CAAC,CAAD,CAA/B,CAAD,CAAP,CA7K8D,CA8K9D;;AACA;AACJ;AACA;AACA;AACI;AACA;AACA;AAEA;;AACA,QAAIA,SAAS,CAAC,CAAD,CAAb,EAAkB;AAChB,UAAM0Z,IAAI,GAAGxZ,EAAE,CAACC,KAAH,CAASwZ,OAAT,CAAiB3Z,SAAS,CAAC,CAAD,CAA1B,EAA+B,CAA/B,CAAb;;AACA,UACE0Z,IAAI,GAAG1Z,SAAS,CAAC,CAAD,CAAT,CAAa4Z,YAApB,GACAnD,MAAM,CAACoD,OAAP,GAAiBpD,MAAM,CAACqD,WAF1B,EAGE;AACA5Z,QAAAA,EAAE,CAACC,KAAH,CAAS4Z,WAAT,CAAqB/Z,SAAS,CAAC,CAAD,CAA9B,EAAmC,IAAnC,EAAyC,IAAzC,EAA+CyW,MAA/C;AACD;;AACD,UAAIiD,IAAI,GAAGjD,MAAM,CAACoD,OAAP,GAAiB,EAA5B,EAAgC;AAC9B3Z,QAAAA,EAAE,CAACC,KAAH,CAAS4Z,WAAT,CAAqB/Z,SAAS,CAAC,CAAD,CAA9B,EAAmC,IAAnC,EAAyC6C,SAAzC,EAAoD4T,MAApD;AACD;AACF;AACF,GApMD;;AAqMA,OAAKuD,uBAAL,GAA+B,UAAUxR,CAAV,EAAa;AAC1C,YAAQzI,WAAW,CAACe,SAAZ,CAAsBmZ,cAA9B;AACE,WAAK,CAAL;AACEC,QAAAA,kBAAkB,CAAC1R,CAAD,CAAlB;AACA;;AACF,WAAK,CAAL;AACEzI,QAAAA,WAAW,CAACe,SAAZ,CAAsBqZ,KAAtB,CAA4B3R,CAA5B;AACA;;AACF;AAPF;AASD,GAVD;AAYA;;AACA;AACF;AACA;AACA;AACA;AACE;AACA;AACA;AACA;AACA;;;AAEA,WAASzC,uBAAT,CAAkCyC,CAAlC,EAAqC;AACnC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAMqN,CAAC,GAAGX,MAAM,CAACpG,UAAjB;AACA,QAAMvM,OAAO,GAAGrC,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsB2U,MAAtB,CAAhB;AACA,QAAMpM,IAAI,GAAGN,CAAC,CAAC4R,MAAF,GAAWrR,KAAK,CAACC,MAAN,CAAa,UAAb,CAAX,GAAsCnG,SAAnD,CALmC,CAK0B;;AAE7D,QAAI2F,CAAC,CAAC4H,QAAN,EAAgB;AACd;AACAiK,MAAAA,cAAc,CAACxE,CAAD,EAAItT,OAAJ,EAAauG,IAAb,CAAd;AACD,KAHD,MAGO;AACL,UAAIN,CAAC,CAAC4R,MAAN,EAAc;AACZ;AACAf,QAAAA,aAAa,CAACxD,CAAD,EAAItT,OAAJ,EAAa;AACxBuG,UAAAA,IAAI,EAAEC,KAAK,CAACC,MAAN,CAAa,UAAb,CADkB;AAExBsR,UAAAA,SAAS,EAAE;AAFa,SAAb,CAAb;AAID,OAND,MAMO;AACLjB,QAAAA,aAAa,CAACxD,CAAD,EAAItT,OAAJ,CAAb;AACD;AACF;AACF;;AAED,WAASkO,yBAAT,CAAoCjI,CAApC,EAAuC;AACrC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAMjG,OAAO,GAAGrC,EAAE,CAACC,KAAH,CAASyY,QAAT,CAAkBrY,EAAlB,EAAsB2U,MAAtB,CAAhB;AACA,QAAMpM,IAAI,GAAGN,CAAC,CAAC4R,MAAF,GAAWrR,KAAK,CAACC,MAAN,CAAa,UAAb,CAAX,GAAsCnG,SAAnD;AACA,QAAMgT,CAAC,GAAGX,MAAM,CAACpG,UAAP,CAAkBA,UAA5B;AACAsK,IAAAA,eAAe,CAACvD,CAAD,EAAItT,OAAJ,EAAauG,IAAb,CAAf;AACD;;AAED,WAASrE,2BAAT,CAAsC+D,CAAtC,EAAyC;AACvC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAM3E,GAAG,GAAGqR,MAAM,CAAC/E,YAAP,CAAoB,KAApB,CAAZ,CAHuC,CAGA;;AACvC,QAAI3H,CAAC,CAAC4R,MAAN,EAAc;AACZ3Z,MAAAA,EAAE,CAAC8Z,KAAH,CAASra,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAT,EAAkC;AAChC2W,QAAAA,KAAK,EAAE;AADyB,OAAlC,EADY,CAGT;AACJ,KAJD,MAIO;AACL/Z,MAAAA,EAAE,CAACga,OAAH,CAAWla,EAAE,CAACsG,GAAH,CAAO3G,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAP,CAAX,EADK,CACuC;AAC7C;AACF;;AAED,WAASc,4BAAT,CAAuC6D,CAAvC,EAA0C;AACxC;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAM3E,GAAG,GAAGqR,MAAM,CAAC/E,YAAP,CAAoB,KAApB,CAAZ,CAHwC,CAGD;;AACvC,QAAI3H,CAAC,CAAC4R,MAAN,EAAc;AACZ3Z,MAAAA,EAAE,CAAC8Z,KAAH,CAASra,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAT,EAAkC;AAChC2W,QAAAA,KAAK,EAAE;AADyB,OAAlC;AAGD,KAJD,MAIO;AACL/Z,MAAAA,EAAE,CAACga,OAAH,CAAWla,EAAE,CAACsG,GAAH,CAAO3G,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAP,CAAX,EADK,CACuC;AAC7C;AACF;;AAED,WAASU,gCAAT,CAA2CiE,CAA3C,EAA8C;AAC5C,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAM3E,GAAG,GAAGqR,MAAM,CAAC/E,YAAP,CAAoB,KAApB,CAAZ,CAF4C,CAEL;;AACvC1P,IAAAA,EAAE,CAAC8Z,KAAH,CAASra,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAT;AACD;;AAED,WAASd,+BAAT,CAA0CyF,CAA1C,EAA6C;AAC3C;AACA,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAIlG,IAAI,GAAG4S,MAAM,CAAC5S,IAAlB;AACA,QAAIA,IAAI,CAAC+J,UAAL,CAAgB1K,MAAhB,GAAyB,CAA7B,EAAgCW,IAAI,GAAG4S,MAAM,CAACpG,UAAd,CAJW,CAIc;;AACzDO,IAAAA,gBAAgB,CAAC/M,IAAD,CAAhB,CAL2C,CAKpB;AACxB;;AAED,WAAS6E,yBAAT,CAAoCqB,CAApC,EAAuC;AACrC;AACA,QAAIzI,WAAW,CAACe,SAAZ,CAAsBmZ,cAA1B,EAA0C;AACxC,aAAOla,WAAW,CAACe,SAAZ,CAAsBqZ,KAAtB,CAA4B3R,CAA5B,CAAP;AACD;;AAED,QAAM0M,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf,CANqC,CAOrC;AACA;;AACA,QAAIlG,IAAJ;;AACA,SACEA,IAAI,GAAGpC,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkBiV,MAAlB,EAA0B,IAA1B,CADT,EAEE5S,IAAI,IAAI,EAAEA,IAAI,CAAC6N,YAAL,CAAkB,eAAlB,MAAuC,OAAzC,CAFV,EAE6D;AAC3D7N,IAAAA,IAAI,GAAGpC,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkBqC,IAAI,CAACwM,UAAvB,EAAmC,IAAnC,CAHT,EAIE,CACA;AACD;;AACD,QAAI,CAACxM,IAAL,EAAW,OAjB0B,CAmBrC;;AAEA,QAAMuP,GAAG,GAAG4D,QAAQ,CAACnT,IAAD,CAApB,CArBqC,CAsBrC;;AACApC,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,+BAA+BW,GAA5C;;AACA,QAAIrJ,CAAC,CAAC4R,MAAN,EAAc;AACZ9T,MAAAA,WAAW,CAAChE,IAAD,EAAO,CAACmT,QAAQ,CAACnT,IAAD,CAAhB,CAAX;AACD,KAFD,MAEO,IAAIkG,CAAC,CAAC4H,QAAN,EAAgB;AACrB9J,MAAAA,WAAW,CAAChE,IAAD,EAAO,IAAP,CAAX;AACD,KAFM,MAEA;AACL;AACAmV,MAAAA,WAAW;AACX1X,MAAAA,WAAW,CAACe,SAAZ,CAAsB4Z,iBAAtB,CAAwClS,CAAxC;AACAlC,MAAAA,WAAW,CAAChE,IAAD,EAAO,IAAP,CAAX;;AAEA,UAAIkG,CAAC,CAACmS,MAAF,KAAa,CAAjB,EAAoB;AAClB;AACAnS,QAAAA,CAAC,CAACqL,eAAF;AACA;AACD,OAVI,CAWL;AACA;;;AACA,UAAMtC,EAAE,GAAGjP,IAAI,CAACwM,UAAL,CAAgBzG,cAA3B;AACA,UAAI,CAACkJ,EAAL,EAAS,OAdJ,CAcW;;AAChB,UAAM2D,OAAM,GAAG3D,EAAE,CAAC9L,GAAlB;AACA,UAAM6R,QAAQ,GAAGpX,EAAE,CAACM,KAAH,CAAS+W,OAAT,CAAiBD,QAAjB,CAA0BpC,OAAM,CAACrR,GAAjC,EAAsCtD,EAAtC,CAAjB;AACA,UAAIsR,GAAG,IAAIyF,QAAX,EAAqBvX,WAAW,CAACe,SAAZ,CAAsBqZ,KAAtB,CAA4B3R,CAA5B,EAA+BxI,SAAS,CAAC,CAAD,CAAxC,EAjBhB,CAiB6D;AAClE;AACA;AACD;;AACDE,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CACE,8BACEuE,QAAQ,CAACnT,IAAD,CADV,GAEE,UAFF,GAGEtC,SAAS,CAAC2B,MAJd,EAjDqC,CAuDrC;;AACA;AACJ;AACA;AACA;AACA;AACA;;AACI6G,IAAAA,CAAC,CAACqL,eAAF,GA9DqC,CA+DrC;AACD;;AAED,WAASqG,kBAAT,CAA6B1R,CAA7B,EAAgC;AAC9BtI,IAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,8CAA8C1C,GAAG,CAAC6U,QAA9D;AACA,QAAMY,MAAM,GAAGnV,WAAW,CAAC6V,QAAZ,CAAqBpN,CAArB,CAAf;AACA,QAAI,CAAC0M,MAAL,EAAa;AACb,QAAM0F,KAAK,GAAG1F,MAAM,CAACgD,OAArB,CAJ8B,CAK9B;AACA;AACA;AACA;;AACA,QAAI0C,KAAK,KAAK,OAAV,IAAqBA,KAAK,KAAK,UAAnC,EAA+C;AAC7C;AACD,KAX6B,CAa9B;;;AACA7a,IAAAA,WAAW,CAACe,SAAZ,CAAsB+Z,SAAtB,GAd8B,CAgB9B;;AACA,QACE9a,WAAW,CAACe,SAAZ,CAAsBga,YAAtB,IACA/a,WAAW,CAACe,SAAZ,CAAsBga,YAAtB,CAAmChM,UAAnC,CAA8CK,WAFhD,EAGE;AACApP,MAAAA,WAAW,CAACe,SAAZ,CAAsBia,OAAtB;AACD,KAtB6B,CAwB9B;AACA;;;AAEA,QACE,CAAC7F,MAAM,CAACvS,GAAR,IACCuS,MAAM,CAACvS,GAAP,CAAWqB,KAAX,CAAiBkR,MAAM,CAACvS,GAAP,CAAW+K,OAAX,CAAmB,SAAnB,IAAgC,CAAjD,MACC/N,yBAAagD,GAAb,CAAiBqY,iBADlB,IAEC9F,MAAM,CAACvS,GAAP,CAAWqB,KAAX,CAAiBkR,MAAM,CAACvS,GAAP,CAAW+K,OAAX,CAAmB,SAAnB,IAAgC,CAAjD,MACE/N,yBAAagD,GAAb,CAAiBsY,eALvB,EAME;AACAlb,MAAAA,WAAW,CAACe,SAAZ,CAAsB4Z,iBAAtB,CAAwClS,CAAxC;AACD;;AAED,QACE,CAAC0M,MAAM,CAACvS,GAAR,IACAuS,MAAM,CAACvS,GAAP,CAAWqB,KAAX,CAAiBkR,MAAM,CAACvS,GAAP,CAAW+K,OAAX,CAAmB,SAAnB,IAAgC,CAAjD,MACE/N,yBAAagD,GAAb,CAAiBqY,iBAHrB,EAIE;AACAjb,MAAAA,WAAW,CAACe,SAAZ,CAAsB+Z,SAAtB;AACD;;AAED,QAAIrS,CAAJ,EAAOA,CAAC,CAACqL,eAAF;AACR,GA12D+B,CA02D9B;;;AAEF,WAASqH,iBAAT,CAA4B3Y,OAA5B,EAAqC;AACnC9C,IAAAA,GAAG,CAAC8V,KAAJ,GAAYrV,EAAE,CAACC,KAAH,CAASwJ,KAAT,CAAepH,OAAf,CAAZ;;AACA,QAAI9C,GAAG,CAAC6U,QAAJ,CAAaC,IAAb,CAAkB4G,UAAlB,CAA6B5Y,OAAO,CAAC6Y,IAAR,GAAevX,GAA5C,CAAJ,EAAsD,CACpD;AACD;AACF;AAED;AACF;AACA;;;AACE,WAASwV,aAAT,CAAwBxD,CAAxB,EAA2BwF,QAA3B,EAAqCzR,OAArC,EAA8C;AAC5CA,IAAAA,OAAO,GAAGA,OAAO,IAAI,EAArB;AACA,QAAMd,IAAI,GAAGc,OAAO,CAACd,IAArB;AACA,QAAIwS,OAAO,GAAG,CAAC,CAAC1R,OAAO,CAAC0R,OAAxB;AACA,QAAMhB,SAAS,GAAG1Q,OAAO,CAAC0Q,SAA1B;AAEApa,IAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,gCAAgC1C,GAAG,CAAC6U,QAAhD,EAN4C,CAO5C;;AACA7T,IAAAA,EAAE,CAACqY,cAAH,CAAkB,MAAlB,EAA0B,QAA1B;AACArY,IAAAA,EAAE,CAACqY,cAAH,CAAkB,MAAlB,EAA0B,QAA1B;AAEA,QAAIvW,OAAO,GAAGhC,EAAE,CAAC4Q,KAAH,CAASkK,QAAT,CAAd,CAX4C,CAY5C;;AAEA,aAASzL,MAAT,GAAmB;AACjBrN,MAAAA,OAAO,GAAGhC,EAAE,CAAC4Q,KAAH,CAAS5O,OAAT,CAAV;AACA,UAAI,CAACsT,CAAD,IAAM,CAACA,CAAC,CAAC/G,UAAT,IAAuB,CAAC+G,CAAC,CAAC/G,UAAF,CAAaA,UAAzC,EAAqD,OAAO,KAAP;AAErD,UAAIyM,QAAJ;AACArb,MAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,gBAAZ;;AACA,UAAI,CAACmZ,OAAL,EAAc;AACZ;AACAC,QAAAA,QAAQ,GAAGtK,aAAa,CAAC1O,OAAD,EAAUM,SAAV,EAAqBiG,IAArB,EAA2Bc,OAA3B,CAAxB;AACD,OAHD,MAGO;AACL1J,QAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,gBAAgB0T,CAA5B;;AACA,aACE0F,QAAQ,GAAG1F,CAAC,CAAC3O,UADf,EAEEqU,QAAQ,CAACpM,WAFX,EAGEoM,QAAQ,GAAGA,QAAQ,CAACpM,WAHtB,EAIE;AACAjP,UAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CAAY,wBAAwBoZ,QAApC;AACA,cAAIA,QAAQ,CAACxM,QAAT,KAAsB,OAA1B,EAAmC;AACpC;;AACDwM,QAAAA,QAAQ,GAAGtK,aAAa,CAAC1O,OAAD,EAAUgZ,QAAV,EAAoBzS,IAApB,EAA0Bc,OAA1B,CAAxB;AACD;;AACD0R,MAAAA,OAAO,GAAG,IAAV;;AACA,UACEpb,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkB4V,CAAlB,EAAqB,OAArB,KACA3V,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkB4V,CAAlB,EAAqB,OAArB,EAA8B3S,KAA9B,CAAoCoH,eAApC,KAAwD,OAF1D,EAGE;AACAiR,QAAAA,QAAQ,CAACrY,KAAT,CAAeoH,eAAf,GAAiC,MAAjC;AACD,OALD,MAKO;AACLiR,QAAAA,QAAQ,CAACrY,KAAT,CAAeoH,eAAf,GAAiC,OAAjC;AACD;;AACD,UAAI;AACF,YAAIkR,qBAAMC,IAAN,CAAWC,KAAX,CAAiBC,GAArB,EAA0B;AACxBH,+BAAMC,IAAN,CAAWC,KAAX,CAAiBC,GAAjB,CAAqB9F,CAArB,EAAwB,WAAxB,EAAqC,eAArC;AACD;AACF,OAJD,CAIE,OAAOrN,CAAP,EAAU;AACVqB,QAAAA,OAAO,CAAC3H,GAAR,CAAY,WAAWsG,CAAvB;AACD;;AACDtI,MAAAA,EAAE,CAACC,KAAH,CAASyb,SAAT,CAAmB/F,CAAnB,EAAsBxS,WAAtB,CAAkCkY,QAAlC;AACAxb,MAAAA,WAAW,CAAC8Y,OAAZ,GAAsBhD,CAAtB,CAtCiB,CAsCO;;AACxB3V,MAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,sBAAsB3O,OAAtB,GAAgC,WAA7C,EAvCiB,CAwCjB;AACA;AACA;;AACA,UAAMsZ,WAAW,GAAGtb,EAAE,CAACqG,IAAH,CAAQrE,OAAR,EAAiBrC,EAAE,CAAC+F,EAAH,CAAM6V,IAAN,CAAW,SAAX,CAAjB,CAApB;;AACA,WAAK,IAAIra,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGoa,WAAW,CAACla,MAAhC,EAAwCF,CAAC,EAAzC,EAA6C;AAC3C,YAAIA,CAAC,KAAK,EAAV,EAAc;AACZvB,UAAAA,EAAE,CAACgC,GAAH,CAAOuK,IAAP,CACE,4BACEoP,WAAW,CAACla,MADd,GAEE,sBAFF,GAGEY,OAJJ,EADY,CAOZ;AACD;;AACD9B,QAAAA,EAAE,CAACsb,WAAH,CAAeF,WAAW,CAACpa,CAAD,CAA1B,EAA+Bc,OAA/B;AACD;AACF;;AAED,aAASyZ,MAAT,CAAiBnY,GAAjB,EAAsB;AACpB,UAAInC,SAAS,CAAC,CAAD,CAAb,EAAkB,OAAO,IAAP,CADE,CACU;;AAC9B,UAAMua,OAAO,GAAG1b,EAAE,CAAC4Q,KAAH,CAAS5O,OAAT,CAAhB,CAFoB,CAEc;;AAClCrC,MAAAA,EAAE,CAACgC,GAAH,CAAOC,IAAP,CACE,iCACE8Z,OADF,GAEE,QAFF,GAGEpY,GAHF,GAIE,YAJF,GAKEyX,OANJ,EAHoB,CAWpB;;AACA,UAAMY,OAAO,GAAG3b,EAAE,CAACsG,GAAH,CAAO3G,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBF,GAAnB,CAAP,CAAhB;;AACA,UAAIA,GAAG,CAAC6J,OAAJ,CAAY,GAAZ,KAAoB,CAAxB,EAA2B;AACzB,cAAM,IAAI3D,KAAJ,CAAU,6BAA6BlG,GAAvC,CAAN;AACD;;AAED,UAAMsY,QAAQ,GAAG,SAAXA,QAAW,GAAY;AAC3B;AACA,YAAI,CAACF,OAAO,CAACpY,GAAb,EAAkB,OAAO,IAAP,CAFS,CAEG;;AAC9B,YAAMuY,EAAE,GAAG7b,EAAE,CAACkD,IAAH,CAAQwY,OAAR,CAAX;AACA,YAAI,CAACG,EAAL,EAAS,OAAO,KAAP;;AACT,aAAK,IAAI3a,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG2a,EAAE,CAACza,MAAvB,EAA+BF,CAAC,EAAhC,EAAoC;AAClC;AACA,eACE,IAAI4a,EAAE,GAAGnc,EAAE,CAACG,GAAH,CAAOwD,GAAP,CAAWE,OAAX,CAAmBqY,EAAE,CAAC3a,CAAD,CAArB,CADX,EAEE4a,EAFF,EAGEA,EAAE,GAAG9b,EAAE,CAAC+b,aAAH,CAAiBD,EAAjB,CAHP,EAIE;AACA,gBAAIxY,GAAG,KAAKwY,EAAZ,EAAgB,OAAO,IAAP;AACjB;AACF;;AACD,YAAI9b,EAAE,CAACgc,oBAAH,CAAwBN,OAAxB,EAAiCpZ,SAAjC,EAA4CA,SAA5C,EAAuDqZ,OAAvD,CAAJ,EAAqE;AACnE,iBAAO,IAAP;AACD,SAjB0B,CAiBzB;;;AACF,eAAO,KAAP;AACD,OAnBD;;AAoBA,UAAIC,QAAQ,EAAZ,EAAgB;AACdjc,QAAAA,EAAE,CAACgC,GAAH,CAAOsa,OAAP,CACE,oCACEP,OADF,GAEE,QAFF,GAGEpY,GAHF,GAIE,WAJF,GAKEyX,OANJ;AASA1L,QAAAA,MAAM;AACN,eAAO,KAAP,CAXc,CAWD;AACd;;AACD,aAAO,IAAP;AACD,KA3H2C,CA4H5C;;;AAEA,QAAIhG,OAAO,CAAC4G,IAAZ,EAAkB;AAChB0K,MAAAA,iBAAiB,CAAC3Y,OAAD,CAAjB;AACD;;AACDrC,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,kCAAkC3O,OAA/C;AACA,QAAMka,MAAM,GAAGhd,GAAG,CAAC8F,aAAJ,CAAkB,MAAlB,CAAf;AACAsQ,IAAAA,CAAC,CAACxS,WAAF,CAAcoZ,MAAd;AACAhc,IAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBwG,MAAvB,EApI4C,CAoIb;;AAC/Bvb,IAAAA,EAAE,CAAC+U,WAAH,CAAe,MAAf,EAAuBwG,MAAvB,EArI4C,CAqIb;;AAE/B,QAAMU,gBAAgB,GAAG,EAAzB,CAvI4C,CAuIhB;AAC5B;;AACA,QAAIna,OAAO,CAACsB,GAAR,IAAetB,OAAO,CAACsB,GAAR,CAAY2H,KAAZ,CAAkB,GAAlB,EAAuB,CAAvB,MAA8B,KAAjD,EAAwD;AACtD;AACAoE,MAAAA,MAAM;AACN;AACD;;AAED,SAAK,IAAInO,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGib,gBAAgB,CAAC/a,MAArC,EAA6CF,CAAC,EAA9C,EAAkD;AAChD,UAAIkb,UAAJ;;AACA,UAAIA,UAAU,KAAKD,gBAAgB,CAACjb,CAAD,CAAhB,CAAoBc,OAApB,CAAnB,EAAiD;AAC/CqN,QAAAA,MAAM;AACN1P,QAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,cAAb;AACA,YAAIyL,UAAU,CAAC,CAAD,CAAd,EAAmB1b,cAAc,CAAC+P,WAAf,CAA2B/P,cAAc,CAACgX,SAA1C;AACnB;AACD;AACF;;AACD,QACE1V,OAAO,CAACsB,GAAR,IACA,CAACyW,SADD,IAEA,CAACpa,EAAE,CAACyQ,OAAH,CAAWiM,OAAX,CAAmBra,OAAnB,CAFD,IAGA,CAACrC,EAAE,CAACyQ,OAAH,CAAWkM,OAAX,CAAmBta,OAAnB,CAHD,IAGgC;AAChC,KAAChC,EAAE,CAACuc,KAAH,CACCva,OADD,EAECrC,EAAE,CAAC+F,EAAH,CAAM5F,GAAN,CAAU,MAAV,CAFD,EAGC0c,IAAI,CAACC,IAAL,CAAUC,cAAV,CAAyB,iBAAzB,CAHD,CALH,EAUE;AACA;AACA;AACAxc,MAAAA,EAAE,CAACyc,gBAAH,CAAoB3a,OAAO,CAAC6I,GAAR,EAApB,EAAmCvI,SAAnC,EAA8C,UAAUsa,EAAV,EAAclQ,IAAd,EAAoB;AAChE,YAAIkQ,EAAJ,EAAQ;AACN1c,UAAAA,EAAE,CAACsb,WAAH,CAAexZ,OAAf;AACAqN,UAAAA,MAAM,GAFA,CAEG;;AACT,cAAIhG,OAAO,CAAC4G,IAAZ,EAAkB;AAChB;AACA;AACA0K,YAAAA,iBAAiB,CAAC3Y,OAAD,CAAjB;AACD;AACF,SARD,MAQO;AACL,cAAM6a,OAAO,GAAG3d,GAAG,CAAC8F,aAAJ,CAAkB,KAAlB,CAAhB;AACA6X,UAAAA,OAAO,CAAC1T,WAAR,GAAsBuD,IAAtB;AACAmQ,UAAAA,OAAO,CAACpa,YAAR,CAAqB,OAArB,EAA8B,yBAA9B;AACAoa,UAAAA,OAAO,CAAC1T,WAAR,GACE,qCAAqCnH,OAAO,CAAC6I,GAAR,EAArC,GAAqD,IAArD,GAA4D6B,IAD9D;AAEA4I,UAAAA,CAAC,CAACxS,WAAF,CAAc+Z,OAAd;AACD;AACF,OAjBD;AAkBD,KA/BD,MA+BO;AACLxN,MAAAA,MAAM;AACP;AACF,GAhjE+B,CAgjE9B;;;AAEF,WAASwJ,eAAT,CAA0BvD,CAA1B,EAA6BtT,OAA7B,EAAsC;AACpC,QAAI0N,GAAG,GAAG/P,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkB4V,CAAlB,EAAqB,IAArB,CAAV;AACA5F,IAAAA,GAAG,GAAG/P,EAAE,CAACC,KAAH,CAASF,QAAT,CAAkBgQ,GAAG,CAACnB,UAAtB,EAAkC,IAAlC,CAAN,CAFoC,CAEU;;AAC9C,QAAImB,GAAJ,EAAS,IAAI5K,SAAS,GAAG4K,GAAG,CAAC5H,cAApB;AACT,QAAIgV,KAAJ,CAJoC,CAI1B;;AACV,SACEA,KAAK,GAAGxH,CAAC,CAAC/G,UADZ,EAEEuO,KAAK,CAACnF,OAAN,KAAkB,IAFpB,EAGEmF,KAAK,GAAGA,KAAK,CAACvO,UAHhB,EAIE;AACA,UAAI,OAAOuO,KAAP,KAAiB,WAArB,EAAkC;AAChCvT,QAAAA,KAAK,CAAC,qBAAD,CAAL;AACA;AACD;AACF;;AAED5J,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,wBAAwB3O,OAArC;AACA,QAAI+a,MAAJ;;AACA,QAAIjY,SAAJ,EAAe;AACbnF,MAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,qBAAqB7L,SAAS,CAACgC,SAAV,CAAoBxD,GAAzC,GAA+C,aAA5D;AACAyZ,MAAAA,MAAM,GAAG/K,KAAK,CAACC,QAAN,CAAenN,SAAS,CAACgC,SAAV,CAAoBxD,GAAnC,CAAT;AACD;;AACD3D,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,WAAWoM,MAAxB;;AACA,QAAID,KAAK,CAACvO,UAAN,CAAiBA,UAAjB,CAA4BhC,EAA5B,KAAmC,SAAvC,EAAkD;AAChD,UAAI1H,UAAU,GAAGiY,KAAK,CAACvO,UAAvB;AACD;;AACD/O,IAAAA,WAAW,CAACwd,SAAZ,CACExd,WAAW,CAACmF,eAAZ,CAA4B3C,OAA5B,EAAqC+a,MAArC,EAA6ClY,UAA7C,EAAyDC,SAAzD,CADF,EAEEgY,KAFF;AAID,GAhlE+B,CAglE9B;;;AAEF,OAAKE,SAAL,GAAiB,SAASA,SAAT,CAAoBC,KAApB,EAA2BC,UAA3B,EAAuC;AACtD,QAAIC,QAAJ;AACA,QAAIjI,QAAQ,CAACgI,UAAD,CAAZ,EAA0BC,QAAQ,GAAG,IAAX,CAF4B,CAItD;AACA;;AACA,SAAK,IAAI1L,CAAC,GAAGhS,SAAS,CAAC2B,MAAV,GAAmB,CAAhC,EAAmCqQ,CAAC,GAAG,CAAC,CAAxC,EAA2CA,CAAC,EAA5C,EAAgD;AAC9C,WAAK,IAAIoC,GAAG,GAAGpU,SAAS,CAACgS,CAAD,CAAxB,EAA6BoC,GAAG,CAACtF,UAAjC,EAA6CsF,GAAG,GAAGA,GAAG,CAACtF,UAAvD,EAAmE;AACjE,YAAIsF,GAAG,KAAKqJ,UAAZ,EAAwB;AACtBnX,UAAAA,WAAW,CAACtG,SAAS,CAACgS,CAAD,CAAV,EAAe,KAAf,CAAX;AACD;AACF;AACF;;AAEDyL,IAAAA,UAAU,CAAC3O,UAAX,CAAsBiC,YAAtB,CAAmCyM,KAAnC,EAA0CC,UAA1C;AACA,QAAIC,QAAJ,EAAcpX,WAAW,CAACkX,KAAD,EAAQ,IAAR,CAAX;AACf,GAhBD;;AAkBA,WAASnD,cAAT,CAAyBxE,CAAzB,EAA4BtT,OAA5B,EAAqC;AACnC;AACA,QAAIob,KAAK,GAAG,IAAZ;;AACA,SAAK,IAAIN,KAAK,GAAGxH,CAAC,CAAC/G,UAAnB,EAA+BuO,KAA/B,EAAsCA,KAAK,GAAGA,KAAK,CAACvO,UAApD,EAAgE;AAC9D5O,MAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,WAAWmM,KAAK,CAACnF,OAA9B;AACA,UAAImF,KAAK,CAACnF,OAAN,KAAkB,IAAtB,EAA4ByF,KAAK,GAAGN,KAAR;AAC7B,KANkC,CAMjC;;;AACFnd,IAAAA,EAAE,CAACC,KAAH,CAASyb,SAAT,CAAmB+B,KAAnB,EAA0Bta,WAA1B,CAAsC4N,aAAa,CAAC1O,OAAD,CAAnD;AACA2Y,IAAAA,iBAAiB,CAAC3Y,OAAD,CAAjB,CARmC,CASnC;;AACAob,IAAAA,KAAK,CAAC3a,YAAN,CAAmB,OAAnB,EAA4BT,OAAO,CAACU,IAAR,EAA5B;AACD,GA/mE+B,CA+mE9B;;;AAEFnD,EAAAA,OAAO,CAACua,cAAR,GAAyBA,cAAzB,CAjnEgC,CAmnEhC;AACA;;AACA;AACF;AACA;AACA;AACA;AACA;AACA;;AACE,OAAKuD,oBAAL,GAA4B,UAAUpV,CAAV,EAAa;AACvC,QAAIA,CAAC,CAACiQ,OAAF,KAAc,EAAlB,EAAsB3Y,OAAO,CAAC+d,WAAR,CAAoBrV,CAApB;AACvB,GAFD;;AAGA,OAAKqV,WAAL,GAAmB,UAAUC,EAAV,EAAc;AAC/BC,IAAAA,OAAO,CAACte,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,EAA8BnH,KAA/B,CAAP;AACD,GAFD;;AAIA,WAASmY,OAAT,CAAkBla,GAAlB,EAAuB;AACrB,QAAMtB,OAAO,GAAGhC,EAAE,CAACsG,GAAH,CAAOhD,GAAP,CAAhB;AACA,SAAKwF,WAAL,CAAiB9G,OAAjB,EAA0B,IAA1B;AACD;;AACD,OAAKyb,WAAL,GAAmB,UAAUna,GAAV,EAAe;AAChC,QAAMtB,OAAO,GAAGhC,EAAE,CAACsG,GAAH,CAAOhD,GAAP,CAAhB;AACA,SAAKwF,WAAL,CAAiB9G,OAAjB;AACD,GAHD;AAKA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEE,OAAK8G,WAAL,GAAmB,UAAU9G,OAAV,EAAmByZ,MAAnB,EAA2BlT,IAA3B,EAAiC0H,IAAjC,EAAuCyN,QAAvC,EAAiD9c,KAAjD,EAAwD;AACzEA,IAAAA,KAAK,GAAGA,KAAK,IAAI1B,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,CAAjB,CADyE,CAC1B;;AAC/C,QAAIyD,IAAJ,EAAU;AACRtQ,MAAAA,EAAE,CAACC,KAAH,CAASyb,SAAT,CAAmBza,KAAnB;AACAA,MAAAA,KAAK,CAAC+B,KAAN,CAAY8E,KAAZ,GAAoB,MAApB;AACD;;AAED,aAASkW,kBAAT,GAA+B;AAC7B,UAAM5P,EAAE,GAAG7O,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAX;AACA+I,MAAAA,EAAE,CAACpL,KAAH,CAASib,aAAT,GAAyB,KAAzB;AACAhd,MAAAA,KAAK,CAACkC,WAAN,CAAkBiL,EAAlB;AACA,UAAMhJ,EAAE,GAAGvF,WAAW,CAACmF,eAAZ,CAA4B3C,OAA5B,EAAqCM,SAArC,EAAgDyL,EAAhD,CAAX;AACAA,MAAAA,EAAE,CAACjL,WAAH,CAAeiC,EAAf;AACA,aAAOA,EAAP;AACD;;AAED,QAAMA,EAAE,GAAG4Y,kBAAkB,EAA7B;AAEA,QAAI1N,IAAJ,EAAU0K,iBAAiB,CAAC3Y,OAAD,CAAjB,CAlB+D,CAkBpC;;AAErC,QAAIyZ,MAAJ,EAAY;AACV3C,MAAAA,aAAa,CAAC/T,EAAD,EAAK/C,OAAL,EAAc;AACzBuG,QAAAA,IAAI,EAAEA,IADmB;AAEzB0H,QAAAA,IAAI,EAAEA;AAFmB,OAAd,CAAb;AAIA,UAAMlC,EAAE,GAAGhJ,EAAE,CAACwJ,UAAd;AACA5O,MAAAA,EAAE,CAACC,KAAH,CAAS4Z,WAAT,CAAqBzL,EAArB,EAAyB,KAAzB,EAAgCzL,SAAhC,EAA2C4T,MAA3C,EANU,CAMyC;AACpD;;AAED,QACEjG,IAAI,IACJ/Q,GADA,IAEAA,GAAG,CAAC2e,WAFJ,IAGA3e,GAAG,CAAC2e,WAAJ,CAAgBC,OAHhB,IAIA;AACA;AACA3e,IAAAA,QAAQ,CAAC4U,QAAT,CAAkBC,IAAlB,KAA2BhS,OAAO,CAACsB,GAPrC,EAQE;AACA,UAAMya,QAAQ,GAAGxV,IAAI,GAAG;AAAEG,QAAAA,QAAQ,EAAEH,IAAI,CAAC4G;AAAjB,OAAH,GAA6B,EAAlD;;AACA,UAAI;AACF;AACAjQ,QAAAA,GAAG,CAAC2e,WAAJ,CAAgBC,OAAhB,CAAwBE,SAAxB,CAAkCD,QAAlC,EAA4C/b,OAAO,CAACsB,GAApD,EAAyDtB,OAAO,CAACsB,GAAjE;AACD,OAHD,CAGE,OAAO2E,CAAP,EAAU;AACVqB,QAAAA,OAAO,CAAC3H,GAAR,CAAYsG,CAAZ;AACD;AACF;;AAED,WAAOjG,OAAP;AACD,GAhDD,CArpEgC,CAusEhC;AACA;AACA;AACA;AACA;AACA;AACA;;;AAEA,MAAI0D,EAAE,GAAG/F,EAAE,CAAC+F,EAAZ;AAEA,MAAMsM,KAAK,GAAG,+BAAc9S,GAAd,CAAd,CAjtEgC,CAmtEhC;;AACA;;AAEA,WAAS2G,mBAAT,CAA8B7C,GAA9B,EAAmC;AACjC;AACA,QAAIib,GAAJ,CAFiC,CAEzB;;AAER,QAAIjb,GAAG,CAACC,QAAJ,KAAiB,SAArB,EAAgC;AAC9B,UAAMib,MAAM,GAAG;AACbC,QAAAA,OAAO,EAAE,oBADI;AAEbC,QAAAA,OAAO,EAAE,kBAFI;AAGb,kBAAQ;AAHK,OAAf;AAKAH,MAAAA,GAAG,GAAG/e,GAAG,CAAC8F,aAAJ,CAAkB,MAAlB,CAAN;AACAiZ,MAAAA,GAAG,CAAC9U,WAAJ,GAAkBnG,GAAG,CAACqC,KAAtB,CAP8B,CAQ9B;;AACA,UAAI1C,KAAK,GAAG,EAAZ;;AACA,UAAIK,GAAG,CAACqb,QAAJ,IAAgBrb,GAAG,CAACqb,QAAJ,CAAa/a,GAAjC,EAAsC;AACpC,YAAMgb,GAAG,GAAG3e,EAAE,CAAC+F,EAAH,CAAM4Y,GAAN,CAAU,EAAV,EAAchb,GAA1B;;AACA,YAAIN,GAAG,CAACqb,QAAJ,CAAa/a,GAAb,CAAiBG,KAAjB,CAAuB,CAAvB,EAA0B6a,GAAG,CAACld,MAA9B,MAA0Ckd,GAA9C,EAAmD;AACjD3b,UAAAA,KAAK,GAAGub,MAAM,CAAClb,GAAG,CAACqb,QAAJ,CAAa/a,GAAb,CAAiBG,KAAjB,CAAuB6a,GAAG,CAACld,MAA3B,CAAD,CAAd;AACD;AACF;;AACD6c,MAAAA,GAAG,CAACxb,YAAJ,CAAiB,OAAjB,EAA0BE,KAAK,IAAI,wBAAnC;AACD,KAjBD,MAiBO,IAAIK,GAAG,CAACC,QAAJ,KAAiB,WAAjB,IAAgCD,GAAG,CAACC,QAAJ,KAAiB,WAArD,EAAkE;AACvEgb,MAAAA,GAAG,GAAG/e,GAAG,CAAC8F,aAAJ,CAAkB,MAAlB,CAAN;AACAiZ,MAAAA,GAAG,CAACxb,YAAJ,CAAiB,OAAjB,EAA0BO,GAAG,CAACN,IAAJ,EAA1B;AACAlD,MAAAA,WAAW,CAACuD,iBAAZ,CAA8B/C,EAA9B,EAAkCie,GAAlC,EAAuCjb,GAAvC;;AAEA,UAAIA,GAAG,CAACC,QAAJ,KAAiB,WAArB,EAAkC;AAChC,YAAID,GAAG,CAACM,GAAJ,CAAQG,KAAR,CAAc,CAAd,EAAiB,CAAjB,MAAwB,MAA5B,EAAoC;AAClC,cAAMqS,GAAG,GAAG9S,GAAG,CAACM,GAAJ,CAAQG,KAAR,CAAc,CAAd,CAAZ;AACA,cAAM8a,MAAM,GAAGrf,GAAG,CAAC8F,aAAJ,CAAkB,GAAlB,CAAf;AACAiZ,UAAAA,GAAG,CAACnb,WAAJ,CAAgB5D,GAAG,CAACsI,cAAJ,CAAmBsO,GAAnB,CAAhB;AACAyI,UAAAA,MAAM,CAAC9b,YAAP,CAAoB,MAApB,EAA4BO,GAAG,CAACM,GAAhC;AACAib,UAAAA,MAAM,CAACzb,WAAP,CACEnD,EAAE,CAACC,KAAH,CAASuC,SAAT,CACE/C,yBAAagD,GAAb,CAAiBoc,cADnB,EAEE,OAFF,EAGE,WAAW1I,GAHb,EAIE5W,GAJF,CADF;AAQA+e,UAAAA,GAAG,CAACnb,WAAJ,CAAgByb,MAAhB;AACAA,UAAAA,MAAM,CAAC5X,UAAP,CAAkBlE,YAAlB,CAA+B,OAA/B,EAAwC,WAAxC;AACD,SAfD,MAeO;AACL;AACAwb,UAAAA,GAAG,CAACnb,WAAJ,CAAgB5D,GAAG,CAACsI,cAAJ,CAAmB7H,EAAE,CAACC,KAAH,CAASwJ,KAAT,CAAepG,GAAf,CAAnB,CAAhB;;AACA,cAAMub,OAAM,GAAG5e,EAAE,CAACyQ,OAAH,CAAWqO,QAAX,CAAoBvf,GAApB,EAAyB8D,GAAzB,CAAf;;AACAib,UAAAA,GAAG,CAACnb,WAAJ,CAAgByb,OAAhB;AACA5e,UAAAA,EAAE,CAACyQ,OAAH,CAAWC,aAAX,CAAyB4N,GAAzB,EAA8Bjb,GAA9B,EALK,CAK8B;AACpC;AACF,OAvBD,MAuBO;AACL;AACAib,QAAAA,GAAG,CAACnb,WAAJ,CAAgB5D,GAAG,CAACsI,cAAJ,CAAmB7H,EAAE,CAACC,KAAH,CAASwJ,KAAT,CAAepG,GAAf,CAAnB,CAAhB;AACD;AACF,KAhCM,MAgCA,IAAIA,GAAG,CAACC,QAAJ,KAAiB,YAArB,EAAmC;AACxC;AACAgb,MAAAA,GAAG,GAAG/e,GAAG,CAAC8F,aAAJ,CAAkB,OAAlB,CAAN;AACAiZ,MAAAA,GAAG,CAACxb,YAAJ,CAAiB,OAAjB,EAA0B,cAA1B;AACAwb,MAAAA,GAAG,CAACxb,YAAJ,CAAiB,OAAjB,EAA0BO,GAAG,CAACN,IAAJ,EAA1B;AACA;AACN;AACA;AACA;AACA;;AAEM,WAAK,IAAIxB,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG8B,GAAG,CAACqE,QAAJ,CAAajG,MAAjC,EAAyCF,CAAC,EAA1C,EAA8C;AAC5C,YAAM2S,GAAG,GAAG7Q,GAAG,CAACqE,QAAJ,CAAanG,CAAb,CAAZ;AACA,YAAMwO,GAAG,GAAGuO,GAAG,CAACnb,WAAJ,CAAgB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAhB,CAAZ;AACA,YAAM0Z,OAAO,GAAGhP,GAAG,CAAC5M,WAAJ,CAAgB5D,GAAG,CAAC8F,aAAJ,CAAkB,IAAlB,CAAhB,CAAhB;AACA0Z,QAAAA,OAAO,CAACjc,YAAR,CACE,OADF,EAEE,+DAFF;AAIAic,QAAAA,OAAO,CAACjc,YAAR,CAAqB,eAArB,EAAsC,OAAtC;AACAic,QAAAA,OAAO,CAACjc,YAAR,CAAqB,OAArB,EAA8BO,GAAG,CAACN,IAAJ,EAA9B;AACAgc,QAAAA,OAAO,CAAClY,SAAR,GAAoBtF,CAAC,GAAG,CAAJ,GAAQ,GAA5B;AACAwO,QAAAA,GAAG,CAAC5M,WAAJ,CAAgBtD,WAAW,CAACmF,eAAZ,CAA4BkP,GAA5B,CAAhB;AACD;AACF,KAxBM,MAwBA,IAAI7Q,GAAG,CAACC,QAAJ,KAAiB,OAArB,EAA8B;AACnCgb,MAAAA,GAAG,GAAGzV,KAAK,CACRC,MADG,CACI,iBADJ,EAEHkW,kBAFG,CAEgB3b,GAAG,CAACnB,UAFpB,EAEgC5C,OAFhC,CAAN;AAGAgf,MAAAA,GAAG,CAACxb,YAAJ,CAAiB,OAAjB,EAA0B,eAA1B;AACD,KALM,MAKA;AACL9C,MAAAA,EAAE,CAACgC,GAAH,CAAO2C,KAAP,CAAa,YAAYtB,GAAZ,GAAkB,0BAAlB,GAA+CA,GAAG,CAACC,QAAhE;AACAgb,MAAAA,GAAG,GAAG/e,GAAG,CAACsI,cAAJ,CAAmB,sBAAsBxE,GAAG,CAACC,QAA1B,GAAqC,GAAxD,CAAN;AACD,KArFgC,CAqF/B;;;AACFtD,IAAAA,EAAE,CAACgC,GAAH,CAAOgP,KAAP,CAAa,eAAesN,GAAG,CAACzX,SAAhC;AACA,WAAOyX,GAAP;AACD,GA9yE+B,CA8yE9B;;;AAEF,OAAKW,YAAL,GAAoB,YAAY;AAC9B1f,IAAAA,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,EAA8BnH,KAA9B,GACEnG,GAAG,CAAC2f,GAAJ,GAAU,OAAV,GAAoB3f,GAAG,CAACsN,cAAJ,CAAmB,SAAnB,EAA8BnH,KADpD;AAED,GAHD,CAhzEgC,CAqzEhC;;;AACA,OAAK9E,SAAL,CAAewF,WAAf,GAA6BA,WAA7B;AACA,OAAKxF,SAAL,CAAe2W,WAAf,GAA6BA,WAA7B;AACA,OAAK3W,SAAL,CAAeyR,KAAf,GAAuBA,KAAvB;AACA,OAAK8G,aAAL,GAAqBA,aAArB,CAzzEgC,CA2zEhC;;AAEA,SAAO,IAAP;AACD,C,CAAC","sourcesContent":["/* istanbul ignore file */\n/* -*- coding: utf-8-dos -*-\n   Outline Mode Manager\n*/\n\nimport * as UI from 'solid-ui'\nimport * as panes from 'pane-registry'\nimport * as $rdf from 'rdflib'\nimport YAHOO from './dragDrop'\nimport outlineIcons from './outlineIcons'\nimport UserInput from './userInput'\nimport queryByExample from './queryByExample'\nimport propertyViews from './propertyViews'\n\n/* global alert XPathResult sourceWidget */\n// XPathResult?\n\n// const iconHeight = '24px'\n\nexport default function (context) {\n  const dom = context.dom\n\n  this.document = context.dom\n  this.outlineIcons = outlineIcons\n  this.labeller = this.labeller || {}\n  this.labeller.LanguagePreference = '' // for now\n  const outline = this // Kenny: do we need this?\n  const thisOutline = this\n  let selection = []\n  this.selection = selection\n  this.ancestor = UI.utils.ancestor // make available as outline.ancestor in callbacks\n  this.sparql = UI.rdf.UpdateManager\n  this.kb = UI.store\n  const kb = UI.store\n  const sf = UI.store.fetcher\n  dom.outline = this\n  this.qs = new queryByExample.QuerySource() // Track queries in queryByExample\n\n  // var selection = []  // Array of statements which have been selected\n  // this.focusTd // the <td> that is being observed\n  this.UserInput = new UserInput(this)\n  this.clipboardAddress = 'tabulator:clipboard' // Weird\n  this.UserInput.clipboardInit(this.clipboardAddress)\n  const outlineElement = this.outlineElement\n\n  this.init = function () {\n    const table = getOutlineContainer()\n    table.outline = this\n  }\n\n  /** benchmark a function **/\n  benchmark.lastkbsize = 0\n\n  function benchmark (f) {\n    const args = []\n    for (let i = arguments.length - 1; i > 0; i--) args[i - 1] = arguments[i]\n    // UI.log.debug('BENCHMARK: args=' + args.join());\n    const begin = new Date().getTime()\n    const returnValue = f.apply(f, args)\n    const end = new Date().getTime()\n    UI.log.info(\n      'BENCHMARK: kb delta: ' +\n        (kb.statements.length - benchmark.lastkbsize) +\n        ', time elapsed for ' +\n        f +\n        ' was ' +\n        (end - begin) +\n        'ms'\n    )\n    benchmark.lastkbsize = kb.statements.length\n    return returnValue\n  } // benchmark\n\n  // / ////////////////////// Representing data\n\n  //  Represent an object in summary form as a table cell\n\n  function appendRemoveIcon (node, subject, removeNode) {\n    const image = UI.utils.AJARImage(\n      outlineIcons.src.icon_remove_node,\n      'remove',\n      undefined,\n      dom\n    )\n    image.addEventListener('click', removeNodeIconMouseDownListener)\n    // image.setAttribute('align', 'right')  Causes icon to be moved down\n    image.node = removeNode\n    image.setAttribute('about', subject.toNT())\n    image.style.marginLeft = '5px'\n    image.style.marginRight = '10px'\n    // image.style.border='solid #777 1px';\n    node.appendChild(image)\n    return image\n  }\n\n  this.appendAccessIcons = function (kb, node, obj) {\n    if (obj.termType !== 'NamedNode') return\n    const uris = kb.uris(obj)\n    uris.sort()\n    let last = null\n    for (let i = 0; i < uris.length; i++) {\n      if (uris[i] === last) continue\n      last = uris[i]\n      thisOutline.appendAccessIcon(node, last)\n    }\n  }\n\n  this.appendAccessIcon = function (node, uri) {\n    if (!uri) return ''\n    const docuri = UI.rdf.uri.docpart(uri)\n    if (docuri.slice(0, 5) !== 'http:') return ''\n    const state = sf.getState(docuri)\n    let icon, alt, listener\n    switch (state) {\n      case 'unrequested':\n        icon = outlineIcons.src.icon_unrequested\n        alt = 'fetch'\n        listener = unrequestedIconMouseDownListener\n        break\n      case 'requested':\n        icon = outlineIcons.src.icon_requested\n        alt = 'fetching'\n        listener = failedIconMouseDownListener // new: can retry yello blob\n        break\n      case 'fetched':\n        icon = outlineIcons.src.icon_fetched\n        listener = fetchedIconMouseDownListener\n        alt = 'loaded'\n        break\n      case 'failed':\n        icon = outlineIcons.src.icon_failed\n        alt = 'failed'\n        listener = failedIconMouseDownListener\n        break\n      case 'unpermitted':\n        icon = outlineIcons.src.icon_failed\n        listener = failedIconMouseDownListener\n        alt = 'no perm'\n        break\n      case 'unfetchable':\n        icon = outlineIcons.src.icon_failed\n        listener = failedIconMouseDownListener\n        alt = 'cannot fetch'\n        break\n      default:\n        UI.log.error('?? state = ' + state)\n        break\n    } // switch\n    const img = UI.utils.AJARImage(\n      icon,\n      alt,\n      outlineIcons.tooltips[icon].replace(/[Tt]his resource/, docuri),\n      dom\n    )\n    img.setAttribute('uri', uri)\n    img.addEventListener('click', listener) // @@ seemed to be missing 2017-08\n    addButtonCallbacks(img, docuri)\n    node.appendChild(img)\n    return img\n  } // appendAccessIcon\n\n  // Six different Creative Commons Licenses:\n  // 1. http://creativecommons.org/licenses/by-nc-nd/3.0/\n  // 2. http://creativecommons.org/licenses/by-nc-sa/3.0/\n  // 3. http://creativecommons.org/licenses/by-nc/3.0/\n  // 4. http://creativecommons.org/licenses/by-nd/3.0/\n  // 5. http://creativecommons.org/licenses/by-sa/3.0/\n  // 6. http://creativecommons.org/licenses/by/3.0/\n\n  /** make the td for an object (grammatical object)\n   *  @param obj - an RDF term\n   *  @param view - a VIEW function (rather than a bool asImage)\n   **/\n\n  this.outlineObjectTD = function outlineObjectTD (\n    obj,\n    view,\n    deleteNode,\n    statement\n  ) {\n    const td = dom.createElement('td')\n    td.setAttribute(\n      'style',\n      'margin: 0.2em; border: none; padding: 0; vertical-align: top;'\n    )\n    td.setAttribute('notSelectable', 'false')\n    let theClass = 'obj'\n\n    // check the IPR on the data.  Ok if there is any checked license which is one the document has.\n    if (statement && statement.why) {\n      if (UI.licenceOptions && UI.licenceOptions.checkLicence()) {\n        theClass += ' licOkay' // flag as light green etc .licOkay {background-color: #dfd}\n      }\n    }\n\n    // set about and put 'expand' icon\n    if (\n      obj.termType === 'NamedNode' ||\n      obj.termType === 'BlankNode' ||\n      (obj.termType === 'Literal' &&\n        obj.value.slice &&\n        (obj.value.slice(0, 6) === 'ftp://' ||\n          obj.value.slice(0, 8) === 'https://' ||\n          obj.value.slice(0, 7) === 'http://'))\n    ) {\n      td.setAttribute('about', obj.toNT())\n      td.appendChild(\n        UI.utils.AJARImage(\n          UI.icons.originalIconBase + 'tbl-expand-trans.png',\n          'expand',\n          undefined,\n          dom\n        )\n      ).addEventListener('click', expandMouseDownListener)\n    }\n    td.setAttribute('class', theClass) // this is how you find an object\n    // @@ TAKE CSS OUT OF STYLE SHEET\n    if (kb.whether(obj, UI.ns.rdf('type'), UI.ns.link('Request'))) {\n      td.className = 'undetermined'\n    } // @@? why-timbl\n\n    if (!view) {\n      // view should be a function pointer\n      view = viewAsBoringDefault\n    }\n    td.appendChild(view(obj))\n    if (deleteNode) {\n      appendRemoveIcon(td, obj, deleteNode)\n    }\n\n    // set DOM methods\n    td.tabulatorSelect = function () {\n      setSelected(this, true)\n    }\n    td.tabulatorDeselect = function () {\n      setSelected(this, false)\n    }\n\n    // Create an inquiry icon if there is proof about this triple\n    if (statement) {\n      const oneStatementFormula = new UI.rdf.IndexedFormula()\n      oneStatementFormula.statements.push(statement) // st.asFormula()\n      // The following works because Formula.hashString works fine for\n      // one statement formula\n      const reasons = kb.each(\n        oneStatementFormula,\n        kb.sym('http://dig.csail.mit.edu/TAMI/2007/amord/tms#justification')\n      )\n      if (reasons.length) {\n        const inquirySpan = dom.createElement('span')\n        if (reasons.length > 1) {\n          inquirySpan.innerHTML = ' &times; ' + reasons.length\n        }\n        inquirySpan.setAttribute('class', 'inquiry')\n        inquirySpan.insertBefore(\n          UI.utils.AJARImage(\n            outlineIcons.src.icon_display_reasons,\n            'explain',\n            undefined,\n            dom\n          ),\n          inquirySpan.firstChild\n        )\n        td.appendChild(inquirySpan)\n      }\n    }\n    td.addEventListener('click', selectableTDClickListener)\n    return td\n  } // outlineObjectTD\n\n  this.outlinePredicateTD = function outlinePredicateTD (\n    predicate,\n    newTr,\n    inverse,\n    internal\n  ) {\n    const predicateTD = dom.createElement('TD')\n    predicateTD.setAttribute('about', predicate.toNT())\n    predicateTD.setAttribute('class', internal ? 'pred internal' : 'pred')\n\n    let lab\n    switch (predicate.termType) {\n      case 'BlankNode': // TBD\n        predicateTD.className = 'undetermined'\n        break\n      case 'NamedNode':\n        lab = UI.utils.predicateLabelForXML(predicate, inverse)\n        break\n      case 'Collection': // some choices of predicate\n        lab = UI.utils.predicateLabelForXML(predicate.elements[0], inverse)\n    }\n    lab = lab.slice(0, 1).toUpperCase() + lab.slice(1)\n    // if (kb.statementsMatching(predicate,rdf('type'), UI.ns.link('Request')).length) predicateTD.className='undetermined';\n\n    const labelTD = dom.createElement('TD')\n    labelTD.setAttribute(\n      'style',\n      'margin: 0.2em; border: none; padding: 0; vertical-align: top;'\n    )\n    labelTD.setAttribute('notSelectable', 'true')\n    labelTD.appendChild(dom.createTextNode(lab))\n    predicateTD.appendChild(labelTD)\n    labelTD.style.width = '100%'\n    predicateTD.appendChild(termWidget.construct(dom)) // termWidget is global???\n    for (const w in outlineIcons.termWidgets) {\n      if (!newTr || !newTr.AJAR_statement) break // case for TBD as predicate\n      // alert(Icon.termWidgets[w]+'   '+Icon.termWidgets[w].filter)\n      if (\n        outlineIcons.termWidgets[w].filter &&\n        outlineIcons.termWidgets[w].filter(\n          newTr.AJAR_statement,\n          'pred',\n          inverse\n        )\n      ) {\n        termWidget.addIcon(predicateTD, outlineIcons.termWidgets[w])\n      }\n    }\n\n    try {\n      // new YAHOO.util.DDExternalProxy(predicateTD)\n    } catch (e) {\n      UI.log.error('drag and drop not supported')\n    }\n    // set DOM methods\n    predicateTD.tabulatorSelect = function () {\n      setSelected(this, true)\n    }\n    predicateTD.tabulatorDeselect = function () {\n      setSelected(this, false)\n    }\n    predicateTD.addEventListener('click', selectableTDClickListener)\n    return predicateTD\n  } // outlinePredicateTD\n\n  /**\n   * Render Tabbed set of home app panes\n   *\n   * @param {Object} [options] A set of options you can provide\n   * @param {string} [options.selectedTab] To open a specific dashboard pane\n   * @param {Function} [options.onClose] If given, will present an X for the dashboard, and call this method when clicked\n   * @returns Promise<{Element}> - the div that holds the dashboard\n   */\n  async function globalAppTabs (options = {}) {\n    console.log('globalAppTabs @@')\n    const div = dom.createElement('div')\n    const me = UI.authn.currentUser()\n    if (!me) {\n      alert('Must be logged in for this')\n      throw new Error('Not logged in')\n    }\n    const items = await getDashboardItems()\n\n    function renderTab (div, item) {\n      div.dataset.globalPaneName = item.tabName || item.paneName\n      div.textContent = item.label\n    }\n\n    function renderMain (containerDiv, item) {\n      // Items are pane names\n      const pane = panes.byName(item.paneName) // 20190701\n      containerDiv.innerHTML = ''\n      const table = containerDiv.appendChild(dom.createElement('table'))\n      const me = UI.authn.currentUser()\n      thisOutline.GotoSubject(\n        item.subject || me,\n        true,\n        pane,\n        false,\n        undefined,\n        table\n      )\n    }\n\n    div.appendChild(\n      UI.tabs.tabWidget({\n        dom,\n        subject: me,\n        items,\n        renderMain,\n        renderTab,\n        ordered: true,\n        orientation: 0,\n        backgroundColor: '#eeeeee', // black?\n        selectedTab: options.selectedTab,\n        onClose: options.onClose\n      })\n    )\n    return div\n  }\n  this.getDashboard = globalAppTabs\n\n  async function getDashboardItems () {\n    const me = UI.authn.currentUser()\n    const div = dom.createElement('div')\n    const [books, pods] = await Promise.all([getAddressBooks(), getPods()])\n    return [\n      {\n        paneName: 'home',\n        label: 'Your stuff',\n        icon: UI.icons.iconBase + 'noun_547570.svg'\n      },\n      {\n        paneName: 'basicPreferences',\n        label: 'Preferences',\n        icon: UI.icons.iconBase + 'noun_Sliders_341315_00000.svg'\n      },\n      {\n        paneName: 'editProfile',\n        label: 'Edit your profile',\n        icon: UI.icons.iconBase + 'noun_492246.svg'\n      }\n    ]\n      .concat(books)\n      .concat(pods)\n\n    async function getPods () {\n      try {\n        // need to make sure that profile is loaded\n        await kb.fetcher.load(me.doc())\n      } catch (err) {\n        console.error('Unable to load profile', err)\n        return []\n      }\n      const pods = kb.each(me, ns.space('storage'), null, me.doc())\n      return pods.map((pod, index) => {\n        const label =\n          pods.length > 1 ? pod.uri.split('//')[1].slice(0, -1) : 'Your storage'\n        return {\n          paneName: 'folder',\n          tabName: `folder-${index}`,\n          label,\n          subject: pod,\n          icon: UI.icons.iconBase + 'noun_Cabinet_251723.svg'\n        }\n      })\n    }\n\n    async function getAddressBooks () {\n      try {\n        const context = await UI.authn.findAppInstances(\n          { me, div, dom },\n          ns.vcard('AddressBook')\n        )\n        return (context.instances || []).map((book, index) => ({\n          paneName: 'contact',\n          tabName: `contact-${index}`,\n          label: 'Contacts',\n          subject: book,\n          icon: UI.icons.iconBase + 'noun_15695.svg'\n        }))\n      } catch (err) {\n        console.error('oops in globalAppTabs AddressBook')\n      }\n      return []\n    }\n  }\n  this.getDashboardItems = getDashboardItems\n\n  /**\n   * Call this method to show the global dashboard.\n   *\n   * @param {Object} [options] A set of options that can be passed\n   * @param {string} [options.pane] To open a specific dashboard pane\n   * @returns {Promise<void>}\n   */\n  async function showDashboard (options = {}) {\n    const dashboardContainer = getDashboardContainer()\n    const outlineContainer = getOutlineContainer()\n    // reuse dashboard if already children already is inserted\n    if (dashboardContainer.childNodes.length > 0 && options.pane) {\n      outlineContainer.style.display = 'none'\n      dashboardContainer.style.display = 'inherit'\n      const tab = dashboardContainer.querySelector(\n        `[data-global-pane-name=\"${options.pane}\"]`\n      )\n      if (tab) {\n        tab.click()\n        return\n      }\n      console.warn(\n        'Did not find the referred tab in global dashboard, will open first one'\n      )\n    }\n\n    // create a new dashboard if not already present\n    const dashboard = await globalAppTabs({\n      selectedTab: options.pane,\n      onClose: closeDashboard\n    })\n\n    // close the dashboard if user log out\n    UI.authn.solidAuthClient.trackSession(closeDashboardIfLoggedOut)\n\n    // finally - switch to showing dashboard\n    outlineContainer.style.display = 'none'\n    dashboardContainer.appendChild(dashboard)\n\n    function closeDashboard () {\n      dashboardContainer.style.display = 'none'\n      outlineContainer.style.display = 'inherit'\n    }\n\n    function closeDashboardIfLoggedOut (session) {\n      if (session) {\n        return\n      }\n      closeDashboard()\n    }\n  }\n  this.showDashboard = showDashboard\n\n  function getDashboardContainer () {\n    return getOrCreateContainer('GlobalDashboard')\n  }\n\n  function getOutlineContainer () {\n    return getOrCreateContainer('outline')\n  }\n\n  /**\n   * Get element with id or create a new on the fly with that id\n   *\n   * @param {string} id The ID of the element you want to get or create\n   * @returns {HTMLElement}\n   */\n  function getOrCreateContainer (id) {\n    return (\n      document.getElementById(id) ||\n      (() => {\n        const dashboardContainer = document.createElement('div')\n        dashboardContainer.id = id\n        const mainContainer =\n          document.querySelector('[role=\"main\"]') || document.body\n        return mainContainer.appendChild(dashboardContainer)\n      })()\n    )\n  }\n\n  async function getRelevantPanes (subject, context) {\n    const panes = context.session.paneRegistry\n    const relevantPanes = panes.list.filter(\n      pane => pane.label(subject, context) && !pane.global\n    )\n    if (relevantPanes.length === 0) {\n      // there are no relevant panes, simply return default pane (which ironically is internalPane)\n      return [panes.byName('internal')]\n    }\n    const filteredPanes = await UI.authn.filterAvailablePanes(relevantPanes)\n    if (filteredPanes.length === 0) {\n      // if no relevant panes are available panes because of user role, we still allow for the most relevant pane to be viewed\n      return [relevantPanes[0]]\n    }\n    const firstRelevantPaneIndex = panes.list.indexOf(relevantPanes[0])\n    const firstFilteredPaneIndex = panes.list.indexOf(filteredPanes[0])\n    // if the first relevant pane is loaded before the panes available wrt role, we still want to offer the most relevant pane\n    return firstRelevantPaneIndex < firstFilteredPaneIndex\n      ? [relevantPanes[0]].concat(filteredPanes)\n      : filteredPanes\n  }\n\n  function getPane (relevantPanes, subject) {\n    return (\n      relevantPanes.find(\n        pane => pane.shouldGetFocus && pane.shouldGetFocus(subject)\n      ) || relevantPanes[0]\n    )\n  }\n\n  async function expandedHeaderTR (subject, requiredPane, options) {\n    async function renderPaneIconTray (td, options = {}) {\n      const paneShownStyle =\n        'width: 24px; border-radius: 0.5em; border-top: solid #222 1px; border-left: solid #222 0.1em; border-bottom: solid #eee 0.1em; border-right: solid #eee 0.1em; margin-left: 1em; padding: 3px; background-color:   #ffd;'\n      const paneHiddenStyle =\n        'width: 24px; border-radius: 0.5em; margin-left: 1em; padding: 3px'\n      const paneIconTray = td.appendChild(dom.createElement('nav'))\n      paneIconTray.style =\n        'display:flex; justify-content: flex-start; align-items: center;'\n\n      const relevantPanes = options.hideList\n        ? []\n        : await getRelevantPanes(subject, context)\n      tr.firstPane = requiredPane || getPane(relevantPanes, subject)\n      const paneNumber = relevantPanes.indexOf(tr.firstPane)\n\n      if (relevantPanes.length !== 1) {\n        // if only one, simplify interface\n        relevantPanes.forEach((pane, index) => {\n          const label = pane.label(subject, context)\n          const ico = UI.utils.AJARImage(pane.icon, label, label, dom)\n          ico.style = pane === tr.firstPane ? paneShownStyle : paneHiddenStyle // init to something at least\n          // ico.setAttribute('align','right');   @@ Should be better, but ffox bug pushes them down\n          // ico.style.width = iconHeight\n          // ico.style.height = iconHeight\n          const listen = function (ico, pane) {\n            // Freeze scope for event time\n            ico.addEventListener(\n              'click',\n              function (event) {\n                let containingTable\n                // Find the containing table for this subject\n                for (containingTable = td; containingTable.parentNode; containingTable = containingTable.parentNode) {\n                  if (containingTable.nodeName === 'TABLE') break\n                }\n                if (containingTable.nodeName !== 'TABLE') {\n                  throw new Error('outline: internal error.')\n                }\n                const removePanes = function (specific) {\n                  for (let d = containingTable.firstChild; d; d = d.nextSibling) {\n                    if (typeof d.pane !== 'undefined') {\n                      if (!specific || d.pane === specific) {\n                        if (d.paneButton) {\n                          d.paneButton.setAttribute('class', 'paneHidden')\n                          d.paneButton.style = paneHiddenStyle\n                        }\n                        removeAndRefresh(d)\n                        // If we just delete the node d, ffox doesn't refresh the display properly.\n                        // state = 'paneHidden';\n                        if (\n                          d.pane.requireQueryButton &&\n                          containingTable.parentNode.className /* outer table */ &&\n                          numberOfPanesRequiringQueryButton === 1 &&\n                          dom.getElementById('queryButton')\n                        ) {\n                          dom\n                            .getElementById('queryButton')\n                            .setAttribute('style', 'display:none;')\n                        }\n                      }\n                    }\n                  }\n                }\n                const renderPane = function (pane) {\n                  let paneDiv\n                  UI.log.info('outline: Rendering pane (2): ' + pane.name)\n                  if (UI.no_catch_pane_errors) {\n                    // for debugging\n                    paneDiv = pane.render(subject, context, options)\n                  } else {\n                    try {\n                      paneDiv = pane.render(subject, context, options)\n                    } catch (e) {\n                      // Easier debugging for pane developers\n                      paneDiv = dom.createElement('div')\n                      paneDiv.setAttribute('class', 'exceptionPane')\n                      const pre = dom.createElement('pre')\n                      paneDiv.appendChild(pre)\n                      pre.appendChild(\n                        dom.createTextNode(UI.utils.stackString(e))\n                      )\n                    }\n                  }\n                  if (\n                    pane.requireQueryButton &&\n                    dom.getElementById('queryButton')\n                  ) {\n                    dom.getElementById('queryButton').removeAttribute('style')\n                  }\n                  const second = containingTable.firstChild.nextSibling\n                  const row = dom.createElement('tr')\n                  const cell = row.appendChild(dom.createElement('td'))\n                  cell.appendChild(paneDiv)\n                  if (second) containingTable.insertBefore(row, second)\n                  else containingTable.appendChild(row)\n                  row.pane = pane\n                  row.paneButton = ico\n                }\n                const state = ico.getAttribute('class')\n                if (state === 'paneHidden') {\n                  if (!event.shiftKey) {\n                    // shift means multiple select\n                    removePanes()\n                  }\n                  renderPane(pane)\n                  ico.setAttribute('class', 'paneShown')\n                  ico.style = paneShownStyle\n                } else {\n                  removePanes(pane)\n                  ico.setAttribute('class', 'paneHidden')\n                  ico.style = paneHiddenStyle\n                }\n\n                let numberOfPanesRequiringQueryButton = 0\n                for (let d = containingTable.firstChild; d; d = d.nextSibling) {\n                  if (d.pane && d.pane.requireQueryButton) {\n                    numberOfPanesRequiringQueryButton++\n                  }\n                }\n              },\n              false\n            )\n          } // listen\n\n          listen(ico, pane)\n          ico.setAttribute(\n            'class',\n            index !== paneNumber ? 'paneHidden' : 'paneShown'\n          )\n          if (index === paneNumber) tr.paneButton = ico\n          paneIconTray.appendChild(ico)\n        })\n      }\n      return paneIconTray\n    } // renderPaneIconTray\n\n    // Body of expandedHeaderTR\n    const tr = dom.createElement('tr')\n    if (options.hover) {\n      // By default no hide till hover as community deems it confusing\n      tr.setAttribute('class', 'hoverControl')\n    }\n    const td = tr.appendChild(dom.createElement('td'))\n    td.setAttribute(\n      'style',\n      'margin: 0.2em; border: none; padding: 0; vertical-align: top;' +\n        'display:flex; justify-content: space-between; flex-direction: row;'\n    )\n    td.setAttribute('notSelectable', 'true')\n    td.setAttribute('about', subject.toNT())\n    td.setAttribute('colspan', '2')\n\n    // Stuff at the right about the subject\n    const header = td.appendChild(dom.createElement('div'))\n    header.style =\n      'display:flex; justify-content: flex-start; align-items: center; flex-wrap: wrap;'\n\n    const showHeader = !!requiredPane\n\n    if (!options.solo && !showHeader) {\n      const icon = header.appendChild(\n        UI.utils.AJARImage(\n          UI.icons.originalIconBase + 'tbl-collapse.png',\n          'collapse',\n          undefined,\n          dom\n        )\n      )\n      icon.addEventListener('click', collapseMouseDownListener)\n\n      const strong = header.appendChild(dom.createElement('h1'))\n      strong.appendChild(dom.createTextNode(UI.utils.label(subject)))\n      strong.style =\n        'font-size: 150%; margin: 0 0.6em 0 0; padding: 0.1em 0.4em;'\n      UI.widgets.makeDraggable(strong, subject)\n    }\n\n    header.appendChild(\n      await renderPaneIconTray(td, {\n        hideList: showHeader\n      })\n    )\n\n    // set DOM methods\n    tr.firstChild.tabulatorSelect = function () {\n      setSelected(this, true)\n    }\n    tr.firstChild.tabulatorDeselect = function () {\n      setSelected(this, false)\n    }\n    return tr\n  } // expandedHeaderTR\n\n  // / //////////////////////////////////////////////////////////////////////////\n\n  /*  PANES\n   **\n   **     Panes are regions of the outline view in which a particular subject is\n   ** displayed in a particular way.  They are like views but views are for query results.\n   ** subject panes are currently stacked vertically.\n   */\n\n  // / ////////////////////  Specific panes are in panes/*.js\n  //\n  // The defaultPane is the first one registered for which the label method exists\n  // Those registered first take priority as a default pane.\n  // That is, those earlier in this file\n\n  /**\n   * Pane registration\n   */\n\n  // the second argument indicates whether the query button is required\n\n  // / ///////////////////////////////////////////////////////////////////////////\n\n  // Remove a node from the DOM so that Firefox refreshes the screen OK\n  // Just deleting it cause whitespace to accumulate.\n  function removeAndRefresh (d) {\n    const table = d.parentNode\n    const par = table.parentNode\n    const placeholder = dom.createElement('table')\n    placeholder.setAttribute('style', 'width: 100%;')\n    par.replaceChild(placeholder, table)\n    table.removeChild(d)\n    par.replaceChild(table, placeholder) // Attempt to\n  }\n\n  const propertyTable = (this.propertyTable = function propertyTable (\n    subject,\n    table,\n    pane,\n    options\n  ) {\n    UI.log.debug('Property table for: ' + subject)\n    subject = kb.canon(subject)\n    // if (!pane) pane = panes.defaultPane;\n\n    if (!table) {\n      // Create a new property table\n      table = dom.createElement('table')\n      table.setAttribute('style', 'width: 100%;')\n      expandedHeaderTR(subject, pane, options).then(tr1 => {\n        table.appendChild(tr1)\n\n        if (tr1.firstPane) {\n          let paneDiv\n          try {\n            UI.log.info('outline: Rendering pane (1): ' + tr1.firstPane.name)\n            paneDiv = tr1.firstPane.render(subject, context, options)\n          } catch (e) {\n            // Easier debugging for pane developers\n            paneDiv = dom.createElement('div')\n            paneDiv.setAttribute('class', 'exceptionPane')\n            const pre = dom.createElement('pre')\n            paneDiv.appendChild(pre)\n            pre.appendChild(dom.createTextNode(UI.utils.stackString(e)))\n          }\n\n          const row = dom.createElement('tr')\n          const cell = row.appendChild(dom.createElement('td'))\n          cell.appendChild(paneDiv)\n          if (\n            tr1.firstPane.requireQueryButton &&\n            dom.getElementById('queryButton')\n          ) {\n            dom.getElementById('queryButton').removeAttribute('style')\n          }\n          table.appendChild(row)\n          row.pane = tr1.firstPane\n          row.paneButton = tr1.paneButton\n        }\n      })\n\n      return table\n    } else {\n      // New display of existing table, keeping expanded bits\n      UI.log.info('Re-expand: ' + table)\n      // do some other stuff here\n      return table\n    }\n  }) /* propertyTable */\n\n  function propertyTR (doc, st, inverse) {\n    const tr = doc.createElement('TR')\n    tr.AJAR_statement = st\n    tr.AJAR_inverse = inverse\n    // tr.AJAR_variable = null; // @@ ??  was just 'tr.AJAR_variable'\n    tr.setAttribute('predTR', 'true')\n    const predicateTD = thisOutline.outlinePredicateTD(st.predicate, tr, inverse)\n    tr.appendChild(predicateTD) // @@ add 'internal' to predicateTD's class for style? mno\n    return tr\n  }\n  this.propertyTR = propertyTR\n\n  // / ////////// Property list\n  function appendPropertyTRs (parent, plist, inverse, predicateFilter) {\n    // UI.log.info('@appendPropertyTRs, 'this' is %s, dom is %s, '+ // Gives 'can't access dead object'\n    //                   'thisOutline.document is %s', this, dom.location, thisOutline.document.location);\n    // UI.log.info('@appendPropertyTRs, dom is now ' + this.document.location);\n    // UI.log.info('@appendPropertyTRs, dom is now ' + thisOutline.document.location);\n    UI.log.debug('Property list length = ' + plist.length)\n    if (plist.length === 0) return ''\n    let sel, j, k\n    if (inverse) {\n      sel = function (x) {\n        return x.subject\n      }\n      plist = plist.sort(UI.utils.RDFComparePredicateSubject)\n    } else {\n      sel = function (x) {\n        return x.object\n      }\n      plist = plist.sort(UI.utils.RDFComparePredicateObject)\n    }\n\n    const max = plist.length\n    for (j = 0; j < max; j++) {\n      // squishing together equivalent properties I think\n      let s = plist[j]\n      //      if (s.object == parentSubject) continue; // that we knew\n\n      // Avoid predicates from other panes\n      if (predicateFilter && !predicateFilter(s.predicate, inverse)) continue\n\n      const tr = propertyTR(dom, s, inverse)\n      parent.appendChild(tr)\n      const predicateTD = tr.firstChild // we need to kludge the rowspan later\n\n      let defaultpropview = views.defaults[s.predicate.uri]\n\n      //   LANGUAGE PREFERENCES WAS AVAILABLE WITH FF EXTENSION - get from elsewhere?\n\n      let dups = 0 // How many rows have the same predicate, -1?\n      let langTagged = 0 // how many objects have language tags?\n      let myLang = 0 // Is there one I like?\n\n      for (\n        k = 0;\n        k + j < max && plist[j + k].predicate.sameTerm(s.predicate);\n        k++\n      ) {\n        if (k > 0 && sel(plist[j + k]).sameTerm(sel(plist[j + k - 1]))) dups++\n        if (sel(plist[j + k]).lang && outline.labeller.LanguagePreference) {\n          langTagged += 1\n          if (\n            sel(plist[j + k]).lang.indexOf(\n              outline.labeller.LanguagePreference\n            ) >= 0\n          ) {\n            myLang++\n          }\n        }\n      }\n\n      /* Display only the one in the preferred language\n          ONLY in the case (currently) when all the values are tagged.\n          Then we treat them as alternatives. */\n\n      if (myLang > 0 && langTagged === dups + 1) {\n        for (let k = j; k <= j + dups; k++) {\n          if (\n            outline.labeller.LanguagePreference &&\n            sel(plist[k]).lang.indexOf(outline.labeller.LanguagePreference) >= 0\n          ) {\n            tr.appendChild(\n              thisOutline.outlineObjectTD(\n                sel(plist[k]),\n                defaultpropview,\n                undefined,\n                s\n              )\n            )\n            break\n          }\n        }\n        j += dups // extra push\n        continue\n      }\n\n      tr.appendChild(\n        thisOutline.outlineObjectTD(sel(s), defaultpropview, undefined, s)\n      )\n\n      /* Note: showNobj shows between n to 2n objects.\n       * This is to prevent the case where you have a long list of objects\n       * shown, and dangling at the end is '1 more' (which is easily ignored)\n       * Therefore more objects are shown than hidden.\n       */\n\n      tr.showNobj = function (n) {\n        const predDups = k - dups\n        const show = 2 * n < predDups ? n : predDups\n        const showLaterArray = []\n        if (predDups !== 1) {\n          predicateTD.setAttribute(\n            'rowspan',\n            show === predDups ? predDups : n + 1\n          )\n          let l\n          if (show < predDups && show === 1) {\n            // what case is this...\n            predicateTD.setAttribute('rowspan', 2)\n          }\n          let displayed = 0 // The number of cells generated-1,\n          // all duplicate thing removed\n          for (l = 1; l < k; l++) {\n            // This detects the same things\n            if (\n              !kb\n                .canon(sel(plist[j + l]))\n                .sameTerm(kb.canon(sel(plist[j + l - 1])))\n            ) {\n              displayed++\n              s = plist[j + l]\n              defaultpropview = views.defaults[s.predicate.uri]\n              const trObj = dom.createElement('tr')\n              trObj.style.colspan = '1'\n              trObj.appendChild(\n                thisOutline.outlineObjectTD(\n                  sel(plist[j + l]),\n                  defaultpropview,\n                  undefined,\n                  s\n                )\n              )\n              trObj.AJAR_statement = s\n              trObj.AJAR_inverse = inverse\n              parent.appendChild(trObj)\n              if (displayed >= show) {\n                trObj.style.display = 'none'\n                showLaterArray.push(trObj)\n              }\n            } else {\n              // ToDo: show all the data sources of this statement\n              UI.log.info('there are duplicates here: %s', plist[j + l - 1])\n            }\n          }\n          // @@a quick fix on the messing problem.\n          if (show === predDups) {\n            predicateTD.setAttribute('rowspan', displayed + 1)\n          }\n        } // end of if (predDups!==1)\n\n        if (show < predDups) {\n          // Add the x more <TR> here\n          const moreTR = dom.createElement('tr')\n          const moreTD = moreTR.appendChild(dom.createElement('td'))\n          moreTD.setAttribute(\n            'style',\n            'margin: 0.2em; border: none; padding: 0; vertical-align: top;'\n          )\n          moreTD.setAttribute('notSelectable', 'false')\n          if (predDups > n) {\n            // what is this for??\n            const small = dom.createElement('a')\n            moreTD.appendChild(small)\n\n            const predToggle = (function (f) {\n              return f(predicateTD, k, dups, n)\n            })(function (predicateTD, k, dups, n) {\n              return function (display) {\n                small.innerHTML = ''\n                if (display === 'none') {\n                  small.appendChild(\n                    UI.utils.AJARImage(\n                      UI.icons.originalIconBase + 'tbl-more-trans.png',\n                      'more',\n                      'See all',\n                      dom\n                    )\n                  )\n                  small.appendChild(\n                    dom.createTextNode(predDups - n + ' more...')\n                  )\n                  predicateTD.setAttribute('rowspan', n + 1)\n                } else {\n                  small.appendChild(\n                    UI.utils.AJARImage(\n                      UI.icons.originalIconBase + 'tbl-shrink.png',\n                      '(less)',\n                      undefined,\n                      dom\n                    )\n                  )\n                  predicateTD.setAttribute('rowspan', predDups + 1)\n                }\n                for (let i = 0; i < showLaterArray.length; i++) {\n                  const trObj = showLaterArray[i]\n                  trObj.style.display = display\n                }\n              }\n            }) // ???\n            let current = 'none'\n            const toggleObj = function (event) {\n              predToggle(current)\n              current = current === 'none' ? '' : 'none'\n              if (event) event.stopPropagation()\n              return false // what is this for?\n            }\n            toggleObj()\n            small.addEventListener('click', toggleObj, false)\n          } // if(predDups>n)\n          parent.appendChild(moreTR)\n        } // if\n      } // tr.showNobj\n\n      tr.showAllobj = function () {\n        tr.showNobj(k - dups)\n      }\n\n      tr.showNobj(10)\n\n      j += k - 1 // extra push\n    }\n  } //  appendPropertyTRs\n\n  this.appendPropertyTRs = appendPropertyTRs\n\n  /*   termWidget\n   **\n   */\n  const termWidget = {} // @@@@@@ global\n  global.termWidget = termWidget\n  termWidget.construct = function (dom) {\n    dom = dom || document\n    const td = dom.createElement('TD')\n    td.setAttribute(\n      'style',\n      'margin: 0.2em; border: none; padding: 0; vertical-align: top;'\n    )\n    td.setAttribute('class', 'iconTD')\n    td.setAttribute('notSelectable', 'true')\n    td.style.width = '0px'\n    return td\n  }\n  termWidget.addIcon = function (td, icon, listener) {\n    const iconTD = td.childNodes[1]\n    if (!iconTD) return\n    let width = iconTD.style.width\n    const img = UI.utils.AJARImage(icon.src, icon.alt, icon.tooltip, dom)\n    width = parseInt(width)\n    width = width + icon.width\n    iconTD.style.width = width + 'px'\n    iconTD.appendChild(img)\n    if (listener) {\n      img.addEventListener('click', listener)\n    }\n  }\n  termWidget.removeIcon = function (td, icon) {\n    const iconTD = td.childNodes[1]\n    let baseURI\n    if (!iconTD) return\n    let width = iconTD.style.width\n    width = parseInt(width)\n    width = width - icon.width\n    iconTD.style.width = width + 'px'\n    for (let x = 0; x < iconTD.childNodes.length; x++) {\n      const elt = iconTD.childNodes[x]\n      const eltSrc = elt.src\n\n      // ignore first '?' and everything after it //Kenny doesn't know what this is for\n      try {\n        baseURI = dom.location.href.split('?')[0]\n      } catch (e) {\n        console.log(e)\n        baseURI = ''\n      }\n      const relativeIconSrc = UI.rdf.uri.join(icon.src, baseURI)\n      if (eltSrc === relativeIconSrc) {\n        iconTD.removeChild(elt)\n      }\n    }\n  }\n  termWidget.replaceIcon = function (td, oldIcon, newIcon, listener) {\n    termWidget.removeIcon(td, oldIcon)\n    termWidget.addIcon(td, newIcon, listener)\n  }\n\n  // / /////////////////////////////////////////////////// VALUE BROWSER VIEW\n\n  // / /////////////////////////////////////////////////////// TABLE VIEW\n\n  //  Summarize a thing as a table cell\n\n  /**********************\n\n    query global vars\n\n  ***********************/\n\n  // const doesn't work in Opera\n  // const BLANK_QUERY = { pat: kb.formula(), vars: [], orderBy: [] };\n  // @ pat: the query pattern in an RDFIndexedFormula. Statements are in pat.statements\n  // @ vars: the free variables in the query\n  // @ orderBy: the variables to order the table\n\n  function QueryObj () {\n    this.pat = kb.formula()\n    this.vars = []\n    // this.orderBy = []\n  }\n\n  const queries = []\n  queries[0] = new QueryObj()\n  /*\n  function querySave () {\n    queries.push(queries[0])\n    var choices = dom.getElementById('queryChoices')\n    var next = dom.createElement('option')\n    var box = dom.createElement('input')\n    var index = queries.length - 1\n    box.setAttribute('type', 'checkBox')\n    box.setAttribute('value', index)\n    choices.appendChild(box)\n    choices.appendChild(dom.createTextNode('Saved query #' + index))\n    choices.appendChild(dom.createElement('br'))\n    next.setAttribute('value', index)\n    next.appendChild(dom.createTextNode('Saved query #' + index))\n    dom.getElementById('queryJump').appendChild(next)\n  }\n*/\n  /*\n  function resetQuery () {\n    function resetOutliner (pat) {\n      var n = pat.statements.length\n      var pattern, tr\n      for (let i = 0; i < n; i++) {\n        pattern = pat.statements[i]\n        tr = pattern.tr\n        // UI.log.debug('tr: ' + tr.AJAR_statement);\n        if (typeof tr !== 'undefined') {\n          delete tr.AJAR_pattern\n          delete tr.AJAR_variable\n        }\n      }\n      for (let x in pat.optional) { resetOutliner(pat.optional[x]) }\n    }\n    resetOutliner(myQuery.pat)\n    UI.utils.clearVariableNames()\n    queries[0] = myQuery = new QueryObj()\n  }\n*/\n  function addButtonCallbacks (target, fireOn) {\n    UI.log.debug('Button callbacks for ' + fireOn + ' added')\n    const makeIconCallback = function (icon) {\n      return function IconCallback (req) {\n        if (req.indexOf('#') >= 0) {\n          console.log(\n            '@@ makeIconCallback: Not expecting # in URI whose state changed: ' +\n              req\n          )\n          // alert('Should have no hash in '+req)\n        }\n        if (!target) {\n          return false\n        }\n        if (!outline.ancestor(target, 'DIV')) return false\n        // if (term.termType != 'symbol') { return true } // should always ve\n        if (req === fireOn) {\n          target.src = icon\n          target.title = outlineIcons.tooltips[icon]\n        }\n        return true\n      }\n    }\n    sf.addCallback('request', makeIconCallback(outlineIcons.src.icon_requested))\n    sf.addCallback('done', makeIconCallback(outlineIcons.src.icon_fetched))\n    sf.addCallback('fail', makeIconCallback(outlineIcons.src.icon_failed))\n  }\n\n  //   Selection support\n\n  function selected (node) {\n    const a = node.getAttribute('class')\n    if (a && a.indexOf('selected') >= 0) return true\n    return false\n  }\n\n  // These woulkd be simpler using closer variables below\n  function optOnIconMouseDownListener (e) {\n    // outlineIcons.src.icon_opton  needed?\n    const target = thisOutline.targetOf(e)\n    const p = target.parentNode\n    termWidget.replaceIcon(\n      p.parentNode,\n      outlineIcons.termWidgets.optOn,\n      outlineIcons.termWidgets.optOff,\n      optOffIconMouseDownListener\n    )\n    p.parentNode.parentNode.removeAttribute('optional')\n  }\n\n  function optOffIconMouseDownListener (e) {\n    // outlineIcons.src.icon_optoff needed?\n    const target = thisOutline.targetOf(e)\n    const p = target.parentNode\n    termWidget.replaceIcon(\n      p.parentNode,\n      outlineIcons.termWidgets.optOff,\n      outlineIcons.termWidgets.optOn,\n      optOnIconMouseDownListener\n    )\n    p.parentNode.parentNode.setAttribute('optional', 'true')\n  }\n\n  function setSelectedParent (node, inc) {\n    const onIcon = outlineIcons.termWidgets.optOn\n    const offIcon = outlineIcons.termWidgets.optOff\n    for (let n = node; n.parentNode; n = n.parentNode) {\n      while (true) {\n        if (n.getAttribute('predTR')) {\n          let num = n.getAttribute('parentOfSelected')\n          if (!num) num = 0\n          else num = parseInt(num)\n          if (num === 0 && inc > 0) {\n            termWidget.addIcon(\n              n.childNodes[0],\n              n.getAttribute('optional') ? onIcon : offIcon,\n              n.getAttribute('optional')\n                ? optOnIconMouseDownListener\n                : optOffIconMouseDownListener\n            )\n          }\n          num = num + inc\n          n.setAttribute('parentOfSelected', num)\n          if (num === 0) {\n            n.removeAttribute('parentOfSelected')\n            termWidget.removeIcon(\n              n.childNodes[0],\n              n.getAttribute('optional') ? onIcon : offIcon\n            )\n          }\n          break\n        } else if (n.previousSibling && n.previousSibling.nodeName === 'TR') {\n          n = n.previousSibling\n        } else break\n      }\n    }\n  }\n\n  this.statusBarClick = function (event) {\n    const target = UI.utils.getTarget(event)\n    if (target.label) {\n      window.content.location = target.label\n      // The following alternative does not work in the extension.\n      // var s = UI.store.sym(target.label);\n      // outline.GotoSubject(s, true);\n    }\n  }\n\n  this.showURI = function showURI (about) {\n    if (about && dom.getElementById('UserURI')) {\n      dom.getElementById('UserURI').value =\n        about.termType === 'NamedNode' ? about.uri : '' // blank if no URI\n    }\n  }\n\n  this.showSource = function showSource () {\n    if (typeof sourceWidget === 'undefined') return\n    // deselect all before going on, this is necessary because you would switch tab,\n    // close tab or so on...\n    for (const uri in sourceWidget.sources) {\n      sourceWidget.sources[uri].setAttribute('class', '')\n    } // .class doesn't work. Be careful!\n    for (let i = 0; i < selection.length; i++) {\n      if (!selection[i].parentNode) {\n        console.log('showSource: EH? no parentNode? ' + selection[i] + '\\n')\n        continue\n      }\n      const st = selection[i].parentNode.AJAR_statement\n      if (!st) continue // for root TD\n      const source = st.why\n      if (source && source.uri) {\n        sourceWidget.highlight(source, true)\n      }\n    }\n  }\n\n  this.getSelection = function getSelection () {\n    return selection\n  }\n\n  function setSelected (node, newValue) {\n    // UI.log.info('selection has ' +selection.map(function(item){return item.textContent;}).join(', '));\n    // UI.log.debug('@outline setSelected, intended to '+(newValue?'select ':'deselect ')+node+node.textContent);\n    // if (newValue === selected(node)) return; //we might not need this anymore...\n    if (node.nodeName !== 'TD') {\n      UI.log.debug('down' + node.nodeName)\n      throw new Error(\n        'Expected TD in setSelected: ' +\n          node.nodeName +\n          ' : ' +\n          node.textContent\n      )\n    }\n    UI.log.debug('pass')\n    let cla = node.getAttribute('class')\n    if (!cla) cla = ''\n    if (newValue) {\n      cla += ' selected'\n      if (cla.indexOf('pred') >= 0 || cla.indexOf('obj') >= 0) {\n        setSelectedParent(node, 1)\n      }\n      selection.push(node)\n      // UI.log.info('Selecting '+node.textContent)\n\n      const about = UI.utils.getTerm(node) // show uri for a newly selectedTd\n      thisOutline.showURI(about)\n\n      let st = node.AJAR_statement // show blue cross when the why of that triple is editable\n      if (typeof st === 'undefined') st = node.parentNode.AJAR_statement\n      // if (typeof st === 'undefined') return; // @@ Kludge?  Click in the middle of nowhere\n      if (st) {\n        // don't do these for headers or base nodes\n        const source = st.why\n        // var target = st.why\n        const editable = UI.store.updater.editable(source.uri, kb)\n        if (!editable) {\n          // let target = node.parentNode.AJAR_inverse ? st.object : st.subject\n        } // left hand side\n        // think about this later. Because we update to the why for now.\n        // alert('Target='+target+', editable='+editable+'\\nselected statement:' + st)\n        if (editable && cla.indexOf('pred') >= 0) {\n          termWidget.addIcon(node, outlineIcons.termWidgets.addTri)\n        } // Add blue plus\n      }\n    } else {\n      UI.log.debug('cla=$' + cla + '$')\n      if (cla === 'selected') cla = '' // for header <TD>\n      cla = cla.replace(' selected', '')\n      if (cla.indexOf('pred') >= 0 || cla.indexOf('obj') >= 0) {\n        setSelectedParent(node, -1)\n      }\n      if (cla.indexOf('pred') >= 0) {\n        termWidget.removeIcon(node, outlineIcons.termWidgets.addTri)\n      }\n\n      selection = selection.filter(function (x) {\n        return x === node\n      })\n\n      UI.log.info('Deselecting ' + node.textContent)\n    }\n    if (typeof sourceWidget !== 'undefined') thisOutline.showSource() // Update the data sources display\n    // UI.log.info('selection becomes [' +selection.map(function(item){return item.textContent;}).join(', ')+']');\n    // UI.log.info('Setting className ' + cla);\n    node.setAttribute('class', cla)\n  }\n\n  function deselectAll () {\n    const n = selection.length\n    for (let i = n - 1; i >= 0; i--) setSelected(selection[i], false)\n    selection = []\n  }\n\n  /** Get the target of an event **/\n  this.targetOf = function (e) {\n    let target\n    if (!e) e = window.event\n    if (e.target) {\n      target = e.target\n    } else if (e.srcElement) {\n      target = e.srcElement\n    } else {\n      UI.log.error(\"can't get target for event \" + e)\n      return false\n    } // fail\n    if (target.nodeType === 3) {\n      // defeat Safari bug [sic]\n      target = target.parentNode\n    }\n    return target\n  } // targetOf\n\n  this.walk = function walk (directionCode, inputTd) {\n    const selectedTd = inputTd || selection[0]\n    let newSelTd\n    switch (directionCode) {\n      case 'down':\n        try {\n          newSelTd = selectedTd.parentNode.nextSibling.lastChild\n        } catch (e) {\n          this.walk('up')\n          return\n        } // end\n        deselectAll()\n        setSelected(newSelTd, true)\n        break\n      case 'up':\n        try {\n          newSelTd = selectedTd.parentNode.previousSibling.lastChild\n        } catch (e) {\n          return\n        } // top\n        deselectAll()\n        setSelected(newSelTd, true)\n        break\n      case 'right':\n        deselectAll()\n        if (\n          selectedTd.nextSibling ||\n          selectedTd.lastChild.tagName === 'strong'\n        ) {\n          setSelected(selectedTd.nextSibling, true)\n        } else {\n          const newSelected = dom.evaluate(\n            'table/div/tr/td[2]',\n            selectedTd,\n            null,\n            XPathResult.FIRST_ORDERED_NODE_TYPE,\n            null\n          ).singleNodeValue\n          setSelected(newSelected, true)\n        }\n        break\n      case 'left':\n        deselectAll()\n        if (\n          selectedTd.previousSibling &&\n          selectedTd.previousSibling.className === 'undetermined'\n        ) {\n          setSelected(selectedTd.previousSibling, true)\n          return true // do not shrink signal\n        } else {\n          setSelected(UI.utils.ancestor(selectedTd.parentNode, 'TD'), true)\n        } // supplied by thieOutline.focusTd\n        break\n      case 'moveTo':\n        // UI.log.info(selection[0].textContent+'->'+inputTd.textContent);\n        deselectAll()\n        setSelected(inputTd, true)\n        break\n    }\n    if (directionCode === 'down' || directionCode === 'up') {\n      if (!newSelTd.tabulatorSelect) this.walk(directionCode)\n    }\n    // return newSelTd;\n  }\n\n  // Keyboard Input: we can consider this as...\n  // 1. a fast way to modify data - enter will go to next predicate\n  // 2. an alternative way to input - enter at the end of a predicate will create a new statement\n  this.OutlinerKeypressPanel = function OutlinerKeypressPanel (e) {\n    UI.log.info('Key ' + e.keyCode + ' pressed')\n\n    function showURI (about) {\n      if (about && dom.getElementById('UserURI')) {\n        dom.getElementById('UserURI').value =\n          about.termType === 'NamedNode' ? about.uri : '' // blank if no URI\n      }\n    }\n\n    function setSelectedAfterward (_uri) {\n      if (arguments[3]) return true\n      walk('right', selectedTd)\n      showURI(UI.utils.getAbout(kb, selection[0]))\n      return true\n    }\n    let target, editable\n\n    if (UI.utils.getTarget(e).tagName === 'TEXTAREA') return\n    if (UI.utils.getTarget(e).id === 'UserURI') return\n    if (selection.length > 1) return\n    if (selection.length === 0) {\n      if (\n        e.keyCode === 13 ||\n        e.keyCode === 38 ||\n        e.keyCode === 40 ||\n        e.keyCode === 37 ||\n        e.keyCode === 39\n      ) {\n        this.walk('right', thisOutline.focusTd)\n        showURI(UI.utils.getAbout(kb, selection[0]))\n      }\n      return\n    }\n    const selectedTd = selection[0]\n    // if not done, Have to deal with redraw...\n    sf.removeCallback('done', 'setSelectedAfterward')\n    sf.removeCallback('fail', 'setSelectedAfterward')\n\n    switch (e.keyCode) {\n      case 13: // enter\n        if (UI.utils.getTarget(e).tagName === 'HTML') {\n          // I don't know why 'HTML'\n          const object = UI.utils.getAbout(kb, selectedTd)\n          target = selectedTd.parentNode.AJAR_statement.why\n          editable = UI.store.updater.editable(target.uri, kb)\n          if (object) {\n            // <Feature about='enterToExpand'>\n            outline.GotoSubject(object, true)\n            /* //deal with this later\n            deselectAll();\n            var newTr=dom.getElementById('outline').lastChild;\n            setSelected(newTr.firstChild.firstChild.childNodes[1].lastChild,true);\n            function setSelectedAfterward(uri){\n                deselectAll();\n                setSelected(newTr.firstChild.firstChild.childNodes[1].lastChild,true);\n                showURI(getAbout(kb,selection[0]));\n                return true;\n            }\n            sf.insertCallback('done',setSelectedAfterward);\n            sf.insertCallback('fail',setSelectedAfterward);\n            */\n            // </Feature>\n          } else if (editable) {\n            // this is a text node and editable\n            thisOutline.UserInput.Enter(selectedTd)\n          }\n        } else {\n          // var newSelTd=thisOutline.UserInput.lastModified.parentNode.parentNode.nextSibling.lastChild;\n          this.UserInput.Keypress(e)\n          this.walk('down') // bug with input at the end\n          // dom.getElementById('docHTML').focus(); //have to set this or focus blurs\n          e.stopPropagation()\n        }\n        return\n      case 38: // up\n        // thisOutline.UserInput.clearInputAndSave();\n        // ^^^ does not work because up and down not captured...\n        this.walk('up')\n        e.stopPropagation()\n        e.preventDefault()\n        break\n      case 40: // down\n        // thisOutline.UserInput.clearInputAndSave();\n        this.walk('down')\n        e.stopPropagation()\n        e.preventDefault()\n    } // switch\n\n    if (UI.utils.getTarget(e).tagName === 'INPUT') return\n\n    switch (e.keyCode) {\n      case 46: // delete\n      case 8: // backspace\n        target = selectedTd.parentNode.AJAR_statement.why\n        editable = UI.store.updater.editable(target.uri, kb)\n        if (editable) {\n          e.preventDefault() // prevent from going back\n          this.UserInput.Delete(selectedTd)\n        }\n        break\n      case 37: // left\n        if (this.walk('left')) return\n        var titleTd = UI.utils.ancestor(selectedTd.parentNode, 'TD')\n        outlineCollapse(selectedTd, UI.utils.getAbout(kb, titleTd))\n        break\n      case 39: // right\n        // @@ TODO: Write away the need for exception on next line\n        // eslint-disable-next-line no-case-declarations\n        const obj = UI.utils.getAbout(kb, selectedTd)\n        if (obj) {\n          var walk = this.walk\n\n          if (selectedTd.nextSibling) {\n            // when selectedTd is a predicate\n            this.walk('right')\n            return\n          }\n          if (selectedTd.firstChild.tagName !== 'TABLE') {\n            // not expanded\n            sf.addCallback('done', setSelectedAfterward)\n            sf.addCallback('fail', setSelectedAfterward)\n            outlineExpand(selectedTd, obj, {\n              pane: panes.byName('defaultPane')\n            })\n          }\n          setSelectedAfterward()\n        }\n        break\n      case 38: // up\n      case 40: // down\n        break\n      default:\n        switch (e.charCode) {\n          case 99: // c for Copy\n            if (e.ctrlKey) {\n              thisOutline.UserInput.copyToClipboard(\n                thisOutline.clipboardAddress,\n                selectedTd\n              )\n              break\n            }\n            break\n          case 118: // v\n          case 112: // p for Paste\n            if (e.ctrlKey) {\n              thisOutline.UserInput.pasteFromClipboard(\n                thisOutline.clipboardAddress,\n                selectedTd\n              )\n              // dom.getElementById('docHTML').focus(); //have to set this or focus blurs\n              // window.focus();\n              // e.stopPropagation();\n              break\n            }\n            break\n          default:\n            if (UI.utils.getTarget(e).tagName === 'HTML') {\n              /*\n              //<Feature about='typeOnSelectedToInput'>\n              thisOutline.UserInput.Click(e,selectedTd);\n              thisOutline.UserInput.lastModified.value=String.fromCharCode(e.charCode);\n              if (selectedTd.className==='undetermined selected') thisOutline.UserInput.AutoComplete(e.charCode)\n              //</Feature>\n              */\n              // Events are not reliable...\n              // var e2=document.createEvent('KeyboardEvent');\n              // e2.initKeyEvent('keypress',true,true,null,false,false,false,false,e.keyCode,0);\n              // UserInput.lastModified.dispatchEvent(e2);\n            }\n        }\n    } // end of switch\n\n    showURI(UI.utils.getAbout(kb, selection[0]))\n    // alert(window);alert(doc);\n    /*\n    var wm = Components.classes['@mozilla.org/appshell/window-mediator;1']\n               .getService(Components.interfaces.nsIWindowMediator);\n    var gBrowser = wm.getMostRecentWindow('navigator:browser') */\n    // gBrowser.addTab('http://www.w3.org/');\n    // alert(gBrowser.addTab);alert(gBrowser.scroll);alert(gBrowser.scrollBy)\n    // gBrowser.scrollBy(0,100);\n\n    // var thisHtml=selection[0].owner\n    if (selection[0]) {\n      const PosY = UI.utils.findPos(selection[0])[1]\n      if (\n        PosY + selection[0].clientHeight >\n        window.scrollY + window.innerHeight\n      ) {\n        UI.utils.getEyeFocus(selection[0], true, true, window)\n      }\n      if (PosY < window.scrollY + 54) {\n        UI.utils.getEyeFocus(selection[0], true, undefined, window)\n      }\n    }\n  }\n  this.OutlinerMouseclickPanel = function (e) {\n    switch (thisOutline.UserInput._tabulatorMode) {\n      case 0:\n        TabulatorMousedown(e)\n        break\n      case 1:\n        thisOutline.UserInput.Click(e)\n        break\n      default:\n    }\n  }\n\n  /** things to do onmousedown in outline view **/\n  /*\n   **   To Do:  This big event handler needs to be replaced by lots\n   ** of little ones individually connected to each icon.  This horrible\n   ** switch below isn't modular. (Sorry!) - Tim\n   */\n  // expand\n  // collapse\n  // refocus\n  // select\n  // visit/open a page\n\n  function expandMouseDownListener (e) {\n    // For icon (UI.icons.originalIconBase + 'tbl-expand-trans.png')\n    const target = thisOutline.targetOf(e)\n    const p = target.parentNode\n    const subject = UI.utils.getAbout(kb, target)\n    const pane = e.altKey ? panes.byName('internal') : undefined // set later: was panes.defaultPane\n\n    if (e.shiftKey) {\n      // Shift forces a refocus - bring this to the top\n      outlineRefocus(p, subject, pane)\n    } else {\n      if (e.altKey) {\n        // To investigate screw ups, dont wait show internals\n        outlineExpand(p, subject, {\n          pane: panes.byName('internal'),\n          immediate: true\n        })\n      } else {\n        outlineExpand(p, subject)\n      }\n    }\n  }\n\n  function collapseMouseDownListener (e) {\n    // for icon UI.icons.originalIconBase + 'tbl-collapse.png'\n    const target = thisOutline.targetOf(e)\n    const subject = UI.utils.getAbout(kb, target)\n    const pane = e.altKey ? panes.byName('internal') : undefined\n    const p = target.parentNode.parentNode\n    outlineCollapse(p, subject, pane)\n  }\n\n  function failedIconMouseDownListener (e) {\n    // outlineIcons.src.icon_failed\n    const target = thisOutline.targetOf(e)\n    const uri = target.getAttribute('uri') // Put on access buttons\n    if (e.altKey) {\n      sf.fetch(UI.rdf.uri.docpart(uri), {\n        force: true\n      }) // Add 'force' bit?\n    } else {\n      sf.refresh(kb.sym(UI.rdf.uri.docpart(uri))) // just one\n    }\n  }\n\n  function fetchedIconMouseDownListener (e) {\n    // outlineIcons.src.icon_fetched\n    const target = thisOutline.targetOf(e)\n    const uri = target.getAttribute('uri') // Put on access buttons\n    if (e.altKey) {\n      sf.fetch(UI.rdf.uri.docpart(uri), {\n        force: true\n      })\n    } else {\n      sf.refresh(kb.sym(UI.rdf.uri.docpart(uri))) // just one\n    }\n  }\n\n  function unrequestedIconMouseDownListener (e) {\n    const target = thisOutline.targetOf(e)\n    const uri = target.getAttribute('uri') // Put on access buttons\n    sf.fetch(UI.rdf.uri.docpart(uri))\n  }\n\n  function removeNodeIconMouseDownListener (e) {\n    // icon_remove_node\n    const target = thisOutline.targetOf(e)\n    let node = target.node\n    if (node.childNodes.length > 1) node = target.parentNode // parallel outline view @@ Hack\n    removeAndRefresh(node) // @@ update icons for pane?\n  }\n\n  function selectableTDClickListener (e) {\n    // Is we are in editing mode already\n    if (thisOutline.UserInput._tabulatorMode) {\n      return thisOutline.UserInput.Click(e)\n    }\n\n    const target = thisOutline.targetOf(e)\n    // Originally this was set on the whole tree and could happen anywhere\n    // var p = target.parentNode\n    let node\n    for (\n      node = UI.utils.ancestor(target, 'TD');\n      node && !(node.getAttribute('notSelectable') === 'false'); // Default now is not selectable\n      node = UI.utils.ancestor(node.parentNode, 'TD')\n    ) {\n      // ...\n    }\n    if (!node) return\n\n    // var node = target;\n\n    const sel = selected(node)\n    // var cla = node.getAttribute('class')\n    UI.log.debug('Was node selected before: ' + sel)\n    if (e.altKey) {\n      setSelected(node, !selected(node))\n    } else if (e.shiftKey) {\n      setSelected(node, true)\n    } else {\n      // setSelected(node, !selected(node))\n      deselectAll()\n      thisOutline.UserInput.clearInputAndSave(e)\n      setSelected(node, true)\n\n      if (e.detail === 2) {\n        // double click -> quit TabulatorMousedown()\n        e.stopPropagation()\n        return\n      }\n      // if the node is already selected and the corresponding statement is editable,\n      // go to UserInput\n      const st = node.parentNode.AJAR_statement\n      if (!st) return // For example in the title TD of an expanded pane\n      const target = st.why\n      const editable = UI.store.updater.editable(target.uri, kb)\n      if (sel && editable) thisOutline.UserInput.Click(e, selection[0]) // was next 2 lines\n      // var text='TabulatorMouseDown@Outline()';\n      // HCIoptions['able to edit in Discovery Mode by mouse'].setupHere([sel,e,thisOutline,selection[0]],text);\n    }\n    UI.log.debug(\n      'Was node selected after: ' +\n        selected(node) +\n        ', count=' +\n        selection.length\n    )\n    // var tr = node.parentNode\n    /*\n    if (tr.AJAR_statement) {\n      // var why = tr.AJAR_statement.why\n        // UI.log.info('Information from '+why);\n    }\n    */\n    e.stopPropagation()\n    // this is important or conflict between deselect and user input happens\n  }\n\n  function TabulatorMousedown (e) {\n    UI.log.info('@TabulatorMousedown, dom.location is now ' + dom.location)\n    const target = thisOutline.targetOf(e)\n    if (!target) return\n    const tname = target.tagName\n    // UI.log.debug('TabulatorMousedown: ' + tname + ' shift='+e.shiftKey+' alt='+e.altKey+' ctrl='+e.ctrlKey);\n    // var p = target.parentNode\n    // var about = UI.utils.getAbout(kb, target)\n    // var source = null\n    if (tname === 'INPUT' || tname === 'TEXTAREA') {\n      return\n    }\n\n    // not input then clear\n    thisOutline.UserInput.clearMenu()\n\n    // ToDo:remove this and recover X\n    if (\n      thisOutline.UserInput.lastModified &&\n      thisOutline.UserInput.lastModified.parentNode.nextSibling\n    ) {\n      thisOutline.UserInput.backOut()\n    }\n\n    // if (typeof rav=='undefined') //uncomment this for javascript2rdf\n    // have to put this here or this conflicts with deselectAll()\n\n    if (\n      !target.src ||\n      (target.src.slice(target.src.indexOf('/icons/') + 1) !==\n        outlineIcons.src.icon_show_choices &&\n        target.src.slice(target.src.indexOf('/icons/') + 1) !==\n          outlineIcons.src.icon_add_triple)\n    ) {\n      thisOutline.UserInput.clearInputAndSave(e)\n    }\n\n    if (\n      !target.src ||\n      target.src.slice(target.src.indexOf('/icons/') + 1) !==\n        outlineIcons.src.icon_show_choices\n    ) {\n      thisOutline.UserInput.clearMenu()\n    }\n\n    if (e) e.stopPropagation()\n  } // function TabulatorMousedown\n\n  function setUrlBarAndTitle (subject) {\n    dom.title = UI.utils.label(subject)\n    if (dom.location.href.startsWith(subject.site().uri)) {\n      // dom.location = subject.uri  // No causes reload\n    }\n  }\n\n  /** Expand an outline view\n   * @param p {Element} - container\n   */\n  function outlineExpand (p, subject1, options) {\n    options = options || {}\n    const pane = options.pane\n    let already = !!options.already\n    const immediate = options.immediate\n\n    UI.log.info('@outlineExpand, dom is now ' + dom.location)\n    // remove callback to prevent unexpected repaint\n    sf.removeCallback('done', 'expand')\n    sf.removeCallback('fail', 'expand')\n\n    let subject = kb.canon(subject1)\n    // var requTerm = subject.uri ? kb.sym(UI.rdf.uri.docpart(subject.uri)) : subject\n\n    function render () {\n      subject = kb.canon(subject)\n      if (!p || !p.parentNode || !p.parentNode.parentNode) return false\n\n      let newTable\n      UI.log.info('@@ REPAINTING ')\n      if (!already) {\n        // first expand\n        newTable = propertyTable(subject, undefined, pane, options)\n      } else {\n        UI.log.info(' ... p is  ' + p)\n        for (\n          newTable = p.firstChild;\n          newTable.nextSibling;\n          newTable = newTable.nextSibling\n        ) {\n          UI.log.info(' ... checking node ' + newTable)\n          if (newTable.nodeName === 'table') break\n        }\n        newTable = propertyTable(subject, newTable, pane, options)\n      }\n      already = true\n      if (\n        UI.utils.ancestor(p, 'TABLE') &&\n        UI.utils.ancestor(p, 'TABLE').style.backgroundColor === 'white'\n      ) {\n        newTable.style.backgroundColor = '#eee'\n      } else {\n        newTable.style.backgroundColor = 'white'\n      }\n      try {\n        if (YAHOO.util.Event.off) {\n          YAHOO.util.Event.off(p, 'mousedown', 'dragMouseDown')\n        }\n      } catch (e) {\n        console.log('YAHOO ' + e)\n      }\n      UI.utils.emptyNode(p).appendChild(newTable)\n      thisOutline.focusTd = p // I don't know why I couldn't use 'this'...because not defined in callbacks\n      UI.log.debug('expand: Node for ' + subject + ' expanded')\n      // fetch seeAlso when render()\n      // var seeAlsoStats = sf.store.statementsMatching(subject, UI.ns.rdfs('seeAlso'))\n      // seeAlsoStats.map(function (x) {sf.lookUpThing(x.object, subject,false);})\n      const seeAlsoWhat = kb.each(subject, UI.ns.rdfs('seeAlso'))\n      for (let i = 0; i < seeAlsoWhat.length; i++) {\n        if (i === 25) {\n          UI.log.warn(\n            'expand: Warning: many (' +\n              seeAlsoWhat.length +\n              ') seeAlso links for ' +\n              subject\n          )\n          // break; Not sure what limits the AJAX system has here\n        }\n        sf.lookUpThing(seeAlsoWhat[i], subject)\n      }\n    }\n\n    function expand (uri) {\n      if (arguments[3]) return true // already fetched indicator\n      const cursubj = kb.canon(subject) // canonical identifier may have changed\n      UI.log.info(\n        '@@ expand: relevant subject=' +\n          cursubj +\n          ', uri=' +\n          uri +\n          ', already=' +\n          already\n      )\n      // var term = kb.sym(uri)\n      const docTerm = kb.sym(UI.rdf.uri.docpart(uri))\n      if (uri.indexOf('#') >= 0) {\n        throw new Error('Internal error: hash in ' + uri)\n      }\n\n      const relevant = function () {\n        // Is the loading of this URI relevam to the display of subject?\n        if (!cursubj.uri) return true // bnode should expand()\n        const as = kb.uris(cursubj)\n        if (!as) return false\n        for (let i = 0; i < as.length; i++) {\n          // canon'l uri or any alias\n          for (\n            let rd = UI.rdf.uri.docpart(as[i]);\n            rd;\n            rd = kb.HTTPRedirects[rd]\n          ) {\n            if (uri === rd) return true\n          }\n        }\n        if (kb.anyStatementMatching(cursubj, undefined, undefined, docTerm)) {\n          return true\n        } // Kenny: inverse?\n        return false\n      }\n      if (relevant()) {\n        UI.log.success(\n          '@@ expand OK: relevant subject=' +\n            cursubj +\n            ', uri=' +\n            uri +\n            ', source=' +\n            already\n        )\n\n        render()\n        return false //  @@@@@@@@@@@ Will this allow just the first\n      }\n      return true\n    }\n    // Body of outlineExpand\n\n    if (options.solo) {\n      setUrlBarAndTitle(subject)\n    }\n    UI.log.debug('outlineExpand: dereferencing ' + subject)\n    const status = dom.createElement('span')\n    p.appendChild(status)\n    sf.addCallback('done', expand) // @@@@@@@ This can really mess up existing work\n    sf.addCallback('fail', expand) // Need to do if there s one a gentle resync of page with store\n\n    const returnConditions = [] // this is quite a general way to do cut and paste programming\n    // I might make a class for this\n    if (subject.uri && subject.uri.split(':')[0] === 'rdf') {\n      // what is this? -tim\n      render()\n      return\n    }\n\n    for (let i = 0; i < returnConditions.length; i++) {\n      var returnCode\n      if (returnCode === returnConditions[i](subject)) {\n        render()\n        UI.log.debug('outline 1815')\n        if (returnCode[1]) outlineElement.removeChild(outlineElement.lastChild)\n        return\n      }\n    }\n    if (\n      subject.uri &&\n      !immediate &&\n      !UI.widgets.isAudio(subject) &&\n      !UI.widgets.isVideo(subject) && // Never parse videos as data\n      !kb.holds(\n        subject,\n        UI.ns.rdf('type'),\n        $rdf.Util.mediaTypeClass('application/pdf')\n      )\n    ) {\n      // or PDF\n      // Wait till at least the main URI is loaded before expanding:\n      sf.nowOrWhenFetched(subject.doc(), undefined, function (ok, body) {\n        if (ok) {\n          sf.lookUpThing(subject)\n          render() // inital open, or else full if re-open\n          if (options.solo) {\n            // Update window title with new information\n            // dom.title = UI.utils.label(subject)\n            setUrlBarAndTitle(subject)\n          }\n        } else {\n          const message = dom.createElement('pre')\n          message.textContent = body\n          message.setAttribute('style', 'background-color: #fee;')\n          message.textContent =\n            'Outline.expand: Unable to fetch ' + subject.doc() + ': ' + body\n          p.appendChild(message)\n        }\n      })\n    } else {\n      render()\n    }\n  } // outlineExpand\n\n  function outlineCollapse (p, subject) {\n    let row = UI.utils.ancestor(p, 'TR')\n    row = UI.utils.ancestor(row.parentNode, 'TR') // two levels up\n    if (row) var statement = row.AJAR_statement\n    let level // find level (the enclosing TD)\n    for (\n      level = p.parentNode;\n      level.tagName !== 'TD';\n      level = level.parentNode\n    ) {\n      if (typeof level === 'undefined') {\n        alert('Not enclosed in TD!')\n        return\n      }\n    }\n\n    UI.log.debug('Collapsing subject ' + subject)\n    let myview\n    if (statement) {\n      UI.log.debug('looking up pred ' + statement.predicate.uri + 'in defaults')\n      myview = views.defaults[statement.predicate.uri]\n    }\n    UI.log.debug('view= ' + myview)\n    if (level.parentNode.parentNode.id === 'outline') {\n      var deleteNode = level.parentNode\n    }\n    thisOutline.replaceTD(\n      thisOutline.outlineObjectTD(subject, myview, deleteNode, statement),\n      level\n    )\n  } // outlineCollapse\n\n  this.replaceTD = function replaceTD (newTd, replacedTd) {\n    let reselect\n    if (selected(replacedTd)) reselect = true\n\n    // deselects everything being collapsed. This goes backwards because\n    // deselecting an element decreases selection.length\n    for (let x = selection.length - 1; x > -1; x--) {\n      for (let elt = selection[x]; elt.parentNode; elt = elt.parentNode) {\n        if (elt === replacedTd) {\n          setSelected(selection[x], false)\n        }\n      }\n    }\n\n    replacedTd.parentNode.replaceChild(newTd, replacedTd)\n    if (reselect) setSelected(newTd, true)\n  }\n\n  function outlineRefocus (p, subject) {\n    // Shift-expand or shift-collapse: Maximize\n    let outer = null\n    for (let level = p.parentNode; level; level = level.parentNode) {\n      UI.log.debug('level ' + level.tagName)\n      if (level.tagName === 'TD') outer = level\n    } // find outermost td\n    UI.utils.emptyNode(outer).appendChild(propertyTable(subject))\n    setUrlBarAndTitle(subject)\n    // dom.title = UI.utils.label(subject)\n    outer.setAttribute('about', subject.toNT())\n  } // outlineRefocus\n\n  outline.outlineRefocus = outlineRefocus\n\n  // Inversion is turning the outline view inside-out\n  // It may be called eversion\n  /*\n  function outlineInversion (p, subject) { // re-root at subject\n    function move_root (rootTR, childTR) { // swap root with child\n      // @@\n    }\n  }\n*/\n  this.GotoFormURI_enterKey = function (e) {\n    if (e.keyCode === 13) outline.GotoFormURI(e)\n  }\n  this.GotoFormURI = function (_e) {\n    GotoURI(dom.getElementById('UserURI').value)\n  }\n\n  function GotoURI (uri) {\n    const subject = kb.sym(uri)\n    this.GotoSubject(subject, true)\n  }\n  this.GotoURIinit = function (uri) {\n    const subject = kb.sym(uri)\n    this.GotoSubject(subject)\n  }\n\n  /** Display the subject in an outline view\n\n  @param subject -- RDF term for teh thing to be presented\n  @param expand  -- flag -- open the subject rather than keep folded closed\n  @param pane    -- optional -- pane to be used for expanded display\n  @param solo    -- optional -- the window will be cleared out and only the subject displayed\n  @param referer -- optional -- where did we hear about this from anyway?\n  @param table   -- option  -- a table element in which to put the outline.\n*/\n  this.GotoSubject = function (subject, expand, pane, solo, referrer, table) {\n    table = table || dom.getElementById('outline') // if does not exist just add one? nowhere to out it\n    if (solo) {\n      UI.utils.emptyNode(table)\n      table.style.width = '100%'\n    }\n\n    function GotoSubjectDefault () {\n      const tr = dom.createElement('TR')\n      tr.style.verticalAlign = 'top'\n      table.appendChild(tr)\n      const td = thisOutline.outlineObjectTD(subject, undefined, tr)\n      tr.appendChild(td)\n      return td\n    }\n\n    const td = GotoSubjectDefault()\n\n    if (solo) setUrlBarAndTitle(subject) // dom.title = UI.utils.label(subject) // 'Tabulator: '+  No need to advertize\n\n    if (expand) {\n      outlineExpand(td, subject, {\n        pane: pane,\n        solo: solo\n      })\n      const tr = td.parentNode\n      UI.utils.getEyeFocus(tr, false, undefined, window) // instantly: false\n    }\n\n    if (\n      solo &&\n      dom &&\n      dom.defaultView &&\n      dom.defaultView.history &&\n      // Don't add the new location to the history if we arrived here through a direct link\n      // (i.e. when static/databrowser.html in node-solid-server called this method):\n      document.location.href !== subject.uri\n    ) {\n      const stateObj = pane ? { paneName: pane.name } : {}\n      try {\n        // can fail if different origin\n        dom.defaultView.history.pushState(stateObj, subject.uri, subject.uri)\n      } catch (e) {\n        console.log(e)\n      }\n    }\n\n    return subject\n  }\n\n  // / /////////////////////////////////////////////////////\n  //\n  //\n  //                    VIEWS\n  //\n  //\n  // / /////////////////////////////////////////////////////\n\n  var ns = UI.ns\n\n  const views = propertyViews(dom)\n\n  // var thisOutline = this   dup\n  /** some builtin simple views **/\n\n  function viewAsBoringDefault (obj) {\n    // UI.log.debug('entered viewAsBoringDefault...');\n    let rep // representation in html\n\n    if (obj.termType === 'Literal') {\n      const styles = {\n        integer: 'text-align: right;',\n        decimal: \"text-align: '.';\",\n        double: \"text-align: '.';\"\n      }\n      rep = dom.createElement('span')\n      rep.textContent = obj.value\n      // Newlines have effect and overlong lines wrapped automatically\n      let style = ''\n      if (obj.datatype && obj.datatype.uri) {\n        const xsd = UI.ns.xsd('').uri\n        if (obj.datatype.uri.slice(0, xsd.length) === xsd) {\n          style = styles[obj.datatype.uri.slice(xsd.length)]\n        }\n      }\n      rep.setAttribute('style', style || 'white-space: pre-wrap;')\n    } else if (obj.termType === 'NamedNode' || obj.termType === 'BlankNode') {\n      rep = dom.createElement('span')\n      rep.setAttribute('about', obj.toNT())\n      thisOutline.appendAccessIcons(kb, rep, obj)\n\n      if (obj.termType === 'NamedNode') {\n        if (obj.uri.slice(0, 4) === 'tel:') {\n          const num = obj.uri.slice(4)\n          const anchor = dom.createElement('a')\n          rep.appendChild(dom.createTextNode(num))\n          anchor.setAttribute('href', obj.uri)\n          anchor.appendChild(\n            UI.utils.AJARImage(\n              outlineIcons.src.icon_telephone,\n              'phone',\n              'phone ' + num,\n              dom\n            )\n          )\n          rep.appendChild(anchor)\n          anchor.firstChild.setAttribute('class', 'phoneIcon')\n        } else {\n          // not tel:\n          rep.appendChild(dom.createTextNode(UI.utils.label(obj)))\n          const anchor = UI.widgets.linkIcon(dom, obj)\n          rep.appendChild(anchor)\n          UI.widgets.makeDraggable(rep, obj) // 2017\n        }\n      } else {\n        // bnode\n        rep.appendChild(dom.createTextNode(UI.utils.label(obj)))\n      }\n    } else if (obj.termType === 'Collection') {\n      // obj.elements is an array of the elements in the collection\n      rep = dom.createElement('table')\n      rep.setAttribute('style', 'width: 100%;')\n      rep.setAttribute('about', obj.toNT())\n      /* Not sure which looks best -- with or without. I think without\n\n                var tr = rep.appendChild(document.createElement('tr'));\n                tr.appendChild(document.createTextNode(\n                        obj.elements.length ? '(' + obj.elements.length+')' : '(none)'));\n        */\n      for (let i = 0; i < obj.elements.length; i++) {\n        const elt = obj.elements[i]\n        const row = rep.appendChild(dom.createElement('tr'))\n        const numcell = row.appendChild(dom.createElement('td'))\n        numcell.setAttribute(\n          'style',\n          'margin: 0.2em; border: none; padding: 0; vertical-align: top;'\n        )\n        numcell.setAttribute('notSelectable', 'false')\n        numcell.setAttribute('about', obj.toNT())\n        numcell.innerHTML = i + 1 + ')'\n        row.appendChild(thisOutline.outlineObjectTD(elt))\n      }\n    } else if (obj.termType === 'Graph') {\n      rep = panes\n        .byName('dataContentPane')\n        .statementsAsTables(obj.statements, context)\n      rep.setAttribute('class', 'nestedFormula')\n    } else {\n      UI.log.error('Object ' + obj + ' has unknown term type: ' + obj.termType)\n      rep = dom.createTextNode('[unknownTermType:' + obj.termType + ']')\n    } // boring defaults.\n    UI.log.debug('contents: ' + rep.innerHTML)\n    return rep\n  } // boring_default\n\n  this.createTabURI = function () {\n    dom.getElementById('UserURI').value =\n      dom.URL + '?uri=' + dom.getElementById('UserURI').value\n  }\n\n  // a way to expose variables to UserInput without making them propeties/methods\n  this.UserInput.setSelected = setSelected\n  this.UserInput.deselectAll = deselectAll\n  this.UserInput.views = views\n  this.outlineExpand = outlineExpand\n\n  // this.panes = panes; // Allow external panes to register\n\n  return this\n} // END OF OUTLINE\n"],"file":"manager.js"}