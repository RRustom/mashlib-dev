{"version":3,"sources":["../src/classInstancePane.js"],"names":["UI","require","$rdf","ns","module","exports","icon","icons","originalIconBase","name","audience","solid","label","subject","context","kb","session","store","n","each","undefined","rdf","length","render","dom","outliner","getOutliner","complain","message","color","pre","createElement","setAttribute","div","appendChild","createTextNode","sts","statementsMatching","already","more","forEach","st","toNT","nt","findMembersNT","push","fromNT","utils","sameTerm","rdfs","uses","usedTypes","object","used","i","sym","tr","appendPropertyTRs","_pred"],"mappings":"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","sourcesContent":["/*   Class member Pane\n **\n **  This outline pane lists the members of a class\n */\n\nconst UI = require('solid-ui')\nconst $rdf = require('rdflib')\n\nconst ns = UI.ns\n\nmodule.exports = {\n  icon: UI.icons.originalIconBase + 'tango/22-folder-open.png',\n\n  name: 'classInstance',\n\n  // Create a new folder in a Solid system,\n\n  audience: [ns.solid('PowerUser')],\n\n  label: function (subject, context) {\n    const kb = context.session.store\n    const n = kb.each(undefined, ns.rdf('type'), subject).length\n    if (n > 0) return 'List (' + n + ')' // Show how many in hover text\n    return null // Suppress pane otherwise\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const outliner = context.getOutliner(dom)\n    const kb = context.session.store\n    const complain = function complain (message, color) {\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', 'background-color: ' + color || '#eed' + ';')\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n    var div = dom.createElement('div')\n    div.setAttribute('class', 'instancePane')\n    div.setAttribute(\n      'style',\n      '  border-top: solid 1px #777; border-bottom: solid 1px #777; margin-top: 0.5em; margin-bottom: 0.5em '\n    )\n\n    // If this is a class, look for all both explicit and implicit\n    const sts = kb.statementsMatching(undefined, ns.rdf('type'), subject)\n    if (sts.length > 0) {\n      const already = {}\n      const more = []\n      sts.forEach(st => {\n        already[st.subject.toNT()] = st\n      })\n      for (const nt in kb.findMembersNT(subject)) {\n        if (!already[nt]) {\n          more.push($rdf.st(kb.fromNT(nt), ns.rdf('type'), subject)) // @@ no provenance\n        }\n      }\n      if (more.length) {\n        complain(\n          'There are ' +\n            sts.length +\n            ' explicit and ' +\n            more.length +\n            ' implicit members of ' +\n            UI.utils.label(subject)\n        )\n      }\n      if (subject.sameTerm(ns.rdf('Property'))) {\n        // / Do not find all properties used as properties .. unless look at kb index\n      } else if (subject.sameTerm(ns.rdfs('Class'))) {\n        const uses = kb.statementsMatching(undefined, ns.rdf('type'), undefined)\n        const usedTypes = {}\n        uses.forEach(function (st) {\n          usedTypes[st.object] = st\n        }) // Get unique\n        const used = []\n        for (const i in usedTypes) {\n          used.push($rdf.st($rdf.sym(i), ns.rdf('type'), ns.rdfs('Class')))\n        }\n        complain(\n          'Total of ' +\n            uses.length +\n            ' type statements and ' +\n            used.length +\n            ' unique types.'\n        )\n      }\n\n      if (sts.length > 10) {\n        const tr = dom.createElement('TR')\n        tr.appendChild(dom.createTextNode('' + sts.length))\n        // tr.AJAR_statement=sts[i]\n        div.appendChild(tr)\n      }\n\n      outliner.appendPropertyTRs(div, sts, true, function (_pred) {\n        return true\n      })\n\n      if (more.length) {\n        complain('Implicit:')\n        outliner.appendPropertyTRs(div, more, true, function (_pred) {\n          return true\n        })\n      }\n    }\n\n    return div\n  }\n}\n// ends\n"],"file":"classInstancePane.js"}