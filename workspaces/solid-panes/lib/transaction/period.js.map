{"version":3,"sources":["../../src/transaction/period.js"],"names":["UI","require","ns","module","exports","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","t","findTypeURIs","render","dom","div","createElement","setAttribute","mention","message","style","pre","appendChild","createTextNode","happy","complain","renderPeriod","dtstart","any","cal","undefined","uri","dtend","predicateURIsDone","donePredicate","pred","rdf","inPeriod","date","d2","n","s","indexOf","split","slice","transactionInPeriod","x","qu","oderByDate","y","dx","dy","value","h2","textContent","insertedPane","paneName","p","paneRegistry","byName","d","expandAfterRow","row","solo","siblings","parentNode","children","j","length","expanded","removeChild","tr","td","cols","nextSibling","insertBefore","expandAfterRowOrCollapse","transactionTable","list","table","transactionRow","setTRStyle","account","mystyle","backgroundColor","ui","c0","c1","payee","a1","c3","amount","addEventListener","e","shiftKey","list2","filter","sort","i","dummies","xURIs","findMemberURIs","unclassifiedIn","unclassifiedOut","usd","z","hasOwnProperty","sym","tt","each","classified","push","tab","count","catSymbol","catTail","cats","findSubClassesNT","cat","checkCatHasField","guilty","utils","trip","needed","rdfs","console","log","fetcher","load","then"],"mappings":"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","sourcesContent":["/*   Financial Period Pane\n **\n **  This outline pane allows a user to interact with a period\n **  downloaded from a bank statement, annotting it with classes and comments,\n ** trips, etc\n */\n\nconst UI = require('solid-ui')\nconst ns = UI.ns\n\nmodule.exports = {\n  icon: UI.icons.iconBase + 'noun_142708.svg',\n\n  name: 'period',\n\n  audience: [ns.solid('PowerUser')],\n\n  // Does the subject deserve this pane?\n  label: function (subject, context) {\n    const kb = context.session.store\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) return 'period'\n    return null // No under other circumstances (while testing at least!)\n  },\n\n  render: function (subject, context) {\n    const dom = context.dom\n    const kb = context.session.store\n    const ns = UI.ns\n\n    const div = dom.createElement('div')\n    div.setAttribute('class', 'periodPane')\n\n    const mention = function mention (message, style) {\n      if (!style) style = 'color: grey;'\n      const pre = dom.createElement('pre')\n      pre.setAttribute('style', style)\n      div.appendChild(pre)\n      pre.appendChild(dom.createTextNode(message))\n    }\n    const happy = function happy (message) {\n      return mention('✓ ' + message, 'color: #010; background-color: #efe')\n    }\n    const complain = function complain (message) {\n      return mention(message, 'color: #100; background-color: #fee')\n    }\n    /*\n    var rerender = function (div) {\n      var parent = div.parentNode\n      var div2 = thisPane.render(subject, dom)\n      parent.replaceChild(div2, div)\n    }\n*/\n    const renderPeriod = function () {\n      const dtstart = kb.any(subject, ns.cal('dtstart'))\n      if (dtstart === undefined) {\n        complain(\n          '(Error: There is no start date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      const dtend = kb.any(subject, ns.cal('dtend'))\n      if (dtend === undefined) {\n        complain(\n          '(Error: There is no end date known for this period <' +\n            subject.uri +\n            '>,\\n -- every period needs one.)'\n        )\n      }\n\n      // var store = kb.any(subject, UI.ns.qu('annotationStore')) || null\n\n      const predicateURIsDone = {}\n      const donePredicate = function (pred) {\n        predicateURIsDone[pred.uri] = true\n      }\n      donePredicate(ns.rdf('type'))\n\n      const inPeriod = function (date) {\n        return !!(date && date >= dtstart && date < dtend)\n      }\n\n      const d2 = function (n) {\n        const s = '' + n\n        if (s.indexOf('.') >= 0) {\n          return s.split('.')[0] + '.' + (s.split('.')[1] + '00').slice(0, 2)\n        }\n        return s + '.00'\n      }\n\n      const transactionInPeriod = function (x) {\n        return inPeriod(kb.any(x, ns.qu('date')))\n      }\n\n      const oderByDate = function (x, y) {\n        const dx = kb.any(x, ns.qu('date'))\n        const dy = kb.any(y, ns.qu('date'))\n        if (dx !== undefined && dy !== undefined) {\n          if (dx.value < dy.value) return -1\n          if (dx.value > dy.value) return 1\n        }\n        if (x.uri < y.uri) return -1 // Arbitrary but repeatable\n        if (x.uri > y.uri) return 1\n        return 0\n      }\n      /*\n      var setPaneStyle = function (account) {\n        var mystyle = 'padding: 0.5em 1.5em 1em 1.5em; '\n        if (account) {\n          var backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n          if (backgroundColor) {\n            mystyle += 'background-color: ' + backgroundColor.value + '; '\n          }\n        }\n        div.setAttribute('style', mystyle)\n      }\n      // setPaneStyle();\n*/\n      const h2 = div.appendChild(dom.createElement('h2'))\n      h2.textContent =\n        'Period ' +\n        dtstart.value.slice(0, 10) +\n        ' - ' +\n        dtend.value.slice(0, 10)\n\n      const insertedPane = function (context, subject, paneName) {\n        const p = context.session.paneRegistry.byName(paneName)\n        const d = p.render(subject, context)\n        d.setAttribute('style', 'border: 0.1em solid green;')\n        return d\n      }\n\n      const expandAfterRow = function (dom, row, subject, paneName, solo) {\n        const siblings = row.parentNode.children\n        if (solo) {\n          for (let j = siblings.length - 1; j >= 0; j--) {\n            if (siblings[j].expanded) {\n              siblings[j].parentNode.removeChild(siblings[j].expanded)\n              siblings[j].expanded = false\n            }\n          }\n        }\n        const tr = dom.createElement('tr')\n        const td = tr.appendChild(dom.createElement('td'))\n        td.setAttribute(\n          'style',\n          'width: 98%; padding: 1em; border: 0.1em solid grey;'\n        )\n        const cols = row.children.length\n        if (row.nextSibling) {\n          row.parentNode.insertBefore(tr, row.nextSibling)\n        } else {\n          row.parentNode.appendChild(tr)\n        }\n        row.expanded = tr\n        td.setAttribute('colspan', '' + cols)\n        td.appendChild(insertedPane(context, subject, paneName))\n      }\n\n      const expandAfterRowOrCollapse = function (\n        dom,\n        row,\n        subject,\n        paneName,\n        solo\n      ) {\n        if (row.expanded) {\n          row.parentNode.removeChild(row.expanded)\n          row.expanded = false\n        } else {\n          expandAfterRow(dom, row, subject, paneName, solo)\n        }\n      }\n\n      const transactionTable = function (dom, list) {\n        const table = dom.createElement('table')\n        table.setAttribute(\n          'style',\n          'margin-left: 100; font-size: 9pt; width: 85%;'\n        )\n        const transactionRow = function (dom, x) {\n          const tr = dom.createElement('tr')\n\n          const setTRStyle = function (tr, account) {\n            // var mystyle = \"padding: 0.5em 1.5em 1em 1.5em; \";\n            let mystyle = 'margin-left: 8em; padding-left: 5em;'\n            if (account) {\n              const backgroundColor = kb.any(account, UI.ns.ui('backgroundColor'))\n              if (backgroundColor) {\n                mystyle += 'background-color: ' + backgroundColor.value + '; '\n              }\n            }\n            tr.setAttribute('style', mystyle)\n          }\n\n          const account = kb.any(x, ns.qu('toAccount'))\n          setTRStyle(tr, account)\n\n          const c0 = tr.appendChild(dom.createElement('td'))\n          const date = kb.any(x, ns.qu('date'))\n          c0.textContent = date ? date.value.slice(0, 10) : '???'\n          c0.setAttribute('style', 'width: 7em;')\n\n          const c1 = tr.appendChild(dom.createElement('td'))\n          c1.setAttribute('style', 'width: 36em;')\n          const payee = kb.any(x, ns.qu('payee'))\n          c1.textContent = payee ? payee.value : '???'\n          const a1 = c1.appendChild(dom.createElement('a'))\n          a1.textContent = ' ➜'\n          a1.setAttribute('href', x.uri)\n\n          const c3 = tr.appendChild(dom.createElement('td'))\n          const amount = kb.any(x, ns.qu('in_USD'))\n          c3.textContent = amount ? d2(amount.value) : '???'\n          c3.setAttribute('style', 'width: 6em; text-align: right; ') // @@ decimal alignment?\n          tr.addEventListener(\n            'click',\n            function (e) {\n              // solo unless shift key\n              expandAfterRowOrCollapse(dom, tr, x, 'transaction', !e.shiftKey)\n            },\n            false\n          )\n\n          return tr\n        }\n\n        const list2 = list.filter(transactionInPeriod)\n        list2.sort(oderByDate)\n\n        for (let i = 0; i < list2.length; i++) {\n          table.appendChild(transactionRow(dom, list2[i]))\n        }\n        return table\n      }\n\n      // List unclassified transactions\n\n      const dummies = {\n        'http://www.w3.org/2000/10/swap/pim/qif#Transaction': true, // (we knew)\n        'http://www.w3.org/2000/10/swap/pim/qif#Unclassified': true, // pseudo classifications we may phase out\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedOutgoing': true,\n        'http://www.w3.org/2000/10/swap/pim/qif#UnclassifiedIncome': true\n      }\n      const xURIs = kb.findMemberURIs(ns.qu('Transaction'))\n      const unclassifiedIn = []\n      const unclassifiedOut = []\n      let usd, z\n      for (const y in xURIs) {\n        // For each thing which can be inferred to be a transaction\n        // @@ TODO: Write away the need for exception on next line\n        // eslint-disable-next-line no-prototype-builtins\n        if (xURIs.hasOwnProperty(y)) {\n          z = kb.sym(y)\n          const tt = kb.each(z, ns.rdf('type')) // What EXPLICIT definitions\n          let classified = false\n          for (let j = 0; j < tt.length; j++) {\n            const t = tt[j]\n            if (dummies[t.uri] === undefined) {\n              classified = true\n            }\n          }\n          if (!classified) {\n            usd = kb.any(z, ns.qu('in_USD'))\n            if (usd === undefined) {\n              usd = kb.any(z, ns.qu('amount'))\n            }\n            if (usd && ('' + usd.value).indexOf('-') >= 0) {\n              unclassifiedOut.push(kb.sym(y))\n            } else {\n              unclassifiedIn.push(kb.sym(y))\n            }\n          }\n        }\n      }\n      let tab, count\n      if (unclassifiedIn.length) {\n        tab = transactionTable(dom, unclassifiedIn)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Income' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified income')\n      }\n      if (unclassifiedOut.length) {\n        tab = transactionTable(dom, unclassifiedOut)\n        count = tab.children.length\n        div.appendChild(dom.createElement('h3')).textContent =\n          'Unclassified Outgoings' + (count < 4 ? '' : ' (' + count + ')')\n        div.appendChild(tab)\n      } else {\n        happy('No unclassified outgoings ')\n      }\n\n      // ///////////////  Check some categories of transaction for having given fields\n\n      const catSymbol = function (catTail) {\n        const cats = kb.findSubClassesNT(ns.qu('Transaction'))\n        for (const cat in cats) {\n          // @@ TODO: Write away the need for exception on next line\n          // eslint-disable-next-line no-prototype-builtins\n          if (cats.hasOwnProperty(cat)) {\n            if (cat.slice(1, -1).split('#')[1] === catTail) {\n              return kb.sym(cat.slice(1, -1))\n            }\n          }\n        }\n        return null\n      }\n\n      const checkCatHasField = function (catTail, pred) {\n        const cat = catSymbol(catTail)\n        let tab\n        const guilty = []\n        let count = 0\n        if (!cat) {\n          complain('Error: No category correspnding to ' + catTail)\n          return null\n        }\n        const list = kb.each(undefined, ns.rdf('type'), cat)\n        for (let i = 0; i < list.length; i++) {\n          if (!kb.any(list[i], pred)) {\n            guilty.push(list[i])\n          }\n        }\n        if (guilty.length) {\n          tab = transactionTable(dom, guilty)\n          count = tab.children.length\n          div.appendChild(dom.createElement('h3')).textContent =\n            UI.utils.label(cat) +\n            ' with no ' +\n            UI.utils.label(pred) +\n            (count < 4 ? '' : ' (' + count + ')')\n          div.appendChild(tab)\n        }\n        return count\n      }\n\n      // Load dynamically as properties of period\n      if (checkCatHasField('Reimbursables', ns.trip('trip')) === 0) {\n        happy('Reimbursables all have trips')\n      }\n      if (checkCatHasField('Other_Inc_Speaking', ns.trip('trip')) === 0) {\n        happy('Speaking income all has trips')\n      }\n      // end of render period instance\n    } // renderPeriod\n\n    // //////////////////////////////////////////////////////////////////////////////\n\n    // var me = UI.authn.currentUser()\n\n    //              Render a single Period\n\n    // This works only if enough metadata about the properties can drive the RDFS\n    // (or actual type statements whichtypically are NOT there on)\n    const t = kb.findTypeURIs(subject)\n    if (t['http://www.w3.org/2000/10/swap/pim/qif#Period']) {\n      const needed = kb.each(subject, ns.rdfs('seeAlso'))\n      console.log('Loading before render: ' + needed.length)\n      kb.fetcher.load(needed).then(function () {\n        renderPeriod()\n      })\n    }\n\n    // if (!me) complain(\"You do not have your Web Id set. Set your Web ID to make changes.\");\n\n    return div\n  }\n}\n// ends\n"],"file":"period.js"}