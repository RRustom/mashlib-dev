{"version":3,"sources":["../../src/playlist/playlistPane.js"],"names":["UI","require","$rdf","ns","module","exports","icon","icons","iconBase","name","audience","solid","label","subject","context","kb","session","store","anyStatementMatching","rdf","sym","render","myDocument","dom","isVideo","src","_index","html5","youtube","match","vimeo","dailymotion","vk","link","contents","uri","a","createElement","setAttribute","appendChild","addEventListener","widgets","openHrefInOutlineMode","text","str","createTextNode","obj","any","index","video","div","img","replace","value","sl","statementsMatching","slots","i","length","push","parseInt","object","descDiv","pIndex","indexOf","nIndex","prev","split","indexDiv","innerHTML","next","tr"],"mappings":"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","sourcesContent":["/*   Playlist Pane\n **\n **  This pane allows playlists and playlists slots to be viewed\n **  seeAlso: http://smiy.sourceforge.net/pbo/spec/playbackontology.html\n */\nconst UI = require('solid-ui')\nconst $rdf = require('rdflib')\nconst ns = UI.ns\n\nmodule.exports = {\n  icon: UI.icons.iconBase + 'noun_1619.svg',\n\n  name: 'playlistSlot',\n\n  audience: [ns.solid('PowerUser')],\n\n  label: function (subject, context) {\n    const kb = context.session.store\n\n    if (\n      !kb.anyStatementMatching(\n        subject,\n        UI.ns.rdf('type'),\n        kb.sym('http://purl.org/ontology/pbo/core#PlaylistSlot')\n      )\n    ) {\n      return null\n    }\n\n    return 'playlist slot'\n  },\n\n  render: function (subject, context) {\n    const myDocument = context.dom\n    function isVideo (src, _index) {\n      if (!src) {\n        return {\n          html5: true\n        }\n      }\n\n      const youtube = src.match(\n        /\\/\\/(?:www\\.)?youtu(?:\\.be|be\\.com)\\/(?:watch\\?v=|embed\\/)?([a-z0-9\\-_%]+)/i\n      )\n      const vimeo = src.match(/\\/\\/(?:www\\.)?vimeo.com\\/([0-9a-z\\-_]+)/i)\n      const dailymotion = src.match(/\\/\\/(?:www\\.)?dai.ly\\/([0-9a-z\\-_]+)/i)\n      const vk = src.match(\n        /\\/\\/(?:www\\.)?(?:vk\\.com|vkontakte\\.ru)\\/(?:video_ext\\.php\\?)(.*)/i\n      )\n\n      if (youtube) {\n        return {\n          youtube: youtube\n        }\n      } else if (vimeo) {\n        return {\n          vimeo: vimeo\n        }\n      } else if (dailymotion) {\n        return {\n          dailymotion: dailymotion\n        }\n      } else if (vk) {\n        return {\n          vk: vk\n        }\n      }\n    }\n\n    const link = function (contents, uri) {\n      if (!uri) return contents\n      const a = myDocument.createElement('a')\n      a.setAttribute('href', uri)\n      a.appendChild(contents)\n      a.addEventListener('click', UI.widgets.openHrefInOutlineMode, true)\n      return a\n    }\n\n    const text = function (str) {\n      return myDocument.createTextNode(str)\n    }\n\n    const kb = context.session.store\n    const obj = kb.any(\n      subject,\n      $rdf.sym('http://purl.org/ontology/pbo/core#playlist_item')\n    )\n    let index = kb.any(\n      subject,\n      $rdf.sym('http://purl.org/ontology/olo/core#index')\n    )\n\n    let uri = obj.uri\n    const video = isVideo(uri)\n\n    const div = myDocument.createElement('div')\n    let img\n    if (video && video.youtube) {\n      uri = uri.replace('watch?v=', 'embed/')\n      div.setAttribute('class', 'imageView')\n      img = myDocument.createElement('IFRAME')\n      img.setAttribute('src', uri)\n      img.setAttribute('width', 560)\n      img.setAttribute('height', 315)\n      img.setAttribute('frameborder', 0)\n      img.setAttribute('style', 'max-width: 850px; max-height: 100%;')\n      img.setAttribute('allowfullscreen', 'true')\n    } else {\n      div.setAttribute('class', 'imageView')\n      img = myDocument.createElement('IMG')\n      img.setAttribute('src', obj.value)\n      img.setAttribute('width', 560)\n      img.setAttribute('height', 315)\n      img.setAttribute('style', 'max-width: 560; max-height: 315;')\n    }\n\n    if (index) {\n      const sl = kb.statementsMatching(\n        null,\n        $rdf.sym('http://purl.org/ontology/olo/core#index')\n      )\n      const slots = []\n      for (let i = 0; i < sl.length; i++) {\n        if (sl[i]) {\n          slots.push(parseInt(sl[i].object.value, 10))\n        }\n      }\n\n      index = parseInt(index.value, 10)\n      var descDiv = myDocument.createElement('div')\n\n      const pIndex =\n        slots[(slots.indexOf(index) - 1 + slots.length) % slots.length]\n      const nIndex =\n        slots[(slots.indexOf(index) + 1 + slots.length) % slots.length]\n\n      const prev = link(text('<<'), subject.uri.split('#')[0] + '#' + pIndex)\n\n      descDiv.appendChild(prev)\n\n      const indexDiv = myDocument.createElement('span')\n      indexDiv.innerHTML = ' Playlist slot : ' + index + ' '\n\n      descDiv.appendChild(indexDiv)\n\n      const next = link(text('>>'), subject.uri.split('#')[0] + '#' + nIndex)\n      descDiv.appendChild(next)\n    }\n\n    const tr = myDocument.createElement('TR') // why need tr?\n    tr.appendChild(img)\n    if (descDiv) {\n      tr.appendChild(descDiv)\n    }\n    div.appendChild(tr)\n    return div\n  }\n}\n\n// ends\n"],"file":"playlistPane.js"}