{"version":3,"sources":["../../src/chat/messageTools.js"],"names":["UI","authn","require","icons","ns","media","pad","rdf","store","solidLogicSingleton","style","utils","widgets","bookmarks","dom","window","document","kb","THUMBS_UP_ICON","THUMBS_DOWN_ICON","updatePromise","del","ins","Promise","resolve","reject","updater","update","uri","ok","errorBody","Error","emoji","schema","sentimentStrip","target","doc","actions","each","sentiments","map","a","any","sort","strings","x","createTextNode","join","sentimentStripLinked","strip","createElement","refresh","innerHTML","forEach","ss","theClass","agent","res","setAttribute","textContent","appendChild","messageToolbar","message","messageRow","userContext","div","closeToolbar","parentElement","removeChild","deleteThingThen","connectedStatements","me","currentUser","holds","foaf","deleteButton","deleteButtonWithCheck","renderBookmarksButton","then","bookmarkButton","sentimentButton","context","icon","actionClass","mutuallyExclusive","setColor","button","backgroundColor","action","label","_event","newThing","insertMe","$rdf","st","dirty","i","length","existingAction","refreshTree","filter","context1","iconBase","cancelButton","firstChild","opacity","addEventListener"],"mappings":";;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AAEA,IAAMA,EAAE,GAAG;AACTC,EAAAA,KAAK,EAAEC,OAAO,CAAC,gBAAD,CADL;AAETC,EAAAA,KAAK,EAAED,OAAO,CAAC,aAAD,CAFL;AAGTE,EAAAA,EAAE,EAAEF,OAAO,CAAC,OAAD,CAHF;AAITG,EAAAA,KAAK,EAAEH,OAAO,CAAC,wBAAD,CAJL;AAKTI,EAAAA,GAAG,EAAEJ,OAAO,CAAC,QAAD,CALH;AAMTK,EAAAA,GAAG,EAAEL,OAAO,CAAC,QAAD,CANH;AAOTM,EAAAA,KAAK,EAAEN,OAAO,CAAC,UAAD,CAAP,CAAoBO,mBAApB,CAAwCD,KAPtC;AAQTE,EAAAA,KAAK,EAAER,OAAO,CAAC,UAAD,CARL;AASTS,EAAAA,KAAK,EAAET,OAAO,CAAC,UAAD,CATL;AAUTU,EAAAA,OAAO,EAAEV,OAAO,CAAC,YAAD;AAVP,CAAX;;AAaA,IAAMW,SAAS,GAAGX,OAAO,CAAC,aAAD,CAAzB;;AAEA,IAAMY,GAAG,GAAGC,MAAM,CAACC,QAAnB;AAEA,IAAMC,EAAE,GAAGjB,EAAE,CAACQ,KAAd;AACA,IAAMJ,EAAE,GAAGJ,EAAE,CAACI,EAAd,C,CACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAMc,cAAc,GAAG,kBAAvB;AACA,IAAMC,gBAAgB,GAAG,kBAAzB,C,CAEA;AAEA;;AACA,SAASC,aAAT,CAAwBC,GAAxB,EAA6BC,GAA7B,EAAkC;AAChC,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,MAAnB,EAA2B;AAC5CR,IAAAA,EAAE,CAACS,OAAH,CAAWC,MAAX,CAAkBN,GAAlB,EAAuBC,GAAvB,EAA4B,UAAUM,GAAV,EAAeC,EAAf,EAAmBC,SAAnB,EAA8B;AACxD,UAAI,CAACD,EAAL,EAAS;AACPJ,QAAAA,MAAM,CAAC,IAAIM,KAAJ,CAAUD,SAAV,CAAD,CAAN;AACD,OAFD,MAEO;AACLN,QAAAA,OAAO;AACR;AACF,KAND,EAD4C,CAOzC;AACJ,GARM,CAAP,CADgC,CAS7B;AACJ;AAED;AACA;AACA;;;AAEA,IAAMQ,KAAK,GAAG,EAAd;AACAA,KAAK,CAAC5B,EAAE,CAAC6B,MAAH,CAAU,aAAV,CAAD,CAAL,GAAkC,IAAlC;AACAD,KAAK,CAAC5B,EAAE,CAAC6B,MAAH,CAAU,gBAAV,CAAD,CAAL,GAAqC,IAArC;AACAD,KAAK,CAAC5B,EAAE,CAAC6B,MAAH,CAAU,eAAV,CAAD,CAAL,GAAoC,IAApC;AACAD,KAAK,CAAC5B,EAAE,CAAC6B,MAAH,CAAU,YAAV,CAAD,CAAL,GAAiC,IAAjC;AAEA;AACA;AACA;;AACO,SAASC,cAAT,CAAyBC,MAAzB,EAAiCC,GAAjC,EAAsC;AAC3C,MAAMC,OAAO,GAAGpB,EAAE,CAACqB,IAAH,CAAQ,IAAR,EAAclC,EAAE,CAAC6B,MAAH,CAAU,QAAV,CAAd,EAAmCE,MAAnC,EAA2CC,GAA3C,CAAhB;AACA,MAAMG,UAAU,GAAGF,OAAO,CAACG,GAAR,CAAY,UAAAC,CAAC;AAAA,WAAIxB,EAAE,CAACyB,GAAH,CAAOD,CAAP,EAAUrC,EAAE,CAACG,GAAH,CAAO,MAAP,CAAV,EAA0B,IAA1B,EAAgC6B,GAAhC,CAAJ;AAAA,GAAb,CAAnB;AACAG,EAAAA,UAAU,CAACI,IAAX;AACA,MAAMC,OAAO,GAAGL,UAAU,CAACC,GAAX,CAAe,UAAAK,CAAC;AAAA,WAAIb,KAAK,CAACa,CAAD,CAAL,IAAY,EAAhB;AAAA,GAAhB,CAAhB;AACA,SAAO/B,GAAG,CAACgC,cAAJ,CAAmBF,OAAO,CAACG,IAAR,CAAa,GAAb,CAAnB,CAAP;AACD;AACD;AACA;AACA;AACA;AACA;AACA;;;AACO,SAASC,oBAAT,CAA+Bb,MAA/B,EAAuCC,GAAvC,EAA4C;AACjD,MAAMa,KAAK,GAAGnC,GAAG,CAACoC,aAAJ,CAAkB,MAAlB,CAAd;;AACA,WAASC,OAAT,GAAoB;AAClBF,IAAAA,KAAK,CAACG,SAAN,GAAkB,EAAlB;AACA,QAAMf,OAAO,GAAGpB,EAAE,CAACqB,IAAH,CAAQ,IAAR,EAAclC,EAAE,CAAC6B,MAAH,CAAU,QAAV,CAAd,EAAmCE,MAAnC,EAA2CC,GAA3C,CAAhB;AACA,QAAMG,UAAU,GAAGF,OAAO,CAACG,GAAR,CAAY,UAAAC,CAAC;AAAA,aAAI,CAClCxB,EAAE,CAACyB,GAAH,CAAOD,CAAP,EAAUrC,EAAE,CAACG,GAAH,CAAO,MAAP,CAAV,EAA0B,IAA1B,EAAgC6B,GAAhC,CADkC,EAElCnB,EAAE,CAACyB,GAAH,CAAOD,CAAP,EAAUrC,EAAE,CAAC6B,MAAH,CAAU,OAAV,CAAV,EAA8B,IAA9B,EAAoCG,GAApC,CAFkC,CAAJ;AAAA,KAAb,CAAnB;AAIAG,IAAAA,UAAU,CAACI,IAAX;AACAJ,IAAAA,UAAU,CAACc,OAAX,CAAmB,UAAAC,EAAE,EAAI;AAAA,gDACGA,EADH;AAAA,UAChBC,QADgB;AAAA,UACNC,KADM;;AAEvB,UAAIC,GAAJ;;AACA,UAAID,KAAJ,EAAW;AACTC,QAAAA,GAAG,GAAG3C,GAAG,CAACoC,aAAJ,CAAkB,GAAlB,CAAN;AACAO,QAAAA,GAAG,CAACC,YAAJ,CAAiB,MAAjB,EAAyBF,KAAK,CAAC5B,GAA/B;AACD,OAHD,MAGO;AACL6B,QAAAA,GAAG,GAAG3C,GAAG,CAACgC,cAAJ,CAAmB,EAAnB,CAAN;AACD;;AACDW,MAAAA,GAAG,CAACE,WAAJ,GAAkB3B,KAAK,CAACuB,QAAD,CAAL,IAAmB,GAArC;AACAN,MAAAA,KAAK,CAACW,WAAN,CAAkBH,GAAlB;AACD,KAXD;AAYD;;AACDN,EAAAA,OAAO;AACPF,EAAAA,KAAK,CAACE,OAAN,GAAgBA,OAAhB;AACA,SAAOF,KAAP;AACD;AAED;AACA;AACA;;;AACO,SAASY,cAAT,CAAyBC,OAAzB,EAAkCC,UAAlC,EAA8CC,WAA9C,EAA2D;AAChE,MAAMC,GAAG,GAAGnD,GAAG,CAACoC,aAAJ,CAAkB,KAAlB,CAAZ;;AACA,WAASgB,YAAT,GAAyB;AACvBD,IAAAA,GAAG,CAACE,aAAJ,CAAkBA,aAAlB,CAAgCC,WAAhC,CAA4CH,GAAG,CAACE,aAAhD,EADuB,CACwC;AAChE;;AAJ+D,WAMjDE,eANiD;AAAA;AAAA,IAUhE;;;AAVgE;AAAA,qGAMhE,kBAAgCxB,CAAhC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQzB,aAAa,CAACH,EAAE,CAACqD,mBAAH,CAAuBzB,CAAvB,CAAD,EAA4B,EAA5B,CADrB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KANgE;AAAA;AAAA;;AAWhE,MAAI0B,EAAE,GAAGvE,EAAE,CAACC,KAAH,CAASuE,WAAT,EAAT,CAXgE,CAWhC;;AAChC,MAAID,EAAE,IAAItD,EAAE,CAACwD,KAAH,CAASX,OAAT,EAAkB1D,EAAE,CAACsE,IAAH,CAAQ,OAAR,CAAlB,EAAoCH,EAApC,CAAV,EAAmD;AACjD;AACA,QAAMI,YAAY,GAAG3E,EAAE,CAACY,OAAH,CAAWgE,qBAAX,CACnB9D,GADmB,EAEnBmD,GAFmB,EAGnB,SAHmB,6FAInB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACQhD,EAAE,CAACS,OAAH,CAAWC,MAAX,CAAkBV,EAAE,CAACqD,mBAAH,CAAuBR,OAAvB,CAAlB,EAAmD,EAAnD,CADR;;AAAA;AAEEI,cAAAA,YAAY;;AAFd;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAJmB,GAArB;AASAD,IAAAA,GAAG,CAACL,WAAJ,CAAgBe,YAAhB;AACD,GAxB+D,CAwB9D;AAEF;;AACA;AACF;AACA;AACA;AACA;AACA;AACE;;;AAEA9D,EAAAA,SAAS,CAACgE,qBAAV,CAAgCb,WAAhC,EAA6Cc,IAA7C,CAAkD,UAAAC,cAAc,EAAI;AAClE,QAAIA,cAAJ,EAAoBd,GAAG,CAACL,WAAJ,CAAgBmB,cAAhB;AACrB,GAFD;AAIA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACE,WAASC,eAAT,CACEC,OADF,EAEE9C,MAFF,EAGE+C,IAHF,EAIEC,WAJF,EAKE/C,GALF,EAMEgD,iBANF,EAOE;AACA,aAASC,QAAT,GAAqB;AACnBC,MAAAA,MAAM,CAAC5E,KAAP,CAAa6E,eAAb,GAA+BC,MAAM,GAAG,QAAH,GAAc,OAAnD;AACD;;AACD,QAAIF,MAAM,GAAGtF,EAAE,CAACY,OAAH,CAAW0E,MAAX,CACXxE,GADW,EAEXoE,IAFW,EAGXlF,EAAE,CAACW,KAAH,CAAS8E,KAAT,CAAeN,WAAf,CAHW;AAAA,gGAIX,kBAAgBO,MAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBACMF,MADN;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAEUnB,eAAe,CAACmB,MAAD,CAFzB;;AAAA;AAGIA,gBAAAA,MAAM,GAAG,IAAT;AACAH,gBAAAA,QAAQ;AAJZ;AAAA;;AAAA;AAMI;AACAG,gBAAAA,MAAM,GAAGxF,EAAE,CAACY,OAAH,CAAW+E,QAAX,CAAoBvD,GAApB,CAAT;AACMwD,gBAAAA,QARV,GAQqB,CACfC,IAAI,CAACC,EAAL,CAAQN,MAAR,EAAgBpF,EAAE,CAAC6B,MAAH,CAAU,OAAV,CAAhB,EAAoCgD,OAAO,CAACV,EAA5C,EAAgDnC,GAAhD,CADe,EAEfyD,IAAI,CAACC,EAAL,CAAQN,MAAR,EAAgBpF,EAAE,CAACG,GAAH,CAAO,MAAP,CAAhB,EAAgC4E,WAAhC,EAA6C/C,GAA7C,CAFe,EAGfyD,IAAI,CAACC,EAAL,CAAQN,MAAR,EAAgBpF,EAAE,CAAC6B,MAAH,CAAU,QAAV,CAAhB,EAAqCE,MAArC,EAA6CC,GAA7C,CAHe,CARrB;AAAA;AAAA,uBAaUhB,aAAa,CAAC,EAAD,EAAKwE,QAAL,CAbvB;;AAAA;AAcIP,gBAAAA,QAAQ;;AAdZ,qBAgBQD,iBAhBR;AAAA;AAAA;AAAA;;AAiBM;AACIW,gBAAAA,KAlBV,GAkBkB,KAlBlB;AAmBeC,gBAAAA,CAnBf,GAmBmB,CAnBnB;;AAAA;AAAA,sBAmBsBA,CAAC,GAAGZ,iBAAiB,CAACa,MAnB5C;AAAA;AAAA;AAAA;;AAoBcxD,gBAAAA,CApBd,GAoBkByD,cAAc,CAACd,iBAAiB,CAACY,CAAD,CAAlB,CApBhC;;AAAA,qBAqBYvD,CArBZ;AAAA;AAAA;AAAA;;AAAA;AAAA,uBAsBgB4B,eAAe,CAAC5B,CAAD,CAtB/B;;AAAA;AAsBmC;AACzBsD,gBAAAA,KAAK,GAAG,IAAR;;AAvBV;AAmBoDC,gBAAAA,CAAC,EAnBrD;AAAA;AAAA;;AAAA;AA0BM,oBAAID,KAAJ,EAAW;AACT;AACA/F,kBAAAA,EAAE,CAACY,OAAH,CAAWuF,WAAX,CAAuBpC,UAAvB,EAFS,CAE0B;AACpC;;AA7BP;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAJW;;AAAA;AAAA;AAAA;AAAA,QAAb;;AAsCA,aAASmC,cAAT,CAAyBf,WAAzB,EAAsC;AACpC,UAAM9C,OAAO,GAAGpB,EAAE,CACfqB,IADa,CACR,IADQ,EACFlC,EAAE,CAAC6B,MAAH,CAAU,OAAV,CADE,EACkBgD,OAAO,CAACV,EAD1B,EAC8BnC,GAD9B,EAEbgE,MAFa,CAEN,UAAAvD,CAAC;AAAA,eAAI5B,EAAE,CAACwD,KAAH,CAAS5B,CAAT,EAAYzC,EAAE,CAACG,GAAH,CAAO,MAAP,CAAZ,EAA4B4E,WAA5B,EAAyC/C,GAAzC,CAAJ;AAAA,OAFK,EAGbgE,MAHa,CAGN,UAAAvD,CAAC;AAAA,eAAI5B,EAAE,CAACwD,KAAH,CAAS5B,CAAT,EAAYzC,EAAE,CAAC6B,MAAH,CAAU,QAAV,CAAZ,EAAiCE,MAAjC,EAAyCC,GAAzC,CAAJ;AAAA,OAHK,CAAhB;AAIA,aAAOC,OAAO,CAAC4D,MAAR,GAAiB5D,OAAO,CAAC,CAAD,CAAxB,GAA8B,IAArC;AACD;;AACD,aAASc,OAAT,GAAoB;AAClBqC,MAAAA,MAAM,GAAGU,cAAc,CAACf,WAAD,CAAvB;AACAE,MAAAA,QAAQ;AACT;;AACD,QAAIG,MAAJ;AACAF,IAAAA,MAAM,CAACnC,OAAP,GAAiBA,OAAjB,CAtDA,CAsDyB;;AACzBA,IAAAA,OAAO;AACP,WAAOmC,MAAP;AACD,GAhH+D,CAkHhE;AACA;;;AACAf,EAAAA,EAAE,GAAGvE,EAAE,CAACC,KAAH,CAASuE,WAAT,EAAL,CApHgE,CAoHpC;;AAC5B,MAAID,EAAJ,EAAQ;AACN;AACA,QAAM8B,QAAQ,GAAG;AAAE9B,MAAAA,EAAE,EAAFA,EAAF;AAAMzD,MAAAA,GAAG,EAAHA,GAAN;AAAWmD,MAAAA,GAAG,EAAHA;AAAX,KAAjB;AACAA,IAAAA,GAAG,CAACL,WAAJ,CACEoB,eAAe,CACbqB,QADa,EAEbvC,OAFa,EAEJ;AACT9D,IAAAA,EAAE,CAACG,KAAH,CAASmG,QAAT,GAAoBpF,cAHP,EAIbd,EAAE,CAAC6B,MAAH,CAAU,aAAV,CAJa,EAKb6B,OAAO,CAAC1B,GAAR,EALa,EAMb,CAAChC,EAAE,CAAC6B,MAAH,CAAU,gBAAV,CAAD,CANa,CADjB,EAHM,CAaN;;AACAgC,IAAAA,GAAG,CAACL,WAAJ,CACEoB,eAAe,CACbqB,QADa,EAEbvC,OAFa,EAGb9D,EAAE,CAACG,KAAH,CAASmG,QAAT,GAAoBnF,gBAHP,EAIbf,EAAE,CAAC6B,MAAH,CAAU,gBAAV,CAJa,EAKb6B,OAAO,CAAC1B,GAAR,EALa,EAMb,CAAChC,EAAE,CAAC6B,MAAH,CAAU,aAAV,CAAD,CANa,CADjB;AAUD,GA7I+D,CA8IhE;;;AACA,MAAMsE,YAAY,GAAGtC,GAAG,CAACL,WAAJ,CAAgB5D,EAAE,CAACY,OAAH,CAAW2F,YAAX,CAAwBzF,GAAxB,CAAhB,CAArB;AACAyF,EAAAA,YAAY,CAAC7F,KAAb,YAA2B,OAA3B;AACA6F,EAAAA,YAAY,CAACC,UAAb,CAAwB9F,KAAxB,CAA8B+F,OAA9B,GAAwC,KAAxC;AACAF,EAAAA,YAAY,CAACG,gBAAb,CAA8B,OAA9B,EAAuCxC,YAAvC;AACA,SAAOD,GAAP;AACD","sourcesContent":["/**\n * Tools for doing things with a message\n * Let us be creative here.  Allow all sorts of things to\n * be done to a message - linking to new or old objects in an open way\n *\n * Ideas: Bookmark, Like, star, pin at top of chat, reply as new thread,\n * If you made it originally: edit, delete, attach\n * @packageDocumentation\n */\n\n/* global $rdf */\n\nconst UI = {\n  authn: require('../authn/authn'),\n  icons: require('../iconBase'),\n  ns: require('../ns'),\n  media: require('../media/media-capture'),\n  pad: require('../pad'),\n  rdf: require('rdflib'),\n  store: require('../logic').solidLogicSingleton.store,\n  style: require('../style'),\n  utils: require('../utils'),\n  widgets: require('../widgets')\n}\n\nconst bookmarks = require('./bookmarks')\n\nconst dom = window.document\n\nconst kb = UI.store\nconst ns = UI.ns\n// const label = UI.utils.label\n\n// THE UNUSED ICONS are here as reminders for possible future functionality\n// const BOOKMARK_ICON = 'noun_45961.svg'\n// const HEART_ICON = 'noun_130259.svg' -> Add this to my (private) favorites\n// const MENU_ICON = 'noun_897914.svg'\n// const PAPERCLIP_ICON = 'noun_25830.svg' -> add attachments to this message\n// const PIN_ICON = 'noun_562340.svg'  -> pin this message permanently in the chat UI\n// const PENCIL_ICON = 'noun_253504.svg'\n// const SPANNER_ICON = 'noun_344563.svg' -> settings\nconst THUMBS_UP_ICON = 'noun_1384132.svg'\nconst THUMBS_DOWN_ICON = 'noun_1384135.svg'\n\n// module.export = { messageTools, sentimentStripLinked, sentimentStrip }\n\n// @@@@ use the one in rdflib.js when it is avaiable and delete this\nfunction updatePromise (del, ins) {\n  return new Promise(function (resolve, reject) {\n    kb.updater.update(del, ins, function (uri, ok, errorBody) {\n      if (!ok) {\n        reject(new Error(errorBody))\n      } else {\n        resolve()\n      }\n    }) // callback\n  }) // promise\n}\n\n/**\n * Emoji in Unicode\n */\n\nconst emoji = {}\nemoji[ns.schema('AgreeAction')] = '👍'\nemoji[ns.schema('DisagreeAction')] = '👎'\nemoji[ns.schema('EndorseAction')] = '⭐️'\nemoji[ns.schema('LikeAction')] = '❤️'\n\n/**\n * Create strip of sentiments expressed\n */\nexport function sentimentStrip (target, doc) {\n  const actions = kb.each(null, ns.schema('target'), target, doc)\n  const sentiments = actions.map(a => kb.any(a, ns.rdf('type'), null, doc))\n  sentiments.sort()\n  const strings = sentiments.map(x => emoji[x] || '')\n  return dom.createTextNode(strings.join(' '))\n}\n/**\n * Create strip of sentiments expressed, with hyperlinks\n *\n * @param target {NamedNode} - The thing about which they are expressed\n * @param doc {NamedNode} - The document in which they are expressed\n */\nexport function sentimentStripLinked (target, doc) {\n  const strip = dom.createElement('span')\n  function refresh () {\n    strip.innerHTML = ''\n    const actions = kb.each(null, ns.schema('target'), target, doc)\n    const sentiments = actions.map(a => [\n      kb.any(a, ns.rdf('type'), null, doc),\n      kb.any(a, ns.schema('agent'), null, doc)\n    ])\n    sentiments.sort()\n    sentiments.forEach(ss => {\n      const [theClass, agent] = ss\n      let res\n      if (agent) {\n        res = dom.createElement('a')\n        res.setAttribute('href', agent.uri)\n      } else {\n        res = dom.createTextNode('')\n      }\n      res.textContent = emoji[theClass] || '*'\n      strip.appendChild(res)\n    })\n  }\n  refresh()\n  strip.refresh = refresh\n  return strip\n}\n\n/**\n * Creates a message toolbar component\n */\nexport function messageToolbar (message, messageRow, userContext) {\n  const div = dom.createElement('div')\n  function closeToolbar () {\n    div.parentElement.parentElement.removeChild(div.parentElement) // remive the TR\n  }\n\n  async function deleteThingThen (x) {\n    await updatePromise(kb.connectedStatements(x), [])\n  }\n\n  // Things only the original author can do\n  let me = UI.authn.currentUser() // If already logged on\n  if (me && kb.holds(message, ns.foaf('maker'), me)) {\n    // button to delete the message\n    const deleteButton = UI.widgets.deleteButtonWithCheck(\n      dom,\n      div,\n      'message',\n      async function () {\n        await kb.updater.update(kb.connectedStatements[message], [])\n        closeToolbar()\n      }\n    )\n    div.appendChild(deleteButton)\n  } // if mine\n\n  // Things anyone can do if they have a bookmark list async\n  /*\n var bookmarkButton = await bookmarks.renderBookmarksButton(userContext)\n if (bookmarkButton) {\n   div.appendChild(bookmarkButton)\n }\n */\n  // Things anyone can do if they have a bookmark list\n\n  bookmarks.renderBookmarksButton(userContext).then(bookmarkButton => {\n    if (bookmarkButton) div.appendChild(bookmarkButton)\n  })\n\n  /**   Button to allow user to express a sentiment (like, endorse, etc) about a target\n   *\n   * @param context {Object} - Provide dom and me\n   * @param target {NamedNode} - The thing the user expresses an opnion about\n   * @param icon {uristring} - The icon to be used for the button\n   * @param actionClass {NamedNode} - The RDF class  - typically a subclass of schema:Action\n   * @param doc - {NamedNode} - the Solid document iunto which the data should be written\n   * @param mutuallyExclusive {Array<NamedNode>} - Any RDF classes of sentimentswhich are mutiually exclusive\n   */\n  function sentimentButton (\n    context,\n    target,\n    icon,\n    actionClass,\n    doc,\n    mutuallyExclusive\n  ) {\n    function setColor () {\n      button.style.backgroundColor = action ? 'yellow' : 'white'\n    }\n    var button = UI.widgets.button(\n      dom,\n      icon,\n      UI.utils.label(actionClass),\n      async function (_event) {\n        if (action) {\n          await deleteThingThen(action)\n          action = null\n          setColor()\n        } else {\n          // no action\n          action = UI.widgets.newThing(doc)\n          const insertMe = [\n            $rdf.st(action, ns.schema('agent'), context.me, doc),\n            $rdf.st(action, ns.rdf('type'), actionClass, doc),\n            $rdf.st(action, ns.schema('target'), target, doc)\n          ]\n          await updatePromise([], insertMe)\n          setColor()\n\n          if (mutuallyExclusive) {\n            // Delete incompative sentiments\n            let dirty = false\n            for (let i = 0; i < mutuallyExclusive.length; i++) {\n              const a = existingAction(mutuallyExclusive[i])\n              if (a) {\n                await deleteThingThen(a) // but how refresh? refreshTree the parent?\n                dirty = true\n              }\n            }\n            if (dirty) {\n              // UI.widgets.refreshTree(button.parentNode) // requires them all to be immediate siblings\n              UI.widgets.refreshTree(messageRow) // requires them all to be immediate siblings\n            }\n          }\n        }\n      }\n    )\n    function existingAction (actionClass) {\n      const actions = kb\n        .each(null, ns.schema('agent'), context.me, doc)\n        .filter(x => kb.holds(x, ns.rdf('type'), actionClass, doc))\n        .filter(x => kb.holds(x, ns.schema('target'), target, doc))\n      return actions.length ? actions[0] : null\n    }\n    function refresh () {\n      action = existingAction(actionClass)\n      setColor()\n    }\n    let action\n    button.refresh = refresh // If the file changes, refresh live\n    refresh()\n    return button\n  }\n\n  // THUMBS_UP_ICON\n  // https://schema.org/AgreeAction\n  me = UI.authn.currentUser() // If already logged on\n  if (me) {\n    // Things you mnust be logged in for\n    const context1 = { me, dom, div }\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message, // @@ TODO use UI.widgets.sentimentButton\n        UI.icons.iconBase + THUMBS_UP_ICON,\n        ns.schema('AgreeAction'),\n        message.doc(),\n        [ns.schema('DisagreeAction')]\n      )\n    )\n    // Thumbs down\n    div.appendChild(\n      sentimentButton(\n        context1,\n        message,\n        UI.icons.iconBase + THUMBS_DOWN_ICON,\n        ns.schema('DisagreeAction'),\n        message.doc(),\n        [ns.schema('AgreeAction')]\n      )\n    )\n  }\n  // X button to remove the tool UI itself\n  const cancelButton = div.appendChild(UI.widgets.cancelButton(dom))\n  cancelButton.style.float = 'right'\n  cancelButton.firstChild.style.opacity = '0.3'\n  cancelButton.addEventListener('click', closeToolbar)\n  return div\n}\n"],"file":"messageTools.js"}