{"version":3,"sources":["../../src/chat/bookmarks.js"],"names":["UI","authn","require","icons","ns","media","pad","rdf","store","solidLogicSingleton","style","utils","widgets","$rdf","BOOK","Namespace","BOOKMARK_ICON","kb","label","dom","window","document","createIfNotExists","doc","Promise","resolve","reject","fetcher","load","then","response","debug","log","err","status","webOperation","uri","data","contentType","requested","updatePromise","del","ins","updater","update","ok","errorBody","Error","findBookmarkDocument","userContext","theClass","fileTail","isPublic","findAppInstances","instances","length","bookmarkDocument","alert","publicProfile","newBookmarkFile","sym","dir","error","registerInTypeIndex","addBookmark","context","target","title","me","currentUser","author","any","foaf","anyValue","sioc","slice","bookmarkDoc","bookmark","newThing","st","dct","Date","msg","toggleBookmark","bookmarkButton","bookmarks","each","confirm","i","connectedStatements","backgroundColor","renderBookmarksButton","setBookmarkButtonColor","bookmarked","buttonStyle","button","iconBase"],"mappings":"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","sourcesContent":["/**\n * Functions related to chat and bookmarks\n * @packageDocumentation\n */\n\n/* global alert confirm */\n\nimport * as debug from '../debug'\n\nconst UI = {\n  authn: require('../authn/authn'),\n  icons: require('../iconBase'),\n  ns: require('../ns'),\n  media: require('../media/media-capture'),\n  pad: require('../pad'),\n  rdf: require('rdflib'),\n  store: require('../logic').solidLogicSingleton.store,\n  style: require('../style'),\n  utils: require('../utils'),\n  widgets: require('../widgets')\n}\nconst $rdf = UI.rdf\n\nconst BOOK = $rdf.Namespace('http://www.w3.org/2002/01/bookmark#')\nconst BOOKMARK_ICON = 'noun_45961.svg'\n\nconst kb = UI.store\nconst ns = UI.ns\nconst label = UI.utils.label\nconst dom = UI.dom || window.document\n\n/** Create a resource if it really does not exist\n *  Be absolutely sure something does not exist before creating a new empty file\n * as otherwise existing could  be deleted.\n * @param doc {NamedNode} - The resource\n */\nfunction createIfNotExists (doc) {\n  return new Promise(function (resolve, reject) {\n    kb.fetcher.load(doc).then(\n      response => {\n        debug.log('createIfNotExists doc exists, all good ' + doc)\n        // kb.fetcher.webOperation('HEAD', doc.uri).then(response => {\n        resolve(response)\n      },\n      err => {\n        if (err.response.status === 404) {\n          debug.log(\n            'createIfNotExists doc does NOT exist, will create... ' + doc\n          )\n\n          kb.fetcher\n            .webOperation('PUT', doc.uri, {\n              data: '',\n              contentType: 'text/turtle'\n            })\n            .then(\n              response => {\n                // fetcher.requested[doc.uri] = 'done' // do not need to read ??  but no headers\n                delete kb.fetcher.requested[doc.uri] // delete cached 404 error\n                debug.log('createIfNotExists doc created ok ' + doc)\n                resolve(response)\n              },\n              err => {\n                debug.log('createIfNotExists doc FAILED: ' + doc + ': ' + err)\n                reject(err)\n              }\n            )\n        } else {\n          debug.log(\n            'createIfNotExists doc load error NOT 404:  ' + doc + ': ' + err\n          )\n          reject(err)\n        }\n      }\n    )\n  })\n}\n\n// @@@@ use the one in rdflib.js when it is avaiable and delete this\nfunction updatePromise (del, ins) {\n  return new Promise(function (resolve, reject) {\n    kb.updater.update(del, ins, function (uri, ok, errorBody) {\n      if (!ok) {\n        reject(new Error(errorBody))\n      } else {\n        resolve()\n      }\n    }) // callback\n  }) // promise\n}\n\n// export findBookmarkDocument,\n\n/*         Bookmarking\n */\n/** Find a user's bookmarks\n */\nexport async function findBookmarkDocument (userContext) {\n  const theClass = BOOK('Bookmark')\n  const fileTail = 'bookmarks.ttl'\n  const isPublic = true\n\n  await UI.authn.findAppInstances(userContext, theClass, isPublic) // public -- only look for public links\n  if (userContext.instances && userContext.instances.length > 0) {\n    userContext.bookmarkDocument = userContext.instances[0]\n    if (userContext.instances.length > 1) {\n      alert('More than one bookmark file! ' + userContext.instances)\n    }\n  } else {\n    if (userContext.publicProfile) {\n      // publicProfile or preferencesFile\n      const newBookmarkFile = $rdf.sym(\n        userContext.publicProfile.dir().uri + fileTail\n      )\n      try {\n        debug.log('Creating new bookmark file ' + newBookmarkFile)\n        await createIfNotExists(newBookmarkFile)\n      } catch (e) {\n        alert.error(\"Can't make fresh bookmark file:\" + e)\n        return userContext\n      }\n      await UI.authn.registerInTypeIndex(\n        userContext,\n        newBookmarkFile,\n        theClass,\n        true\n      ) // public\n      userContext.bookmarkDocument = newBookmarkFile\n    } else {\n      alert('You seem to have no bookmark file and not even a profile file.')\n    }\n  }\n  return userContext\n}\n\n/** Add a bookmark\n */\n\nasync function addBookmark (context, target) {\n  /* like\n @prefix terms: <http://purl.org/dc/terms/>.\n @prefix bookm: <http://www.w3.org/2002/01/bookmark#>.\n @prefix n0: <http://xmlns.com/foaf/0.1/>.\n <> terms:references <#0.5534145389246576>.\n <#0.5534145389246576>\n   a bookm:Bookmark;\n   terms:created \"2019-01-26T20:26:44.374Z\"^^XML:dateTime;\n   terms:title \"Herons\";\n   bookm:recalls wiki:Heron;\n   n0:maker c:me.\n  */\n  let title = ''\n  const me = UI.authn.currentUser() // If already logged on\n  if (!me) throw new Error('Must be logged on to add Bookmark')\n\n  const author = kb.any(target, ns.foaf('maker'))\n  title =\n    label(author) + ': ' + kb.anyValue(target, ns.sioc('content')).slice(0, 80) // @@ add chat title too?\n  const bookmarkDoc = context.bookmarkDocument\n  const bookmark = UI.widgets.newThing(bookmarkDoc, title)\n  const ins = [\n    $rdf.st(bookmarkDoc, UI.ns.dct('references'), bookmark, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.rdf('type'), BOOK('Bookmark'), bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.dct('created'), new Date(), bookmarkDoc),\n    $rdf.st(bookmark, BOOK('recalls'), target, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.foaf('maker'), me, bookmarkDoc),\n    $rdf.st(bookmark, UI.ns.dct('title'), title, bookmarkDoc)\n  ]\n  try {\n    await updatePromise([], ins) // 20190118A\n  } catch (e) {\n    const msg = 'Making bookmark: ' + e\n    alert.error(msg)\n    return null\n  }\n  return bookmark\n}\n\nexport async function toggleBookmark (userContext, target, bookmarkButton) {\n  await kb.fetcher.load(userContext.bookmarkDocument)\n  const bookmarks = kb.each(\n    null,\n    BOOK('recalls'),\n    target,\n    userContext.bookmarkDocument\n  )\n  if (bookmarks.length) {\n    // delete\n    if (!confirm('Delete bookmark on this?' + bookmarks.length)) return\n    for (let i = 0; i < bookmarks.length; i++) {\n      try {\n        await updatePromise(kb.connectedStatements(bookmarks[i]), [])\n        bookmarkButton.style.backgroundColor = 'white'\n        debug.log('Bookmark deleted: ' + bookmarks[i])\n      } catch (e) {\n        debug.error('Cant delete bookmark:' + e)\n        alert('Cant delete bookmark:' + e)\n      }\n    }\n  } else {\n    const bookmark = await addBookmark(userContext, target)\n    bookmarkButton.style.backgroundColor = 'yellow'\n    debug.log('Bookmark added: ' + bookmark)\n  }\n}\n\nexport async function renderBookmarksButton (userContext, target) {\n  async function setBookmarkButtonColor (bookmarkButton) {\n    await kb.fetcher.load(userContext.bookmarkDocument)\n    const bookmarked = kb.any(\n      null,\n      BOOK('recalls'),\n      bookmarkButton.target,\n      userContext.bookmarkDocument\n    )\n    bookmarkButton.style = UI.style.buttonStyle\n    if (bookmarked) bookmarkButton.style.backgroundColor = 'yellow'\n  }\n\n  let bookmarkButton\n  if (userContext.bookmarkDocument) {\n    bookmarkButton = UI.widgets.button(\n      dom,\n      UI.icons.iconBase + BOOKMARK_ICON,\n      label(BOOK('Bookmark')),\n      () => {\n        toggleBookmark(userContext, target, bookmarkButton)\n      }\n    )\n    bookmarkButton.target = target\n    await setBookmarkButtonColor(bookmarkButton)\n    return bookmarkButton\n  }\n}\n"],"file":"bookmarks.js"}