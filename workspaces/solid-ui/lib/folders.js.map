{"version":3,"sources":["../src/folders.js"],"names":["UI","icons","require","ns","rdf","store","solidLogicSingleton","widgets","utils","deleteRecursive","kb","folder","Promise","resolve","_reject","fetcher","load","then","promises","each","ldp","map","file","holds","debug","log","confirm","Error","webOperation","uri","push","all","_res","forAllFiles","action","module","exports","deleteFolder","dom","docuent","document","div","createElement","table","appendChild","mainTR","p","textContent","buttonsTR","buttonsTD1","buttonsTD3","cancel","cancelButton","addEventListener","_event","parentNode","removeChild","doit","button","iconBase","deleteThem","count","msg"],"mappings":";;;;AAIA;;AAJA;AACA;AACA;;AACA;AAGA,IAAMA,EAAE,GAAG;AACTC,EAAAA,KAAK,EAAEC,OAAO,CAAC,YAAD,CADL;AAETC,EAAAA,EAAE,EAAED,OAAO,CAAC,MAAD,CAFF;AAGTE,EAAAA,GAAG,EAAEF,OAAO,CAAC,QAAD,CAHH;AAITG,EAAAA,KAAK,EAAEH,OAAO,CAAC,SAAD,CAAP,CAAmBI,mBAAnB,CAAuCD,KAJrC;AAKTE,EAAAA,OAAO,EAAEL,OAAO,CAAC,WAAD,CALP;AAMTM,EAAAA,KAAK,EAAEN,OAAO,CAAC,SAAD;AANL,CAAX;AASA,IAAMC,EAAE,GAAGH,EAAE,CAACG,EAAd;;AAEA,SAASM,eAAT,CAA0BC,EAA1B,EAA8BC,MAA9B,EAAsC;AACpC;AACA,SAAO,IAAIC,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,OAAnB,EAA4B;AAC7CJ,IAAAA,EAAE,CAACK,OAAH,CAAWC,IAAX,CAAgBL,MAAhB,EAAwBM,IAAxB,CAA6B,YAAY;AACvC,UAAMC,QAAQ,GAAGR,EAAE,CAACS,IAAH,CAAQR,MAAR,EAAgBR,EAAE,CAACiB,GAAH,CAAO,UAAP,CAAhB,EAAoCC,GAApC,CAAwC,UAAAC,IAAI,EAAI;AAC/D,YAAIZ,EAAE,CAACa,KAAH,CAASD,IAAT,EAAenB,EAAE,CAACC,GAAH,CAAO,MAAP,CAAf,EAA+BD,EAAE,CAACiB,GAAH,CAAO,gBAAP,CAA/B,CAAJ,EAA8D;AAC5D,iBAAOX,eAAe,CAACC,EAAD,EAAKY,IAAL,CAAtB;AACD,SAFD,MAEO;AACLE,UAAAA,KAAK,CAACC,GAAN,CAAU,2BAA2BH,IAArC;;AACA,cAAI,CAACI,OAAO,CAAC,yBAAyBJ,IAA1B,CAAZ,EAA6C;AAC3C,kBAAM,IAAIK,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACD,iBAAOjB,EAAE,CAACK,OAAH,CAAWa,YAAX,CAAwB,QAAxB,EAAkCN,IAAI,CAACO,GAAvC,CAAP;AACD;AACF,OAVgB,CAAjB;AAWAL,MAAAA,KAAK,CAACC,GAAN,CAAU,6BAA6Bd,MAAvC;;AACA,UAAI,CAACe,OAAO,CAAC,2BAA2Bf,MAA5B,CAAZ,EAAiD;AAC/C,cAAM,IAAIgB,KAAJ,CAAU,0BAAV,CAAN;AACD;;AACDT,MAAAA,QAAQ,CAACY,IAAT,CAAcpB,EAAE,CAACK,OAAH,CAAWa,YAAX,CAAwB,QAAxB,EAAkCjB,MAAM,CAACkB,GAAzC,CAAd;AACAjB,MAAAA,OAAO,CAACmB,GAAR,CAAYb,QAAZ,EAAsBD,IAAtB,CAA2B,UAAAe,IAAI,EAAI;AACjCnB,QAAAA,OAAO;AACR,OAFD;AAGD,KApBD;AAqBD,GAtBM,CAAP;AAuBD;AAED;AACA;AACA;AACA;AACA;AACA;;;AACA,SAASoB,WAAT,CAAsBtB,MAAtB,EAA8BD,EAA9B,EAAkCwB,MAAlC,EAA0C;AACxC;AACA,SAAO,IAAItB,OAAJ,CAAY,UAAUC,OAAV,EAAmBC,OAAnB,EAA4B;AAC7CJ,IAAAA,EAAE,CAACK,OAAH,CAAWC,IAAX,CAAgBL,MAAhB,EAAwBM,IAAxB,CAA6B,YAAY;AACvC,UAAMC,QAAQ,GAAGR,EAAE,CAACS,IAAH,CAAQR,MAAR,EAAgBR,EAAE,CAACiB,GAAH,CAAO,UAAP,CAAhB,EAAoCC,GAApC,CAAwC,UAAAC,IAAI,EAAI;AAC/D,YAAIZ,EAAE,CAACa,KAAH,CAASD,IAAT,EAAenB,EAAE,CAACC,GAAH,CAAO,MAAP,CAAf,EAA+BD,EAAE,CAACiB,GAAH,CAAO,gBAAP,CAA/B,CAAJ,EAA8D;AAC5D,iBAAOa,WAAW,CAACX,IAAD,EAAOZ,EAAP,EAAWwB,MAAX,CAAlB;AACD,SAFD,MAEO;AACL,iBAAOA,MAAM,CAACZ,IAAD,CAAb;AACD;AACF,OANgB,CAAjB;AAOAJ,MAAAA,QAAQ,CAACY,IAAT,CAAcI,MAAM,CAACvB,MAAD,CAApB;AACAC,MAAAA,OAAO,CAACmB,GAAR,CAAYb,QAAZ,EAAsBD,IAAtB,CAA2B,UAAAe,IAAI,EAAI;AACjCnB,QAAAA,OAAO;AACR,OAFD;AAGD,KAZD;AAaD,GAdM,CAAP;AAeD;;AAEDsB,MAAM,CAACC,OAAP,CAAe3B,eAAf,GAAiCA,eAAjC;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AACA;;AACA0B,MAAM,CAACC,OAAP,CAAeC,YAAf,GAA8B,UAAU1B,MAAV,EAAkBN,KAAlB,EAAyBiC,GAAzB,EAA8B;AAC1DjC,EAAAA,KAAK,GAAGA,KAAK,IAAIL,EAAE,CAACK,KAApB;;AACA,MAAI,OAAOkC,OAAP,KAAmB,WAAvB,EAAoC;AAClCD,IAAAA,GAAG,GAAGA,GAAG,IAAIE,QAAb;AACD;;AACD,MAAMC,GAAG,GAAGH,GAAG,CAACI,aAAJ,CAAkB,KAAlB,CAAZ;AACA,MAAMC,KAAK,GAAGF,GAAG,CAACG,WAAJ,CAAgBN,GAAG,CAACI,aAAJ,CAAkB,OAAlB,CAAhB,CAAd;AACA,MAAMG,MAAM,GAAGF,KAAK,CAACC,WAAN,CAAkBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAlB,CAAf;AACAG,EAAAA,MAAM,CAACD,WAAP,CAAmBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAnB,EAR0D,CAQd;;AAE5C,MAAMI,CAAC,GAAGD,MAAM,CAACD,WAAP,CAAmBN,GAAG,CAACI,aAAJ,CAAkB,GAAlB,CAAnB,CAAV;AACAI,EAAAA,CAAC,CAACC,WAAF,wDAA8DpC,MAA9D;AACA,MAAMqC,SAAS,GAAGL,KAAK,CAACC,WAAN,CAAkBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAlB,CAAlB;AACA,MAAMO,UAAU,GAAGD,SAAS,CAACJ,WAAV,CAAsBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAtB,CAAnB;AACAM,EAAAA,SAAS,CAACJ,WAAV,CAAsBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAtB,EAd0D,CAcX;;AAC/C,MAAMQ,UAAU,GAAGF,SAAS,CAACJ,WAAV,CAAsBN,GAAG,CAACI,aAAJ,CAAkB,IAAlB,CAAtB,CAAnB;AAEA,MAAMS,MAAM,GAAGF,UAAU,CAACL,WAAX,CAAuB5C,EAAE,CAACO,OAAH,CAAW6C,YAAX,CAAwBd,GAAxB,CAAvB,CAAf;AACAa,EAAAA,MAAM,CAACE,gBAAP,CACE,OADF,EAEE,UAAUC,MAAV,EAAkB;AAChBb,IAAAA,GAAG,CAACc,UAAJ,CAAeC,WAAf,CAA2Bf,GAA3B;AACD,GAJH,EAKE,KALF;AAQA,MAAMgB,IAAI,GAAGP,UAAU,CAACN,WAAX,CACX5C,EAAE,CAACO,OAAH,CAAWmD,MAAX,CAAkBpB,GAAlB,EAAuBtC,EAAE,CAACC,KAAH,CAAS0D,QAAT,GAAoB,iBAA3C,EAA8D,aAA9D,CADW,CAAb;AAGAF,EAAAA,IAAI,CAACJ,gBAAL,CACE,OADF,EAEE,UAAUC,MAAV,EAAkB;AAChBM,IAAAA,UAAU,CAACjD,MAAD,CAAV,CAAmBM,IAAnB,CAAwB,YAAM;AAC5BO,MAAAA,KAAK,CAACC,GAAN,CAAU,cAAV;AACD,KAFD;AAGD,GANH,EAOE,KAPF;;AAUA,WAASmC,UAAT,CAAqBjD,MAArB,EAA6B;AAC3B,WAAOsB,WAAW,CAACtB,MAAD,EAAS,UAAAW,IAAI;AAAA,aAC7BjB,KAAK,CAACU,OAAN,CAAca,YAAd,CAA2B,QAA3B,EAAqCN,IAAI,CAACO,GAA1C,CAD6B;AAAA,KAAb,CAAlB;AAGD;;AACD,MAAIgC,KAAK,GAAG,CAAZ;AACA5B,EAAAA,WAAW,CAACtB,MAAD,EAASN,KAAT,EAAgB,YAAM;AAC/BwD,IAAAA,KAAK,IAAI,CAAT;AACD,GAFU,CAAX,CAEG;AAFH,GAGG5C,IAHH,CAGQ,YAAM;AACV,QAAM6C,GAAG,GAAG,uBAAuBD,KAAnC;AACArC,IAAAA,KAAK,CAACC,GAAN,CAAUqC,GAAV;AACAhB,IAAAA,CAAC,CAACC,WAAF,IAAiBe,GAAjB;AACD,GAPH;AASA,SAAOrB,GAAP;AACD,CAvDD","sourcesContent":["/**      UI To Delete Folder and content\n *\n */\n/* global confirm */\nimport * as debug from './debug'\n\nconst UI = {\n  icons: require('./iconBase'),\n  ns: require('./ns'),\n  rdf: require('rdflib'),\n  store: require('./logic').solidLogicSingleton.store,\n  widgets: require('./widgets'),\n  utils: require('./utils')\n}\n\nconst ns = UI.ns\n\nfunction deleteRecursive (kb, folder) {\n  // eslint-disable-next-line promise/param-names\n  return new Promise(function (resolve, _reject) {\n    kb.fetcher.load(folder).then(function () {\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\n          return deleteRecursive(kb, file)\n        } else {\n          debug.log('deleteRecirsive file: ' + file)\n          if (!confirm(' Really DELETE File ' + file)) {\n            throw new Error('User aborted delete file')\n          }\n          return kb.fetcher.webOperation('DELETE', file.uri)\n        }\n      })\n      debug.log('deleteRecirsive folder: ' + folder)\n      if (!confirm(' Really DELETE folder ' + folder)) {\n        throw new Error('User aborted delete file')\n      }\n      promises.push(kb.fetcher.webOperation('DELETE', folder.uri))\n      Promise.all(promises).then(_res => {\n        resolve()\n      })\n    })\n  })\n}\n\n/** Iterate over files depth first\n *\n * @param folder - The folder whose contents we iterate over\n * @param store - The quadstore\n * @param action - returns a promise.  All the promises must be resolved\n */\nfunction forAllFiles (folder, kb, action) {\n  // eslint-disable-next-line promise/param-names\n  return new Promise(function (resolve, _reject) {\n    kb.fetcher.load(folder).then(function () {\n      const promises = kb.each(folder, ns.ldp('contains')).map(file => {\n        if (kb.holds(file, ns.rdf('type'), ns.ldp('BasicContainer'))) {\n          return forAllFiles(file, kb, action)\n        } else {\n          return action(file)\n        }\n      })\n      promises.push(action(folder))\n      Promise.all(promises).then(_res => {\n        resolve()\n      })\n    })\n  })\n}\n\nmodule.exports.deleteRecursive = deleteRecursive\n\n/** Delete Folder and contents\n *\n * @param {NamedNode} folder - The LDP container to be deleted\n * @param {DOMElement} containingElement - Where to put the user interface\n * @param {IndexedForumula} store - Quadstore (optional)\n * @param {Document} dom - The browser 'document' gloabl or equivalent (or iuse global)\n * @returns {DOMElement} - The control which has eben inserted in the\n */\n/* global document */\nmodule.exports.deleteFolder = function (folder, store, dom) {\n  store = store || UI.store\n  if (typeof docuent !== 'undefined') {\n    dom = dom || document\n  }\n  const div = dom.createElement('div')\n  const table = div.appendChild(dom.createElement('table'))\n  const mainTR = table.appendChild(dom.createElement('tr'))\n  mainTR.appendChild(dom.createElement('td')) // mainTD\n\n  const p = mainTR.appendChild(dom.createElement('p'))\n  p.textContent = `Are you sure you want to delete the folder ${folder}? This cannot be undone.`\n  const buttonsTR = table.appendChild(dom.createElement('tr'))\n  const buttonsTD1 = buttonsTR.appendChild(dom.createElement('td'))\n  buttonsTR.appendChild(dom.createElement('td')) // buttonsTD2\n  const buttonsTD3 = buttonsTR.appendChild(dom.createElement('td'))\n\n  const cancel = buttonsTD1.appendChild(UI.widgets.cancelButton(dom))\n  cancel.addEventListener(\n    'click',\n    function (_event) {\n      div.parentNode.removeChild(div)\n    },\n    false\n  )\n\n  const doit = buttonsTD3.appendChild(\n    UI.widgets.button(dom, UI.icons.iconBase + 'noun_925021.svg', 'Yes, delete')\n  )\n  doit.addEventListener(\n    'click',\n    function (_event) {\n      deleteThem(folder).then(() => {\n        debug.log('All deleted.')\n      })\n    },\n    false\n  )\n\n  function deleteThem (folder) {\n    return forAllFiles(folder, file =>\n      store.fetcher.webOperation('DELETE', file.uri)\n    )\n  }\n  let count = 0\n  forAllFiles(folder, store, () => {\n    count += 1\n  }) // Count files\n    .then(() => {\n      const msg = ' Files to delete: ' + count\n      debug.log(msg)\n      p.textContent += msg\n    })\n\n  return div\n}\n"],"file":"folders.js"}