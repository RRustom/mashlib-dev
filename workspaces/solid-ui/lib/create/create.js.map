{"version":3,"sources":["../../src/create/create.ts"],"names":["kb","solidLogicSingleton","store","newThingUI","createContext","dataBrowserContext","thePanes","dom","div","me","uri","Error","iconStyle","star","appendChild","createElement","visible","setAttribute","icons","iconBase","complain","message","pre","createTextNode","styleTheIcons","style","i","iconArray","length","st","disabled","selectTool","icon","selectNewTool","_event","addEventListener","makeNewAppInstance","options","Promise","resolve","reject","selectUI","callbackWS","ws","newBase","then","_context","newPaneOptions","Object","assign","folder","undefined","workspace","opt","debug","log","pane","name","mintNew","newInstance","tail","slice","isPackage","includes","add","ns","ldp","sym","doc","refreshTarget","refresh","p","innerHTML","noun","err","pa","mintClass","utils","label","appPathSegment","toUpperCase","gotName","endsWith","encodeURIComponent","widgets","askName","foaf","mintingPanes","values","filter","mintingClassMap","reduce","classMap","forEach","push","e","event","iconEle","noIndexHTML"],"mappings":"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","sourcesContent":["/*   create.js     UI to craete new objects in the solid-app-set world\n **\n */\n// const error = require('./widgets/error')\n// const widgets = require('./widgets/index')\n// const utils = require('./utils')\n\n// const UI = require('solid-ui')\n\nimport * as debug from '../debug'\n\nimport icons from '../iconBase'\nimport utils from '../utils'\nimport widgets from '../widgets'\nimport { solidLogicSingleton } from '../logic'\nimport ns from '../ns'\nimport { logInLoadProfile, selectWorkspace } from '../authn/authn'\nimport { DataBrowserContext, NewPaneOptions, PaneDefinition } from 'pane-registry'\nimport { CreateContext, NewAppInstanceOptions } from './types'\n\nconst kb = solidLogicSingleton.store\n\n/*  newThingUI -- return UI for user to select a new object, folder, etc\n **\n ** context must include:  dom, div,\n **     optional:   folder: NamedNode -- the folder where the thing is bring put\n **                (suppresses asking for a full URI or workspace)\n **\n */\nexport function newThingUI (\n  createContext: CreateContext,\n  dataBrowserContext: DataBrowserContext,\n  thePanes: Array<PaneDefinition>\n): void {\n  const dom = createContext.dom\n  const div = createContext.div\n  if (createContext.me && !createContext.me.uri) {\n    throw new Error('newThingUI:  Invalid userid: ' + createContext.me)\n  }\n\n  const iconStyle = 'padding: 0.7em; width: 2em; height: 2em;' // was: 'padding: 1em; width: 3em; height: 3em;'\n  const star = div.appendChild(dom.createElement('img'))\n  let visible = false // the inividual tools tools\n  //   noun_272948.svg = black star\n  // noun_34653_green.svg = green plus\n  star.setAttribute('src', icons.iconBase + 'noun_34653_green.svg')\n  star.setAttribute('style', iconStyle)\n  star.setAttribute('title', 'Add another tool')\n\n  const complain = function complain (message) {\n    const pre = div.appendChild(dom.createElement('pre'))\n    pre.setAttribute('style', 'background-color: pink')\n    pre.appendChild(dom.createTextNode(message))\n  }\n\n  function styleTheIcons (style) {\n    for (let i = 0; i < iconArray.length; i++) {\n      let st = iconStyle + style\n      if (iconArray[i].disabled) {\n        // @@ unused\n        st += 'opacity: 0.3;'\n      }\n      iconArray[i].setAttribute('style', st) // eg 'background-color: #ccc;'\n    }\n  }\n\n  function selectTool (icon) {\n    styleTheIcons('display: none;') // 'background-color: #ccc;'\n    icon.setAttribute('style', iconStyle + 'background-color: yellow;')\n  }\n\n  function selectNewTool (_event?) {\n    visible = !visible\n    star.setAttribute(\n      'style',\n      iconStyle + (visible ? 'background-color: yellow;' : '')\n    )\n    styleTheIcons(visible ? '' : 'display: none;')\n  }\n\n  star.addEventListener('click', selectNewTool)\n\n  function makeNewAppInstance (options: NewAppInstanceOptions) {\n    return new Promise(function (resolve, reject) {\n      let selectUI // , selectUIParent\n      function callbackWS (ws, newBase) {\n        logInLoadProfile(createContext).then(\n          _context => {\n            const newPaneOptions: NewPaneOptions = Object.assign({\n              newBase: newBase,\n              folder: options.folder || undefined,\n              workspace: ws\n            }, options)\n            for (const opt in options) {\n              // get div, dom, me, folder, pane, refreshTable\n              newPaneOptions[opt] = options[opt]\n            }\n            debug.log(`newThingUI: Minting new ${newPaneOptions.pane.name} at ${newPaneOptions.newBase}`)\n            options.pane\n              .mintNew!(dataBrowserContext, newPaneOptions)\n              .then(function (newPaneOptions) {\n                if (!newPaneOptions || !newPaneOptions.newInstance) {\n                  throw new Error('Cannot mint new - missing newInstance')\n                }\n                if (newPaneOptions.folder) {\n                  const tail = newPaneOptions.newInstance.uri.slice(\n                    newPaneOptions.folder.uri.length\n                  )\n                  const isPackage = tail.includes('/')\n                  debug.log('  new thing is packge? ' + isPackage)\n                  if (isPackage) {\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      kb.sym(newPaneOptions.newBase),\n                      newPaneOptions.folder.doc()\n                    )\n                  } else {\n                    // single file\n                    kb.add(\n                      newPaneOptions.folder,\n                      ns.ldp('contains'),\n                      newPaneOptions.newInstance,\n                      newPaneOptions.folder.doc()\n                    ) // Ping the patch system?\n                  }\n                  // @ts-ignore @@ TODO check whether refresh can exist here. Either fix type or remove unreachable code\n                  if (newPaneOptions.refreshTarget && newPaneOptions.refreshTarget.refresh) {\n                    // @@ TODO Remove the need to cast as any\n                    ;(newPaneOptions.refreshTarget as any).refresh() // Refresh the containing display\n                  }\n                  // selectUI.parentNode.removeChild(selectUI) It removes itself\n                } else {\n                  const p = options.div.appendChild(dom.createElement('p'))\n                  p.setAttribute('style', 'font-size: 120%;')\n                  // Make link to new thing\n                  p.innerHTML =\n                    \"Your <a target='_blank' href='\" +\n                    newPaneOptions.newInstance.uri +\n                    \"'><b>new \" +\n                    options.noun +\n                    '</b></a> is ready to be set up. ' +\n                    \"<br/><br/><a target='_blank' href='\" +\n                    newPaneOptions.newInstance.uri +\n                    \"'>Go to your new \" +\n                    options.noun +\n                    '.</a>'\n                  // selectUI.parentNode.removeChild(selectUI) // Clean up\n                  // selectUIParent.removeChild(selectUI) // Clean up\n                }\n                selectNewTool() // toggle star to plain and menu vanish again\n              })\n              .catch(function (err) {\n                complain(err)\n                reject(err)\n              })\n          },\n          err => {\n            // login fails\n            complain('Error logging on: ' + err)\n          }\n        )\n      } // callbackWS\n\n      const pa = options.pane\n      // options.appPathSegment = pa.name // was 'edu.mit.solid.pane.'\n      options.noun = pa.mintClass ? utils.label(pa.mintClass) : pa.name\n      options.appPathSegment = options.noun.slice(0, 1).toUpperCase() + options.noun.slice(1)\n\n      if (!options.folder) {\n        // No folder given? Ask user for full URI\n        selectUI = selectWorkspace(dom, {\n          noun: options.noun,\n          appPathSegment: options.appPathSegment\n        }, callbackWS)\n        options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      } else {\n        const gotName = function (name) {\n          if (!name) {\n            // selectUIParent.removeChild(selectUI)   itremves itself if cancelled\n            selectNewTool() // toggle star to plain and menu vanish again\n          } else {\n            let uri = options.folder!.uri\n            if (!uri.endsWith('/')) {\n              uri = uri + '/'\n            }\n            uri = uri + encodeURIComponent(name) + '/'\n            callbackWS(null, uri)\n          }\n        }\n        widgets\n          .askName(\n            dom,\n            kb,\n            options.div,\n            ns.foaf('name'),\n            null,\n            options.noun\n          )\n          .then(gotName)\n        // selectUI = getNameForm(dom, kb, options.noun, gotName)\n        // options.div.appendChild(selectUI)\n        // selectUIParent = options.div\n      }\n    })\n  } // makeNewAppInstance\n\n  const iconArray: Array<any> = []\n  const mintingPanes = Object.values(thePanes).filter(pane => pane.mintNew)\n  const mintingClassMap = mintingPanes.reduce((classMap, pane) => {\n    if (pane.mintClass) {\n      classMap[pane.mintClass.uri] = (classMap[pane.mintClass.uri] || 0) + 1\n    }\n    return classMap\n  }, {})\n  mintingPanes.forEach(pane => {\n    // @@ TODO Remove the need to cast to any\n    const icon: any = createContext.div.appendChild(dom.createElement('img'))\n    icon.setAttribute('src', pane.icon)\n    const noun = pane.mintClass\n      ? mintingClassMap[pane.mintClass.uri] > 1\n          ? `${utils.label(pane.mintClass)} (using ${pane.name} pane)`\n          : utils.label(pane.mintClass)\n      : pane.name + ' @@'\n    icon.setAttribute('title', 'Make new ' + noun)\n    icon.setAttribute('style', iconStyle + 'display: none;')\n    iconArray.push(icon)\n    if (!icon.disabled) {\n      icon.addEventListener('click', function (e) {\n        selectTool(icon)\n        makeNewAppInstance({\n          event: e,\n          folder: createContext.folder || null,\n          iconEle: icon,\n          pane,\n          noun,\n          noIndexHTML: true, // do NOT @@ for now write a HTML file\n          div: createContext.div,\n          me: createContext.me,\n          dom: createContext.dom,\n          refreshTarget: createContext.refreshTarget\n        })\n      })\n    }\n  })\n}\n\n// Form to get the name of a new thing before we create it\n//\n// Used in contacts for new groups, individuals.\n//\n/*\nfunction getNameForm (dom, kb, classLabel, gotNameCallback) {\n  const form = dom.createElement('div') // form is broken as HTML behaviour can resurface on js error\n  form.innerHTML = '<p>Name of new ' + classLabel + ':</p>'\n  const namefield = dom.createElement('input')\n  namefield.setAttribute('type', 'text')\n  namefield.setAttribute('size', '30')\n  namefield.setAttribute('style', style.textInputStyle)\n  namefield.setAttribute('maxLength', '2048') // No arbitrary limits\n  namefield.select() // focus next user input\n\n  const gotName = function () {\n    namefield.setAttribute('class', 'pendingedit')\n    namefield.disabled = true\n    continueButton.disabled = true\n    cancel.disabled = true\n    gotNameCallback(true, namefield.value)\n  }\n\n  namefield.addEventListener('keyup', function (e) {\n    if (e.keyCode === 13) {\n      gotName()\n    }\n  }, false)\n  form.appendChild(namefield)\n\n  form.appendChild(dom.createElement('br'))\n\n  const cancel = form.appendChild(widgets.cancelButton(dom))\n  cancel.addEventListener('click', function (e) {\n    form.parentNode.removeChild(form)\n    gotNameCallback(false)\n  }, false)\n\n  const continueButton = form.appendChild(widgets.continueButton(dom))\n  continueButton.addEventListener('click', function (e) {\n    gotName()\n  }, false)\n\n  return form\n}\n*/\n"],"file":"create.js"}